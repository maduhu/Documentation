<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:ooo="http://xml.openoffice.org/svg/export"
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:xlink="http://www.w3.org/1999/xlink"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   version="1.2"
   viewBox="0 0 25292 3992"
   preserveAspectRatio="xMidYMid"
   xml:space="preserve"
   id="svg5534"
   sodipodi:docname="transfer.svg"
   width="25292"
   height="3992"
   style="fill-rule:evenodd;stroke-width:28.22200012;stroke-linejoin:round"
   inkscape:version="0.92.1 r"><metadata
     id="metadata5538"><rdf:RDF><cc:Work
         rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1920"
     inkscape:window-height="1025"
     id="namedview5536"
     showgrid="false"
     fit-margin-top="200"
     fit-margin-left="200"
     fit-margin-right="200"
     fit-margin-bottom="200"
     inkscape:zoom="0.044094488"
     inkscape:cx="12647"
     inkscape:cy="2112"
     inkscape:window-x="1920"
     inkscape:window-y="1"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg5534" /><defs
     class="ClipPathGroup"
     id="defs5246"><clipPath
       id="presentation_clip_path"
       clipPathUnits="userSpaceOnUse"><rect
         x="0"
         y="0"
         width="25400"
         height="14288"
         id="rect5240" /></clipPath><clipPath
       id="presentation_clip_path_shrink"
       clipPathUnits="userSpaceOnUse"><rect
         x="25"
         y="14"
         width="25350"
         height="14260"
         id="rect5243" /></clipPath></defs><defs
     id="defs5251"><g
       id="ooo:meta_slides"
       ooo:number-of-slides="1"
       ooo:start-slide-number="0"><g
         id="ooo:meta_dummy_slide"
         ooo:slide="dummy-slide"
         ooo:master="dummy-master-page"
         ooo:background-visibility="hidden"
         ooo:master-objects-visibility="hidden"
         ooo:has-transition="false" /><g
         id="ooo:meta_slide_0"
         ooo:slide="id1"
         ooo:master="id2"
         ooo:date-time-visibility="hidden"
         ooo:footer-visibility="hidden"
         ooo:has-transition="true" /></g></defs><defs
     id="presentation-animations" /><defs
     id="defs5307"><font
       id="EmbeddedFont_1"
       horiz-adv-x="2048"
       horiz-origin-x="0"
       horiz-origin-y="0"
       vert-origin-x="45"
       vert-origin-y="90"
       vert-adv-y="90"><font-face
         font-family="Arial embedded"
         units-per-em="2048"
         font-weight="normal"
         font-style="normal"
         ascent="1852"
         descent="450"
         id="font-face5254" /><missing-glyph
         horiz-adv-x="2048"
         d="M 0,0 L 2047,0 2047,2047 0,2047 0,0 Z"
         id="missing-glyph5256" /><glyph
         unicode="x"
         horiz-adv-x="1006"
         d="M 15,0 L 403,552 44,1062 269,1062 432,813 C 463,766 487,726 506,694 535,738 562,777 587,811 L 766,1062 981,1062 614,562 1009,0 788,0 570,330 512,419 233,0 15,0 Z"
         id="glyph5258" /><glyph
         unicode="v"
         horiz-adv-x="1006"
         d="M 430,0 L 26,1062 216,1062 444,426 C 469,357 491,286 512,212 528,268 550,335 579,414 L 815,1062 1000,1062 598,0 430,0 Z"
         id="glyph5260" /><glyph
         unicode="u"
         horiz-adv-x="900"
         d="M 831,0 L 831,156 C 748,36 636,-24 494,-24 431,-24 373,-12 319,12 264,36 224,66 198,103 171,139 153,183 142,236 135,271 131,327 131,404 L 131,1062 311,1062 311,473 C 311,379 315,316 322,283 333,236 357,199 394,172 431,145 476,131 530,131 584,131 635,145 682,173 729,200 763,238 783,286 802,333 812,402 812,493 L 812,1062 992,1062 992,0 831,0 Z"
         id="glyph5262" /><glyph
         unicode="t"
         horiz-adv-x="531"
         d="M 528,161 L 554,2 C 503,-9 458,-14 418,-14 353,-14 302,-4 266,17 230,38 205,65 190,99 175,132 168,203 168,311 L 168,922 36,922 36,1062 168,1062 168,1325 347,1433 347,1062 528,1062 528,922 347,922 347,301 C 347,250 350,217 357,202 363,187 373,176 388,167 402,158 422,154 449,154 469,154 495,156 528,161 Z"
         id="glyph5264" /><glyph
         unicode="r"
         horiz-adv-x="583"
         d="M 133,0 L 133,1062 295,1062 295,901 C 336,976 375,1026 410,1050 445,1074 483,1086 525,1086 586,1086 647,1067 710,1028 L 648,861 C 604,887 560,900 516,900 477,900 441,888 410,865 379,841 356,808 343,766 323,702 313,632 313,556 L 313,0 133,0 Z"
         id="glyph5266" /><glyph
         unicode="o"
         horiz-adv-x="1006"
         d="M 68,531 C 68,728 123,873 232,968 323,1047 435,1086 566,1086 712,1086 831,1038 924,943 1017,847 1063,715 1063,546 1063,409 1043,302 1002,224 961,145 901,84 823,41 744,-2 659,-24 566,-24 417,-24 297,24 206,119 114,214 68,352 68,531 Z M 253,531 C 253,395 283,293 342,226 401,158 476,124 566,124 655,124 730,158 789,226 848,294 878,398 878,537 878,668 848,768 789,836 729,903 655,937 566,937 476,937 401,903 342,836 283,769 253,667 253,531 Z"
         id="glyph5268" /><glyph
         unicode="n"
         horiz-adv-x="874"
         d="M 135,0 L 135,1062 297,1062 297,911 C 375,1028 488,1086 635,1086 699,1086 758,1075 812,1052 865,1029 905,998 932,961 959,924 977,879 988,828 995,795 998,736 998,653 L 998,0 818,0 818,646 C 818,719 811,774 797,811 783,847 758,876 723,898 687,919 645,930 597,930 520,930 454,906 399,857 343,808 315,716 315,580 L 315,0 135,0 Z"
         id="glyph5270" /><glyph
         unicode="m"
         horiz-adv-x="1457"
         d="M 135,0 L 135,1062 296,1062 296,913 C 329,965 374,1007 429,1039 484,1070 547,1086 618,1086 697,1086 761,1070 812,1037 862,1004 897,959 918,900 1002,1024 1111,1086 1246,1086 1351,1086 1432,1057 1489,999 1546,940 1574,850 1574,729 L 1574,0 1395,0 1395,669 C 1395,741 1389,793 1378,825 1366,856 1345,882 1314,901 1283,920 1247,930 1206,930 1131,930 1069,905 1020,856 971,806 946,726 946,617 L 946,0 766,0 766,690 C 766,770 751,830 722,870 693,910 645,930 578,930 527,930 481,917 438,890 395,863 363,824 344,773 325,722 315,648 315,551 L 315,0 135,0 Z"
         id="glyph5272" /><glyph
         unicode="l"
         horiz-adv-x="213"
         d="M 131,0 L 131,1466 311,1466 311,0 131,0 Z"
         id="glyph5274" /><glyph
         unicode="k"
         horiz-adv-x="901"
         d="M 136,0 L 136,1466 316,1466 316,630 742,1062 975,1062 569,668 1016,0 794,0 443,543 316,421 316,0 136,0 Z"
         id="glyph5276" /><glyph
         unicode="i"
         horiz-adv-x="187"
         d="M 136,1259 L 136,1466 316,1466 316,1259 136,1259 Z M 136,0 L 136,1062 316,1062 316,0 136,0 Z"
         id="glyph5278" /><glyph
         unicode="h"
         horiz-adv-x="874"
         d="M 135,0 L 135,1466 315,1466 315,940 C 399,1037 505,1086 633,1086 712,1086 780,1071 838,1040 896,1009 938,966 963,911 988,856 1000,777 1000,673 L 1000,0 820,0 820,673 C 820,763 801,829 762,870 723,911 667,931 596,931 543,931 493,917 446,890 399,862 365,824 345,777 325,730 315,664 315,581 L 315,0 135,0 Z"
         id="glyph5280" /><glyph
         unicode="f"
         horiz-adv-x="662"
         d="M 178,0 L 178,922 19,922 19,1062 178,1062 178,1175 C 178,1246 184,1299 197,1334 214,1381 245,1419 289,1448 332,1477 393,1491 472,1491 523,1491 579,1485 640,1473 L 613,1316 C 576,1323 540,1326 507,1326 452,1326 414,1314 391,1291 368,1268 357,1224 357,1160 L 357,1062 564,1062 564,922 357,922 357,0 178,0 Z"
         id="glyph5282" /><glyph
         unicode="e"
         horiz-adv-x="1006"
         d="M 862,342 L 1048,319 C 1019,210 964,126 885,66 806,6 704,-24 581,-24 426,-24 303,24 212,120 121,215 75,349 75,522 75,701 121,839 213,938 305,1037 424,1086 571,1086 713,1086 829,1038 919,941 1009,844 1054,708 1054,533 1054,522 1054,506 1053,485 L 261,485 C 268,368 301,279 360,217 419,155 493,124 582,124 648,124 704,141 751,176 798,211 835,266 862,342 Z M 271,633 L 864,633 C 856,722 833,789 796,834 739,903 664,938 573,938 490,938 421,910 365,855 308,800 277,726 271,633 Z"
         id="glyph5284" /><glyph
         unicode="d"
         horiz-adv-x="953"
         d="M 824,0 L 824,134 C 757,29 658,-24 527,-24 442,-24 365,-1 294,46 223,93 168,158 129,242 90,325 70,421 70,530 70,636 88,732 123,819 158,905 211,971 282,1017 353,1063 432,1086 519,1086 583,1086 640,1073 690,1046 740,1019 781,983 812,940 L 812,1466 991,1466 991,0 824,0 Z M 255,530 C 255,394 284,292 341,225 398,158 466,124 544,124 623,124 690,156 745,221 800,285 827,383 827,515 827,660 799,767 743,835 687,903 618,937 536,937 456,937 389,904 336,839 282,774 255,671 255,530 Z"
         id="glyph5286" /><glyph
         unicode="c"
         horiz-adv-x="927"
         d="M 828,389 L 1005,366 C 986,244 936,149 857,80 777,11 679,-24 563,-24 418,-24 301,24 213,119 124,214 80,350 80,527 80,642 99,742 137,828 175,914 233,979 311,1022 388,1065 473,1086 564,1086 679,1086 774,1057 847,999 920,940 967,857 988,750 L 813,723 C 796,794 767,848 725,884 682,920 631,938 571,938 480,938 407,906 350,841 293,776 265,673 265,532 265,389 292,286 347,221 402,156 473,124 561,124 632,124 691,146 738,189 785,232 815,299 828,389 Z"
         id="glyph5288" /><glyph
         unicode="a"
         horiz-adv-x="1006"
         d="M 828,131 C 761,74 697,34 636,11 574,-12 508,-24 437,-24 320,-24 231,5 168,62 105,119 74,191 74,280 74,332 86,380 110,423 133,466 164,500 203,526 241,552 284,572 332,585 367,594 421,603 492,612 637,629 744,650 813,674 814,699 814,714 814,721 814,794 797,846 763,876 717,917 649,937 558,937 473,937 411,922 371,893 330,863 300,810 281,735 L 105,759 C 121,834 147,895 184,942 221,988 274,1024 343,1049 412,1074 493,1086 584,1086 675,1086 748,1075 805,1054 862,1033 903,1006 930,974 957,941 975,900 986,851 992,820 995,765 995,685 L 995,445 C 995,278 999,172 1007,128 1014,83 1029,41 1052,0 L 864,0 C 845,37 833,81 828,131 Z M 813,533 C 748,506 650,484 519,465 445,454 393,442 362,429 331,416 308,396 291,371 274,345 266,316 266,285 266,237 284,197 321,165 357,133 410,117 480,117 549,117 611,132 665,163 719,193 759,234 784,287 803,328 813,388 813,467 L 813,533 Z"
         id="glyph5290" /><glyph
         unicode="T"
         horiz-adv-x="1192"
         d="M 531,0 L 531,1293 48,1293 48,1466 1210,1466 1210,1293 725,1293 725,0 531,0 Z"
         id="glyph5292" /><glyph
         unicode="S"
         horiz-adv-x="1192"
         d="M 92,471 L 275,487 C 284,414 304,354 336,307 367,260 416,222 483,193 550,164 625,149 708,149 782,149 847,160 904,182 961,204 1003,234 1031,273 1058,311 1072,353 1072,398 1072,444 1059,484 1032,519 1005,553 961,582 900,605 861,620 774,644 639,677 504,709 410,739 356,768 286,805 234,850 200,905 165,959 148,1020 148,1087 148,1161 169,1230 211,1295 253,1359 314,1408 395,1441 476,1474 565,1491 664,1491 773,1491 869,1474 952,1439 1035,1404 1098,1352 1143,1284 1188,1216 1212,1139 1215,1053 L 1029,1039 C 1019,1132 985,1202 928,1249 870,1296 785,1320 672,1320 555,1320 469,1299 416,1256 362,1213 335,1161 335,1100 335,1047 354,1004 392,970 429,936 527,901 685,866 842,830 950,799 1009,772 1094,733 1157,683 1198,623 1239,562 1259,493 1259,414 1259,336 1237,263 1192,194 1147,125 1083,71 1000,33 916,-6 822,-25 717,-25 584,-25 473,-6 384,33 294,72 224,130 173,208 122,285 95,373 92,471 Z"
         id="glyph5294" /><glyph
         unicode="O"
         horiz-adv-x="1430"
         d="M 99,714 C 99,957 164,1148 295,1286 426,1423 594,1492 801,1492 936,1492 1058,1460 1167,1395 1276,1330 1359,1240 1416,1125 1473,1009 1501,878 1501,731 1501,582 1471,449 1411,332 1351,215 1266,126 1156,66 1046,5 927,-25 800,-25 662,-25 539,8 430,75 321,142 239,233 183,348 127,463 99,585 99,714 Z M 299,711 C 299,534 347,395 442,294 537,192 656,141 799,141 945,141 1065,192 1160,295 1254,398 1301,543 1301,732 1301,851 1281,956 1241,1045 1200,1134 1141,1203 1064,1252 986,1301 899,1325 802,1325 665,1325 547,1278 448,1184 349,1089 299,932 299,711 Z"
         id="glyph5296" /><glyph
         unicode="L"
         horiz-adv-x="954"
         d="M 150,0 L 150,1466 344,1466 344,173 1066,173 1066,0 150,0 Z"
         id="glyph5298" /><glyph
         unicode="F"
         horiz-adv-x="1006"
         d="M 168,0 L 168,1466 1157,1466 1157,1293 362,1293 362,839 1050,839 1050,666 362,666 362,0 168,0 Z"
         id="glyph5300" /><glyph
         unicode="C"
         horiz-adv-x="1324"
         d="M 1204,514 L 1398,465 C 1357,306 1284,184 1179,101 1073,17 944,-25 791,-25 633,-25 505,7 406,72 307,136 231,229 180,351 128,473 102,604 102,744 102,897 131,1030 190,1144 248,1257 331,1344 439,1403 546,1462 665,1491 794,1491 941,1491 1064,1454 1164,1379 1264,1304 1334,1199 1373,1064 L 1182,1019 C 1148,1126 1099,1203 1034,1252 969,1301 888,1325 790,1325 677,1325 583,1298 508,1244 432,1190 379,1118 348,1027 317,936 302,842 302,745 302,620 320,512 357,419 393,326 449,256 526,210 603,164 686,141 775,141 884,141 976,172 1051,235 1126,298 1177,391 1204,514 Z"
         id="glyph5302" /><glyph
         unicode=" "
         horiz-adv-x="556"
         id="glyph5304" /></font></defs><defs
     id="defs5330"><font
       id="EmbeddedFont_2"
       horiz-adv-x="2048"
       horiz-origin-x="0"
       horiz-origin-y="0"
       vert-origin-x="45"
       vert-origin-y="90"
       vert-adv-y="90"><font-face
         font-family="Open Sans embedded"
         units-per-em="2048"
         font-weight="normal"
         font-style="normal"
         ascent="2196"
         descent="609"
         id="font-face5309" /><missing-glyph
         horiz-adv-x="2048"
         d="M 0,0 L 2047,0 2047,2047 0,2047 0,0 Z"
         id="missing-glyph5311" /><glyph
         unicode="u"
         horiz-adv-x="927"
         d="M 332,1096 L 332,385 C 332,296 352,229 393,185 434,141 497,119 584,119 699,119 783,150 836,213 889,276 915,378 915,520 L 915,1096 1081,1096 1081,0 944,0 920,147 911,147 C 877,93 830,52 770,23 709,-6 640,-20 563,-20 430,-20 330,12 264,75 197,138 164,240 164,379 L 164,1096 332,1096 Z"
         id="glyph5313" /><glyph
         unicode="r"
         horiz-adv-x="662"
         d="M 676,1116 C 725,1116 768,1112 807,1104 L 784,950 C 739,960 699,965 664,965 575,965 500,929 437,857 374,785 342,695 342,588 L 342,0 176,0 176,1096 313,1096 332,893 340,893 C 381,964 430,1019 487,1058 544,1097 607,1116 676,1116 Z"
         id="glyph5315" /><glyph
         unicode="n"
         horiz-adv-x="953"
         d="M 926,0 L 926,709 C 926,798 906,865 865,909 824,953 761,975 674,975 559,975 475,944 422,882 369,820 342,718 342,575 L 342,0 176,0 176,1096 311,1096 338,946 346,946 C 380,1000 428,1042 489,1072 550,1101 619,1116 694,1116 826,1116 925,1084 992,1021 1059,957 1092,855 1092,715 L 1092,0 926,0 Z"
         id="glyph5317" /><glyph
         unicode="m"
         horiz-adv-x="1588"
         d="M 1573,0 L 1573,713 C 1573,800 1554,866 1517,910 1480,953 1422,975 1343,975 1240,975 1163,945 1114,886 1065,827 1040,735 1040,612 L 1040,0 874,0 874,713 C 874,800 855,866 818,910 781,953 722,975 643,975 539,975 463,944 415,882 366,819 342,717 342,575 L 342,0 176,0 176,1096 311,1096 338,946 346,946 C 377,999 422,1041 479,1071 536,1101 599,1116 670,1116 841,1116 953,1054 1006,930 L 1014,930 C 1047,987 1094,1033 1156,1066 1218,1099 1289,1116 1368,1116 1492,1116 1585,1084 1647,1021 1708,957 1739,855 1739,715 L 1739,0 1573,0 Z"
         id="glyph5319" /><glyph
         unicode="e"
         horiz-adv-x="953"
         d="M 639,-20 C 477,-20 349,29 256,128 162,227 115,364 115,539 115,716 159,856 246,960 333,1064 449,1116 596,1116 733,1116 842,1071 922,981 1002,890 1042,771 1042,623 L 1042,518 287,518 C 290,389 323,292 385,225 446,158 533,125 645,125 763,125 880,150 995,199 L 995,51 C 936,26 881,8 829,-4 776,-14 713,-20 639,-20 Z M 594,977 C 506,977 436,948 384,891 331,834 300,754 291,653 L 864,653 C 864,758 841,838 794,894 747,949 681,977 594,977 Z"
         id="glyph5321" /><glyph
         unicode="b"
         horiz-adv-x="980"
         d="M 686,1114 C 830,1114 942,1065 1022,967 1101,868 1141,729 1141,549 1141,369 1101,229 1021,130 940,30 829,-20 686,-20 615,-20 550,-7 491,20 432,46 382,86 342,141 L 330,141 295,0 176,0 176,1556 342,1556 342,1178 C 342,1093 339,1017 334,950 L 342,950 C 419,1059 534,1114 686,1114 Z M 662,975 C 549,975 467,943 417,878 367,813 342,703 342,549 342,395 368,285 419,219 470,152 553,119 666,119 768,119 844,156 894,231 944,305 969,412 969,551 969,694 944,800 894,870 844,940 767,975 662,975 Z"
         id="glyph5323" /><glyph
         unicode="&gt;"
         horiz-adv-x="1007"
         d="M 104,393 L 887,719 104,1092 104,1241 1065,762 1065,664 104,242 104,393 Z"
         id="glyph5325" /><glyph
         unicode="&lt;"
         horiz-adv-x="1007"
         d="M 1065,242 L 104,664 104,762 1065,1241 1065,1092 283,721 1065,393 1065,242 Z"
         id="glyph5327" /></font></defs><defs
     id="defs5359"><font
       id="EmbeddedFont_3"
       horiz-adv-x="2048"
       horiz-origin-x="0"
       horiz-origin-y="0"
       vert-origin-x="45"
       vert-origin-y="90"
       vert-adv-y="90"><font-face
         font-family="Source Sans Pro embedded"
         units-per-em="2048"
         font-weight="normal"
         font-style="normal"
         ascent="2011"
         descent="582"
         id="font-face5332" /><missing-glyph
         horiz-adv-x="2048"
         d="M 0,0 L 2047,0 2047,2047 0,2047 0,0 Z"
         id="missing-glyph5334" /><glyph
         unicode="v"
         horiz-adv-x="954"
         d="M 383,0 L 580,0 932,995 766,995 578,430 C 549,332 516,231 487,137 L 479,137 C 449,231 416,332 387,430 L 199,995 25,995 383,0 Z"
         id="glyph5336" /><glyph
         unicode="r"
         horiz-adv-x="556"
         d="M 168,0 L 336,0 336,639 C 403,807 504,868 588,868 629,868 651,862 684,852 L 717,999 C 684,1014 653,1020 610,1020 498,1020 395,940 328,815 L 322,815 307,995 168,995 168,0 Z"
         id="glyph5338" /><glyph
         unicode="n"
         horiz-adv-x="821"
         d="M 168,0 L 336,0 336,721 C 436,821 506,875 608,875 739,875 797,795 797,608 L 797,0 965,0 965,631 C 965,885 870,1020 662,1020 524,1020 422,946 328,852 L 322,852 307,995 168,995 168,0 Z"
         id="glyph5340" /><glyph
         unicode="i"
         horiz-adv-x="239"
         d="M 254,1200 C 319,1200 371,1245 371,1309 371,1374 319,1417 254,1417 188,1417 137,1374 137,1309 137,1245 188,1200 254,1200 Z M 168,0 L 336,0 336,995 168,995 168,0 Z"
         id="glyph5342" /><glyph
         unicode="g"
         horiz-adv-x="927"
         d="M 240,-168 C 240,-111 270,-51 342,0 385,-12 432,-16 471,-16 L 643,-16 C 772,-16 844,-47 844,-139 844,-244 719,-342 528,-342 348,-342 240,-274 240,-168 Z M 92,-190 C 92,-363 260,-459 504,-459 813,-459 1008,-299 1008,-115 1008,51 891,123 659,123 L 467,123 C 332,123 291,168 291,231 291,287 319,319 354,350 399,328 455,315 504,315 707,315 868,449 868,662 868,745 834,821 786,866 L 991,866 991,995 645,995 C 608,1010 559,1020 504,1020 301,1020 129,883 129,666 129,547 193,451 258,397 L 258,389 C 207,354 150,289 150,205 150,127 188,74 238,43 L 238,35 C 147,-27 92,-107 92,-190 Z M 504,428 C 389,428 293,520 293,666 293,811 387,897 504,897 621,897 715,811 715,666 715,520 619,428 504,428 Z"
         id="glyph5344" /><glyph
         unicode="e"
         horiz-adv-x="875"
         d="M 94,496 C 94,170 305,-25 571,-25 707,-25 813,23 899,78 L 840,188 C 766,141 686,111 592,111 401,111 272,246 260,461 L 932,461 C 936,485 938,518 938,553 938,838 795,1020 541,1020 313,1020 94,821 94,496 Z M 258,571 C 279,772 406,887 545,887 700,887 791,774 791,571 L 258,571 Z"
         id="glyph5346" /><glyph
         unicode="d"
         horiz-adv-x="901"
         d="M 96,496 C 96,164 258,-25 508,-25 625,-25 731,41 809,117 L 815,117 829,0 969,0 969,1458 799,1458 799,1075 807,905 C 719,977 643,1020 528,1020 301,1020 96,819 96,496 Z M 270,498 C 270,725 397,879 557,879 639,879 715,850 799,774 L 799,254 C 717,162 637,117 545,117 371,117 270,260 270,498 Z"
         id="glyph5348" /><glyph
         unicode="c"
         horiz-adv-x="822"
         d="M 94,496 C 94,166 297,-25 561,-25 680,-25 795,25 885,104 L 809,215 C 750,162 670,115 575,115 393,115 268,268 268,496 268,725 399,881 580,881 659,881 721,844 780,793 L 864,901 C 797,965 705,1020 573,1020 317,1020 94,829 94,496 Z"
         id="glyph5350" /><glyph
         unicode="S"
         horiz-adv-x="954"
         d="M 86,174 C 203,53 369,-25 557,-25 840,-25 1014,145 1014,358 1014,557 893,649 737,717 L 547,799 C 440,844 324,893 324,1022 324,1143 424,1219 573,1219 698,1219 797,1169 879,1092 L 971,1202 C 875,1300 733,1368 573,1368 330,1368 152,1217 152,1012 152,815 297,719 424,666 L 616,582 C 743,524 840,481 840,344 840,213 735,125 559,125 420,125 285,193 188,293 L 86,174 Z"
         id="glyph5352" /><glyph
         unicode="R"
         horiz-adv-x="953"
         d="M 354,1206 L 580,1206 C 788,1206 905,1143 905,967 905,793 788,707 580,707 L 354,707 354,1206 Z M 1114,0 L 774,586 C 956,631 1075,758 1075,967 1075,1245 879,1343 604,1343 L 184,1343 184,0 354,0 354,567 598,567 922,0 1114,0 Z"
         id="glyph5354" /><glyph
         unicode="L"
         horiz-adv-x="795"
         d="M 184,0 L 942,0 942,145 354,145 354,1343 184,1343 184,0 Z"
         id="glyph5356" /></font></defs><defs
     id="defs5370"><font
       id="EmbeddedFont_4"
       horiz-adv-x="2048"
       horiz-origin-x="0"
       horiz-origin-y="0"
       vert-origin-x="45"
       vert-origin-y="90"
       vert-adv-y="90"><font-face
         font-family="StarSymbol embedded"
         units-per-em="2048"
         font-weight="normal"
         font-style="normal"
         ascent="1879"
         descent="661"
         id="font-face5361" /><missing-glyph
         horiz-adv-x="2048"
         d="M 0,0 L 2047,0 2047,2047 0,2047 0,0 Z"
         id="missing-glyph5363" /><glyph
         unicode="●"
         horiz-adv-x="1191"
         d="M 813,0 C 632,0 489,54 383,161 276,268 223,411 223,592 223,773 276,916 383,1023 489,1130 632,1184 813,1184 992,1184 1136,1130 1245,1023 1353,916 1407,772 1407,592 1407,412 1353,268 1245,161 1136,54 992,0 813,0 Z"
         id="glyph5365" /><glyph
         unicode="–"
         horiz-adv-x="1165"
         d="M -4,459 L 1135,459 1135,606 -4,606 -4,459 Z"
         id="glyph5367" /></font></defs><defs
     class="TextShapeIndex"
     id="defs5374"><g
       ooo:slide="id1"
       ooo:id-list="id6 id7 id8 id9"
       id="g5372" /></defs><defs
     class="EmbeddedBulletChars"
     id="defs5406"><g
       id="bullet-char-template(57356)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 580,1141 1163,571 580,0 -4,571 Z"
         id="path5376"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(57354)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 8,1128 H 1137 V 0 H 8 Z"
         id="path5379"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(10146)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 174,0 602,739 174,1481 1456,739 Z M 1358,739 309,1346 659,739 Z"
         id="path5382"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(10132)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 2015,739 1276,0 H 717 l 543,543 H 174 v 393 h 1086 l -543,545 h 557 z"
         id="path5385"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(10007)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="m 0,-2 c -7,16 -16,29 -25,39 l 381,530 c -94,256 -141,385 -141,387 0,25 13,38 40,38 9,0 21,-2 34,-5 21,4 42,12 65,25 l 27,-13 111,-251 280,301 64,-25 24,25 c 21,-10 41,-24 62,-43 C 886,937 835,863 770,784 769,783 710,716 594,584 L 774,223 c 0,-27 -21,-55 -63,-84 l 16,-20 C 717,90 699,76 672,76 641,76 570,178 457,381 L 164,-76 c -22,-34 -53,-51 -92,-51 -42,0 -63,17 -64,51 -7,9 -10,24 -10,44 0,9 1,19 2,30 z"
         id="path5388"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(10004)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 285,-33 C 182,-33 111,30 74,156 52,228 41,333 41,471 c 0,78 14,145 41,201 34,71 87,106 158,106 53,0 88,-31 106,-94 l 23,-176 c 8,-64 28,-97 59,-98 l 735,706 c 11,11 33,17 66,17 42,0 63,-15 63,-46 V 965 c 0,-36 -10,-64 -30,-84 L 442,47 C 390,-6 338,-33 285,-33 Z"
         id="path5391"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(9679)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M 813,0 C 632,0 489,54 383,161 276,268 223,411 223,592 c 0,181 53,324 160,431 106,107 249,161 430,161 179,0 323,-54 432,-161 108,-107 162,-251 162,-431 0,-180 -54,-324 -162,-431 C 1136,54 992,0 813,0 Z"
         id="path5394"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(8226)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="m 346,457 c -73,0 -137,26 -191,78 -54,51 -81,114 -81,188 0,73 27,136 81,188 54,52 118,78 191,78 73,0 134,-26 185,-79 51,-51 77,-114 77,-187 0,-75 -25,-137 -76,-188 -50,-52 -112,-78 -186,-78 z"
         id="path5397"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(8211)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="M -4,459 H 1135 V 606 H -4 Z"
         id="path5400"
         inkscape:connector-curvature="0" /></g><g
       id="bullet-char-template(61548)"
       transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path
         d="m 173,740 c 0,163 58,303 173,419 116,115 255,173 419,173 163,0 302,-58 418,-173 116,-116 174,-256 174,-419 0,-163 -58,-303 -174,-418 C 1067,206 928,148 765,148 601,148 462,206 346,322 231,437 173,577 173,740 Z"
         id="path5403"
         inkscape:connector-curvature="0" /></g></defs><defs
     class="TextEmbeddedBitmaps"
     id="defs5408" /><defs
     id="defs5445"><g
       id="dummy-master-page"
       ooo:name="dummy-master-page"
       class="Master_Slide"><g
         id="bg-dummy-master-page"
         class="Background"
         visibility="hidden"
         style="visibility:hidden" /><g
         id="bo-dummy-master-page"
         class="BackgroundObjects"
         visibility="hidden"
         style="visibility:hidden" /></g><g
       id="id2"
       ooo:name="Title,_Subtitle,_and_Body_Light"
       class="Master_Slide"><g
         id="bg-id2"
         class="Background"><path
           d="M 12700,14287 H 0 V 0 h 25399 v 14287 z"
           id="path5413"
           inkscape:connector-curvature="0"
           style="fill:#ffffff;stroke:none" /></g><g
         id="bo-id2"
         class="BackgroundObjects"><g
           class="Graphic"
           id="g5422"><g
             id="g5420"><rect
               class="BoundingBox"
               x="305"
               y="13387"
               width="635"
               height="635"
               id="rect5416"
               style="fill:none;stroke:none" /><image
               x="305"
               y="13387"
               width="635"
               height="635"
               xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAABibAAAYmwFJdYOUAAAG5klEQVR4nMWYW2xURRjHZ86eJaBWUGjipYYHwECMiBhjwAoR0yKwvYY10hYLSksi2qCCMQF8UCImaCKKRnqhF+nWUCktFlqWawnyILEqkqAS8UFRDEERUGDbPeP/mzlz9nT3bOjdr+nO9Zz5nf98czVZP21Ldc0swzBmcs4f5pzdh3AsZ3wcQmYY/B+U/ca58YPB2XFUP7YoGNzfn3bMvlT+qGprGhpfxRh/CuGdOh9g8VVvBugkwE0CaIBqNDY1nTcMX71gYvPC3NyfBhWQwIQQGyBOIROKRwg0y4XE05CkXrxZlgVFfVQjFU+tNDhf2dTSEkLdV/Oys88OGHBzZVUp4NZDsdRkdaCKjiRAQkEGJanbZZl0Ac4LEMna3dZWtmDevJp+AcLHRnZHoxWIFlHagmR4sYQh4QRXqgHeUznDyeOMuVwgls9SoG516549T5imWfpkZubVXgOiS0dHurtaAZAum3ABxPubVEX/uerpD5KyajfQ5UpFnS6CEOMBmhuYP//PGwKScgqOpeuXS5XwZzEhu8sFeRJ1WlD6pc/gp9DiBcpE/bEAGI/0bIQYJGyaG94FJ2ERewxhS3s4nBmvZALgtUikHC9IF+pZRwGhR4fK2IHfDSVLijvjn7eNlDiNf5pa1jXu3DkN4Wrb92K1FJyGTReWqERYmBTw/fKK5ai6WKeF3TuEJ52OMUwVxsLlS5ccSQLmacG8vG+o4ZbW1kpA1nHDSGOMueH0xxdg4OxzDxwHkKYS+MLGmMdoSpUBBY9alshdsey5C32Bc1tOIHAIvvYAos3Urdp/tXH4j4/53kOddvjjuR6AXd3db+GBFBeTm/HoCNOfAeWu9RdOGw0E+NpcYVkH0MoMDeZAMjZ6hN+/DtEVDuCHVVUTurujBXrKEGoW1g/8gmTuYMBpo4EAlQI+n+9btOd0twxVu8+H9+17JzMj42cJGI1aLyCg6V7B2aFd+Zmy0pJ+d2syIyUBUYx2DrjA3IYlla0wN328xY+iQl3BsgFt2/5iacnhwYbTBoUO7g2Hm9F2rkdxUAJiVD4KNrmMEZrBYqD4ureHCk4b2nnTFwdoi5UKheeYSMxR2WqeE1xIRIB2Qr2vhxpw3ty5neH9+zvR5nSP4hmk4DTacbh3JRKW891DDacNLbYxD0AwzISCbAoNc9fARVzup44PFyCmnC8weSfmMzbFBFiaVI2L2KTJ5cJ2ergAocz3SUruIAVHyqjgsWVSxX8fFjhY1LIu+jwUhI1yVpK4NZz1nG3+PyPAK/i/Jb4AnTwOwd/DAQH1xngWcH6VAGlRnugscYz2ayS3NRk/vT7cDMiEmKy2d9xO2quYZZ2lQXIK54WJaqDEDj84SdBCPixTTVSwGWrzbS+zipJwfjQh7wkksySx7XfqQ3gWftYOByDmmYBQu067fRW3BPsKEzVvB+waG4q5duJTK2pr00uKi48OJVvb3r3T0aUPcofOtWGxxGGTAMpras8jnRq/ocAq8xKCIQWMRqNrZe+5T4lqNTt/8crlDjnNoLwBQVmP05uK59eGQrOKCwr6tMXvre1pa59jCSuP9FJg2sfkb6ggGIxKQGwcN2I9LouDkyG2+fWfNHx6/+JFT18cTDh07W2Rrq4aNSBlY8y9Yfab5ibKloDPFhX9WllXV43CpW5AMsyHaV3R7s937tqVmZed7Xm47qvhXaMikUgrGrqH0vIM7bQnbSvtph1AMvjb66i3EGwpHu9M/+vSpTCUzBqoklI5gmNspjwsqp2Ts1E21OKwRtd3AEnFmvr6V1CxPP6l9tyYjlPfd/DJwv76ZFNLS8a169er8ba7ub51ENyBJIOrrcoOBM4lAJItKSysqN5WPxsPOIfnHsdCOuBw3lHX0NAEP9nUW9Adzc2P4LnXEM3V27rYmScGCQvhaFrpfjbhZmHMrSkl6M7xTF59OGAqNJxNbb7hM/Lrt28/hbLPkHUEJWdwMpR3K6bpux0DbwLyZnNuYMLnUxOvlzSkkziG3lsWXycBkAYC+RoNDKzJCZCGS1G8fwqY19kVmN/vT4RQjuYaeIJWCPctF9khwC3wGoSet1s0ELZU12TgAF2JFxfqidSBNWLTkIa7kbl37D2M8xD8blmyGSLp/aB9UC/CwOlA+C7elOKoJ1vz3GAmB2SuHbvS9TLSq+BzCYOyV4DaaOBs3batzfT51iNZLFXwgPO4p1ZXKHR8lScKtU7YKlZhIl6r718GBEhGUxCxNjQ2vqFuIUQRnD/VuEHP9rzfEReQDiH3g/ycnF6fd/p0y78oGDyD4OVQY+NqhI9DkVkIH4JK90KauxC/ya76L5bIP+CjJ/ERJzBaOzCHHqS1tS/tkf0H+06399waKUkAAAAASUVORK5CYII="
               id="image5418" /></g></g><g
           visibility="hidden"
           ooo:text-adjust="left"
           class="Slide_Number"
           id="g5441"
           style="visibility:hidden"><g
             id="id3"><rect
               class="BoundingBox"
               x="23618"
               y="13234"
               width="1524"
               height="1106"
               id="rect5424"
               style="fill:none;stroke:none" /><text
               class="TextShape"
               id="text5438"><tspan
                 class="TextParagraph"
                 font-size="353px"
                 font-weight="400"
                 id="tspan5430"
                 style="font-weight:400;font-size:353px;font-family:'Open Sans', sans-serif"><tspan
                   class="TextPosition"
                   x="23872"
                   y="13854"
                   id="tspan5428"><tspan
                     class="PlaceholderText"
                     id="tspan5426"
                     style="fill:#94a4a5;stroke:none">&lt;num</tspan></tspan></tspan><tspan
                 class="TextParagraph"
                 font-size="353px"
                 font-weight="400"
                 id="tspan5436"
                 style="font-weight:400;font-size:353px;font-family:'Open Sans', sans-serif"><tspan
                   class="TextPosition"
                   x="23872"
                   y="14337"
                   id="tspan5434"><tspan
                     id="tspan5432"
                     style="fill:#94a4a5;stroke:none">ber&gt;</tspan></tspan></tspan></text>
</g></g></g></g></defs><g
     class="DummySlide"
     id="g5452"
     transform="translate(-53,-5264)"><g
       id="g5450"><g
         id="dummy-slide"
         class="Slide"
         clip-path="url(#presentation_clip_path)"><g
           ooo:name="dummy-page"
           class="Page"
           id="g5447" /></g></g></g><g
     class="SlideGroup"
     id="g5530"
     transform="translate(-53,-5264)"><g
       visibility="hidden"
       id="g5528"
       style="visibility:hidden"><g
         id="container-id1"><g
           id="id1"
           class="Slide"
           clip-path="url(#presentation_clip_path)"><g
             ooo:name="Payments_Within_One_Network_Are_Trivial"
             class="Page"
             id="g5524"><g
               class="com.sun.star.drawing.CustomShape"
               id="g5459"><g
                 id="id6"><rect
                   class="BoundingBox"
                   x="4078"
                   y="7634"
                   width="17251"
                   height="633"
                   id="rect5454"
                   style="fill:none;stroke:none" /><path
                   d="m 4079,7634 h 16951 l 298,316 -298,316 H 4079 l 297,-316 z m 0,0 z m 17249,632 z"
                   id="path5456"
                   inkscape:connector-curvature="0"
                   style="fill:#c1c1c1;stroke:none" /></g></g><g
               class="Graphic"
               id="g5467"><g
                 id="g5465"><rect
                   class="BoundingBox"
                   x="11598"
                   y="6849"
                   width="2205"
                   height="2205"
                   id="rect5461"
                   style="fill:none;stroke:none" /><image
                   x="11598"
                   y="6849"
                   width="2205"
                   height="2205"
                   xlink:href="data:image/png;base64,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"
                   id="image5463" /></g></g><g
               class="Graphic"
               id="g5475"><g
                 id="g5473"><rect
                   class="BoundingBox"
                   x="1638"
                   y="6846"
                   width="2210"
                   height="2210"
                   id="rect5469"
                   style="fill:none;stroke:none" /><image
                   x="1638"
                   y="6846"
                   width="2210"
                   height="2210"
                   xlink:href="data:image/png;base64,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"
                   id="image5471" /></g></g><g
               class="com.sun.star.drawing.CustomShape"
               id="g5488"><g
                 id="id7"><rect
                   class="BoundingBox"
                   x="253"
                   y="5464"
                   width="4978"
                   height="1123"
                   id="rect5477"
                   style="fill:none;stroke:none" /><text
                   class="TextShape"
                   id="text5485"><tspan
                     class="TextParagraph"
                     font-size="635px"
                     font-weight="400"
                     id="tspan5483"
                     style="font-weight:400;font-size:635px;font-family:'Source Sans Pro', sans-serif"><tspan
                       class="TextPosition"
                       x="1800"
                       y="6353"
                       id="tspan5481"><tspan
                         id="tspan5479"
                         style="fill:#c0464b;stroke:none">Sender</tspan></tspan></tspan></text>
</g></g><g
               class="com.sun.star.drawing.CustomShape"
               id="g5501"><g
                 id="id8"><rect
                   class="BoundingBox"
                   x="20167"
                   y="5464"
                   width="4978"
                   height="1123"
                   id="rect5490"
                   style="fill:none;stroke:none" /><text
                   class="TextShape"
                   id="text5498"><tspan
                     class="TextParagraph"
                     font-size="635px"
                     font-weight="400"
                     id="tspan5496"
                     style="font-weight:400;font-size:635px;font-family:'Source Sans Pro', sans-serif"><tspan
                       class="TextPosition"
                       x="21537"
                       y="6353"
                       id="tspan5494"><tspan
                         id="tspan5492"
                         style="fill:#42b186;stroke:none">Receiver</tspan></tspan></tspan></text>
</g></g><g
               class="com.sun.star.drawing.CustomShape"
               id="g5514"><g
                 id="id9"><rect
                   class="BoundingBox"
                   x="10210"
                   y="5464"
                   width="4978"
                   height="1123"
                   id="rect5503"
                   style="fill:none;stroke:none" /><text
                   class="TextShape"
                   id="text5511"><tspan
                     class="TextParagraph"
                     font-size="635px"
                     font-weight="400"
                     id="tspan5509"
                     style="font-weight:400;font-size:635px;font-family:'Source Sans Pro', sans-serif"><tspan
                       class="TextPosition"
                       x="11795"
                       y="6353"
                       id="tspan5507"><tspan
                         id="tspan5505"
                         style="fill:#94a4a5;stroke:none">Ledger</tspan></tspan></tspan></text>
</g></g><g
               class="Graphic"
               id="g5522"><g
                 id="g5520"><rect
                   class="BoundingBox"
                   x="21552"
                   y="6846"
                   width="2210"
                   height="2210"
                   id="rect5516"
                   style="fill:none;stroke:none" /><image
                   x="21552"
                   y="6846"
                   width="2210"
                   height="2210"
                   xlink:href="data:image/png;base64,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"
                   id="image5518" /></g></g></g></g></g></g></g><script
     type="text/ecmascript"
     id="script5532"><![CDATA[


/*****
* @licstart
*
* The following is the license notice for the part of JavaScript code of this
* page included between the '@jessyinkstart' and the '@jessyinkend' notes.
*/

/*****  ******************************************************************
*
* Copyright 2008-2013 Hannes Hochreiner
*
* The JavaScript code included between the start note '@jessyinkstart'
* and the end note '@jessyinkend' is subject to the terms of the Mozilla
* Public License, v. 2.0. If a copy of the MPL was not distributed with
* this file, You can obtain one at http://mozilla.org/MPL/2.0/.
*
* Alternatively, you can redistribute and/or that part of this file
* under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program.  If not, see http://www.gnu.org/licenses/.
*/

/*****
*  You can find the complete source code of the JessyInk project at:
*  @source http://code.google.com/p/jessyink/
*/

/*****
* @licend
*
* The above is the license notice for the part of JavaScript code of this
* page included between the '@jessyinkstart' and the '@jessyinkend' notes.
*/


/*****
* @jessyinkstart
*
*  The following code is a derivative work of some parts of the JessyInk
*  project.
*  @source http://code.google.com/p/jessyink/
*/

function getElementsByProperty( node, name )
{
var elements = [];

if( node.getAttribute( name ) )
elements.push( node );

for( var counter = 0; counter < node.childNodes.length; ++counter )
{
if( node.childNodes[counter].nodeType == 1 )
{
var subElements = getElementsByProperty( node.childNodes[counter], name );
elements = elements.concat( subElements );
}
}
return elements;
}

function onKeyDown( aEvt )
{
if ( !aEvt )
aEvt = window.event;

var code = aEvt.keyCode || aEvt.charCode;

if( !processingEffect && keyCodeDictionary[currentMode] && keyCodeDictionary[currentMode][code] )
{
return keyCodeDictionary[currentMode][code]();
}
else
{
document.onkeypress = onKeyPress;
return null;
}
}
document.onkeydown = onKeyDown;

function onKeyPress( aEvt )
{
document.onkeypress = null;

if ( !aEvt )
aEvt = window.event;

var str = String.fromCharCode( aEvt.keyCode || aEvt.charCode );

if ( !processingEffect && charCodeDictionary[currentMode] && charCodeDictionary[currentMode][str] )
return charCodeDictionary[currentMode][str]();

return null;
}

function getDefaultKeyCodeDictionary()
{
var keyCodeDict = {};

keyCodeDict[SLIDE_MODE] = {};
keyCodeDict[INDEX_MODE] = {};

keyCodeDict[SLIDE_MODE][LEFT_KEY]
= function() { return aSlideShow.rewindEffect(); };
keyCodeDict[SLIDE_MODE][RIGHT_KEY]
= function() { return dispatchEffects(1); };
keyCodeDict[SLIDE_MODE][UP_KEY]
= function() { return aSlideShow.rewindEffect(); };
keyCodeDict[SLIDE_MODE][DOWN_KEY]
= function() { return skipEffects(1); };
keyCodeDict[SLIDE_MODE][PAGE_UP_KEY]
= function() { return aSlideShow.rewindAllEffects(); };
keyCodeDict[SLIDE_MODE][PAGE_DOWN_KEY]
= function() { return skipAllEffects(); };
keyCodeDict[SLIDE_MODE][HOME_KEY]
= function() { return aSlideShow.displaySlide( 0, true ); };
keyCodeDict[SLIDE_MODE][END_KEY]
= function() { return aSlideShow.displaySlide( theMetaDoc.nNumberOfSlides - 1, true ); };
keyCodeDict[SLIDE_MODE][SPACE_KEY]
= function() { return dispatchEffects(1); };

keyCodeDict[INDEX_MODE][LEFT_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex - 1 ); };
keyCodeDict[INDEX_MODE][RIGHT_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex + 1 ); };
keyCodeDict[INDEX_MODE][UP_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex - theSlideIndexPage.indexColumns ); };
keyCodeDict[INDEX_MODE][DOWN_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex + theSlideIndexPage.indexColumns ); };
keyCodeDict[INDEX_MODE][PAGE_UP_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex - theSlideIndexPage.getTotalThumbnails() ); };
keyCodeDict[INDEX_MODE][PAGE_DOWN_KEY]
= function() { return indexSetPageSlide( theSlideIndexPage.selectedSlideIndex + theSlideIndexPage.getTotalThumbnails() ); };
keyCodeDict[INDEX_MODE][HOME_KEY]
= function() { return indexSetPageSlide( 0 ); };
keyCodeDict[INDEX_MODE][END_KEY]
= function() { return indexSetPageSlide( theMetaDoc.nNumberOfSlides - 1 ); };
keyCodeDict[INDEX_MODE][ENTER_KEY]
= function() { return toggleSlideIndex(); };
keyCodeDict[INDEX_MODE][SPACE_KEY]
= function() { return toggleSlideIndex(); };
keyCodeDict[INDEX_MODE][ESCAPE_KEY]
= function() { return abandonIndexMode(); };

return keyCodeDict;
}

function getDefaultCharCodeDictionary()
{
var charCodeDict = {};

charCodeDict[SLIDE_MODE] = {};
charCodeDict[INDEX_MODE] = {};

charCodeDict[SLIDE_MODE]['i']
= function () { return toggleSlideIndex(); };

charCodeDict[INDEX_MODE]['i']
= function () { return toggleSlideIndex(); };
charCodeDict[INDEX_MODE]['-']
= function () { return theSlideIndexPage.decreaseNumberOfColumns(); };
charCodeDict[INDEX_MODE]['=']
= function () { return theSlideIndexPage.increaseNumberOfColumns(); };
charCodeDict[INDEX_MODE]['+']
= function () { return theSlideIndexPage.increaseNumberOfColumns(); };
charCodeDict[INDEX_MODE]['0']
= function () { return theSlideIndexPage.resetNumberOfColumns(); };

return charCodeDict;
}


function slideOnMouseUp( aEvt )
{
if (!aEvt)
aEvt = window.event;

var nOffset = 0;

if( aEvt.button == 0 )
nOffset = 1;
else if( aEvt.button == 2 )
nOffset = -1;

if( 0 != nOffset )
dispatchEffects( nOffset );
return true; // the click has been handled
}

document.handleClick = slideOnMouseUp;


function slideOnMouseWheel(aEvt)
{
var delta = 0;

if (!aEvt)
aEvt = window.event;

if (aEvt.wheelDelta)
{ // IE Opera
delta = aEvt.wheelDelta/120;
}
else if (aEvt.detail)
{ // MOZ
delta = -aEvt.detail/3;
}

if (delta > 0)
skipEffects(-1);
else if (delta < 0)
skipEffects(1);

if (aEvt.preventDefault)
aEvt.preventDefault();

aEvt.returnValue = false;
}

if( window.addEventListener )
{
window.addEventListener( 'DOMMouseScroll', function( aEvt ) { return mouseHandlerDispatch( aEvt, MOUSE_WHEEL ); }, false );
}

window.onmousewheel
= function( aEvt ) { return mouseHandlerDispatch( aEvt, MOUSE_WHEEL ); };

function mouseHandlerDispatch( aEvt, anAction )
{
if( !aEvt )
aEvt = window.event;

var retVal = true;

if ( mouseHandlerDictionary[currentMode] && mouseHandlerDictionary[currentMode][anAction] )
{
var subRetVal = mouseHandlerDictionary[currentMode][anAction]( aEvt );

if( subRetVal != null && subRetVal != undefined )
retVal = subRetVal;
}

if( aEvt.preventDefault && !retVal )
aEvt.preventDefault();

aEvt.returnValue = retVal;

return retVal;
}

document.onmouseup = function( aEvt ) { return mouseHandlerDispatch( aEvt, MOUSE_UP ); };


function mouseClickHelper( aEvt )
{
if( !Detect.isMozilla )
{
var aWindowObject = document.defaultView;
if( aWindowObject )
{
var aTextSelection = aWindowObject.getSelection();
var sSelectedText =  aTextSelection.toString();
if( sSelectedText )
{
DBGLOG( 'text selection: ' + sSelectedText );
if( sLastSelectedText !== sSelectedText )
{
bTextHasBeenSelected = true;
sLastSelectedText = sSelectedText;
}
else
{
bTextHasBeenSelected = false;
}
return null;
}
else if( bTextHasBeenSelected )
{
bTextHasBeenSelected = false;
sLastSelectedText = '';
return null;
}
}
else
{
log( 'error: HyperlinkElement.handleClick: invalid window object.' );
}
}

var aSlideAnimationsHandler = theMetaDoc.aMetaSlideSet[nCurSlide].aSlideAnimationsHandler;
if( aSlideAnimationsHandler )
{
var aCurrentEventMultiplexer = aSlideAnimationsHandler.aEventMultiplexer;
if( aCurrentEventMultiplexer )
{
if( aCurrentEventMultiplexer.hasRegisteredMouseClickHandlers() )
{
return aCurrentEventMultiplexer.notifyMouseClick( aEvt );
}
}
}
return slideOnMouseUp( aEvt );
}


function getDefaultMouseHandlerDictionary()
{
var mouseHandlerDict = {};

mouseHandlerDict[SLIDE_MODE] = {};
mouseHandlerDict[INDEX_MODE] = {};

mouseHandlerDict[SLIDE_MODE][MOUSE_UP]
= mouseClickHelper;

mouseHandlerDict[SLIDE_MODE][MOUSE_WHEEL]
= function( aEvt ) { return slideOnMouseWheel( aEvt ); };

mouseHandlerDict[INDEX_MODE][MOUSE_UP]
= function( aEvt ) { return toggleSlideIndex(); };

return mouseHandlerDict;
}

function indexSetPageSlide( nIndex )
{
var aMetaSlideSet = theMetaDoc.aMetaSlideSet;
nIndex = getSafeIndex( nIndex, 0, aMetaSlideSet.length - 1 );

var nSelectedThumbnailIndex = nIndex % theSlideIndexPage.getTotalThumbnails();
var offset = nIndex - nSelectedThumbnailIndex;

if( offset < 0 )
offset = 0;

if( offset != INDEX_OFFSET )
{
INDEX_OFFSET = offset;
displayIndex( INDEX_OFFSET );
}

theSlideIndexPage.setSelection( nSelectedThumbnailIndex );
}


/*****
* @jessyinkend
*
*  The above code is a derivative work of some parts of the JessyInk project.
*  @source http://code.google.com/p/jessyink/
*/


/*****
* @licstart
*
* The following is the license notice for the part of JavaScript code of this
* page included between the '@dojostart' and the '@dojoend' notes.
*/

/*****  **********************************************************************
*
*  The 'New' BSD License:
*  **********************
*  Copyright (c) 2005-2012, The Dojo Foundation
*  All rights reserved.
*
*  Redistribution and use in source and binary forms, with or without
*  modification, are permitted provided that the following conditions are met:
*
*    * Redistributions of source code must retain the above copyright notice,
*      this list of conditions and the following disclaimer.
*    * Redistributions in binary form must reproduce the above copyright notice,
*      this list of conditions and the following disclaimer in the documentation
*      and/or other materials provided with the distribution.
*    * Neither the name of the Dojo Foundation nor the names of its contributors
*      may be used to endorse or promote products derived from this software
*      without specific prior written permission.
*
*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND
*  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
*  DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
*  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
*  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
*  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
*  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
*  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
*  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
****************************************************************************/


/*****
* @licend
*
* The above is the license notice for the part of JavaScript code of this
* page included between the '@dojostart' and the '@dojoend' notes.
*/


/*****
* @dojostart
*
*  The following code is a derivative work of some part of the dojox.gfx library.
*  @source http://svn.dojotoolkit.org/src/dojox/trunk/_base/sniff.js
*/

function has( name )
{
return has.cache[name];
}

has.cache = {};

has.add = function( name, test )
{
has.cache[name] = test;
};

function configureDetectionTools()
{
if( !navigator )
{
log( 'error: configureDetectionTools: configuration failed' );
return null;
}

var n = navigator,
dua = n.userAgent,
dav = n.appVersion,
tv = parseFloat(dav);

has.add('air', dua.indexOf('AdobeAIR') >= 0);
has.add('khtml', dav.indexOf('Konqueror') >= 0 ? tv : undefined);
has.add('webkit', parseFloat(dua.split('WebKit/')[1]) || undefined);
has.add('chrome', parseFloat(dua.split('Chrome/')[1]) || undefined);
has.add('safari', dav.indexOf('Safari')>=0 && !has('chrome') ? parseFloat(dav.split('Version/')[1]) : undefined);
has.add('mac', dav.indexOf('Macintosh') >= 0);
has.add('quirks', document.compatMode == 'BackCompat');
has.add('ios', /iPhone|iPod|iPad/.test(dua));
has.add('android', parseFloat(dua.split('Android ')[1]) || undefined);

if(!has('webkit')){
if(dua.indexOf('Opera') >= 0){
has.add('opera', tv >= 9.8 ? parseFloat(dua.split('Version/')[1]) || tv : tv);
}

if(dua.indexOf('Gecko') >= 0 && !has('khtml') && !has('webkit')){
has.add('mozilla', tv);
}
if(has('mozilla')){
has.add('ff', parseFloat(dua.split('Firefox/')[1] || dua.split('Minefield/')[1]) || undefined);
}

if(document.all && !has('opera')){
var isIE = parseFloat(dav.split('MSIE ')[1]) || undefined;

var mode = document.documentMode;
if(mode && mode != 5 && Math.floor(isIE) != mode){
isIE = mode;
}

has.add('ie', isIE);
}

has.add('wii', typeof opera != 'undefined' && opera.wiiremote);
}

var detect =
{
isFF: has('ff'),

isIE: has('ie'),

isKhtml: has('khtml'),

isWebKit: has('webkit'),

isMozilla: has('mozilla'),
isMoz: has('mozilla'),

isOpera: has('opera'),

isSafari: has('safari'),

isChrome: has('chrome'),

isMac: has('mac'),

isIos: has('ios'),

isAndroid: has('android'),

isWii: has('wii'),

isQuirks: has('quirks'),

isAir: has('air')
};
return detect;
}

/*****
* @dojoend
*
*  The above code is a derivative work of some part of the dojox.gfx library.
*  @source http://svn.dojotoolkit.org/src/dojox/trunk/_base/sniff.js
*/


/*****
* @licstart
*
* The following is the license notice for the part of JavaScript code  of
* this page included between the '@libreofficestart' and the '@libreofficeend'
* notes.
*/

/*****  ******************************************************************
*
* This file is part of the LibreOffice project.
*
* This Source Code Form is subject to the terms of the Mozilla Public
* License, v. 2.0. If a copy of the MPL was not distributed with this
* file, You can obtain one at http://mozilla.org/MPL/2.0/.
*
* This file incorporates work covered by the following license notice:
*
*   Licensed to the Apache Software Foundation (ASF) under one or more
*   contributor license agreements. See the NOTICE file distributed
*   with this work for additional information regarding copyright
*   ownership. The ASF licenses this file to you under the Apache
*   License, Version 2.0 (the 'License'); you may not use this file
*   except in compliance with the License. You may obtain a copy of
*   the License at http://www.apache.org/licenses/LICENSE-2.0 .
*
************************************************************************/

/*****
* @licend
*
* The above is the license notice for the part of JavaScript code  of
* this page included between the '@libreofficestart' and the '@libreofficeend'
* notes.
*/


/*****
* @libreofficestart
*
* Several parts of the following code are the result of the porting,
* started on August 2011, of the C++ code included in the source
* files placed under the folder '/slideshow/source' and
* sub-folders. This got later rebased onto the AL2-licensed versions
* of those files in early 2013.
* @source http://cgit.freedesktop.org/libreoffice/core/tree/slideshow/source
*
*/


window.onload = init;


var aOOOElemMetaSlides = 'ooo:meta_slides';
var aOOOElemMetaSlide = 'ooo:meta_slide';
var aOOOElemTextField = 'ooo:text_field';
var aPresentationClipPathId = 'presentation_clip_path';
var aPresentationClipPathShrinkId = 'presentation_clip_path_shrink';

var aOOOAttrNumberOfSlides = 'number-of-slides';
var aOOOAttrStartSlideNumber= 'start-slide-number';
var aOOOAttrNumberingType = 'page-numbering-type';
var aOOOAttrListItemNumberingType= 'numbering-type';
var aOOOAttrUsePositionedChars = 'use-positioned-chars';

var aOOOAttrSlide = 'slide';
var aOOOAttrMaster = 'master';
var aOOOAttrHasTransition = 'has-transition';
var aOOOAttrBackgroundVisibility = 'background-visibility';
var aOOOAttrMasterObjectsVisibility = 'master-objects-visibility';
var aOOOAttrPageNumberVisibility = 'page-number-visibility';
var aOOOAttrDateTimeVisibility = 'date-time-visibility';
var aOOOAttrFooterVisibility = 'footer-visibility';
var aOOOAttrHeaderVisibility = 'header-visibility';
var aOOOAttrDateTimeField = 'date-time-field';
var aOOOAttrFooterField = 'footer-field';
var aOOOAttrHeaderField = 'header-field';

var aOOOAttrDateTimeFormat = 'date-time-format';

var aOOOAttrTextAdjust = 'text-adjust';

var aClipPathGroupClassName = 'ClipPathGroup';
var aPageClassName = 'Page';
var aSlideNumberClassName = 'Slide_Number';
var aDateTimeClassName = 'Date/Time';
var aFooterClassName = 'Footer';
var aHeaderClassName = 'Header';

var NSS = {};
NSS['svg']='http://www.w3.org/2000/svg';
NSS['rdf']='http://www.w3.org/1999/02/22-rdf-syntax-ns#';
NSS['xlink']='http://www.w3.org/1999/xlink';
NSS['xml']='http://www.w3.org/XML/1998/namespace';
NSS['ooo'] = 'http://xml.openoffice.org/svg/export';
NSS['presentation'] = 'http://sun.com/xmlns/staroffice/presentation';
NSS['smil'] = 'http://www.w3.org/2001/SMIL20/';
NSS['anim'] = 'urn:oasis:names:tc:opendocument:xmlns:animation:1.0';

var SLIDE_MODE = 1;
var INDEX_MODE = 2;

var MOUSE_UP = 1;
var MOUSE_DOWN = 2;
var MOUSE_MOVE = 3;
var MOUSE_WHEEL = 4;

var LEFT_KEY = 37;          // cursor left keycode
var UP_KEY = 38;            // cursor up keycode
var RIGHT_KEY = 39;         // cursor right keycode
var DOWN_KEY = 40;          // cursor down keycode
var PAGE_UP_KEY = 33;       // page up keycode
var PAGE_DOWN_KEY = 34;     // page down keycode
var HOME_KEY = 36;          // home keycode
var END_KEY = 35;           // end keycode
var ENTER_KEY = 13;
var SPACE_KEY = 32;
var ESCAPE_KEY = 27;

var HIDDEN = 0;
var VISIBLE = 1;
var INHERIT = 2;
var aVisibilityAttributeValue = [ 'hidden', 'visible', 'inherit' ];
var aVisibilityValue = { 'hidden' : HIDDEN, 'visible' : VISIBLE, 'inherit' : INHERIT };

var ROOT_NODE = document.getElementsByTagNameNS( NSS['svg'], 'svg' )[0];
var WIDTH = 0;
var HEIGHT = 0;
var INDEX_COLUMNS_DEFAULT = 3;
var INDEX_OFFSET = 0;

var Detect = configureDetectionTools();
var theMetaDoc;
var theSlideIndexPage;
var currentMode = SLIDE_MODE;
var processingEffect = false;
var nCurSlide = undefined;
var bTextHasBeenSelected = false;
var sLastSelectedText = '';


var charCodeDictionary = getDefaultCharCodeDictionary();
var keyCodeDictionary = getDefaultKeyCodeDictionary();

var mouseHandlerDictionary = getDefaultMouseHandlerDictionary();


function object( aObject )
{
var F = function() {};
F.prototype = aObject;
return new F();
}


function extend( aSubType, aSuperType )
{
if (!aSuperType || !aSubType)
{
alert('extend failed, verify dependencies');
}
var OP = Object.prototype;
var sp = aSuperType.prototype;
var rp = object( sp );
aSubType.prototype = rp;

rp.constructor = aSubType;
aSubType.superclass = sp;

if (aSuperType != Object && sp.constructor == OP.constructor)
{
sp.constructor = aSuperType;
}

return aSubType;
}


function instantiate( TemplateClass, BaseType )
{
if( !TemplateClass.instanceSet )
TemplateClass.instanceSet = [];

var nSize = TemplateClass.instanceSet.length;

for( var i = 0; i < nSize; ++i )
{
if( TemplateClass.instanceSet[i].base === BaseType )
return TemplateClass.instanceSet[i].instance;
}

TemplateClass.instanceSet[ nSize ] = {};
TemplateClass.instanceSet[ nSize ].base = BaseType;
TemplateClass.instanceSet[ nSize ].instance = TemplateClass( BaseType );

return TemplateClass.instanceSet[ nSize ].instance;
}


function Rectangle( aSVGRectElem )
{
var x = parseInt( aSVGRectElem.getAttribute( 'x' ) );
var y = parseInt( aSVGRectElem.getAttribute( 'y' ) );
var width = parseInt( aSVGRectElem.getAttribute( 'width' ) );
var height = parseInt( aSVGRectElem.getAttribute( 'height' ) );

this.left = x;
this.right = x + width;
this.top = y;
this.bottom = y + height;
}

function log( message )
{
if( typeof console == 'object' )
{
console.log( message );
}
else if( typeof opera == 'object' )
{
opera.postError( message );
}
else if( typeof java == 'object' && typeof java.lang == 'object' )
{
java.lang.System.out.println( message );
}
}

function warning( bCondition, sMessage )
{
if( bCondition )
log( sMessage );
return bCondition;
}

function getNSAttribute( sNSPrefix, aElem, sAttrName )
{
if( !aElem ) return null;
if( 'getAttributeNS' in aElem )
{
return aElem.getAttributeNS( NSS[sNSPrefix], sAttrName );
}
else
{
return aElem.getAttribute( sNSPrefix + ':' + sAttrName );
}
}

function getOOOAttribute( aElem, sAttrName )
{
return getNSAttribute( 'ooo', aElem, sAttrName );
}

function setNSAttribute( sNSPrefix, aElem, sAttrName, aValue )
{
if( !aElem ) return false;
if( 'setAttributeNS' in aElem )
{
aElem.setAttributeNS( NSS[sNSPrefix], sAttrName, aValue );
return true;
}
else
{
aElem.setAttribute(sNSPrefix + ':' + sAttrName, aValue );
return true;
}
}

function setOOOAttribute( aElem, sAttrName, aValue )
{
return setNSAttribute( 'ooo', aElem, sAttrName, aValue );
}

function checkElemAndSetAttribute( aElem, sAttrName, aValue )
{
if( aElem )
aElem.setAttribute( sAttrName, aValue );
}

function getElementsByClassName( aElem, sClassName )
{

var aElementSet = [];
if( 'getElementsByClassName' in aElem )
{
aElementSet = aElem.getElementsByClassName( sClassName );
}
else
{
var aElementSetByClassProperty = getElementsByProperty( aElem, 'class' );
for( var i = 0; i < aElementSetByClassProperty.length; ++i )
{
var sAttrClassName = aElementSetByClassProperty[i].getAttribute( 'class' );
if( sAttrClassName == sClassName )
{
aElementSet.push( aElementSetByClassProperty[i] );
}
}
}
return aElementSet;
}

function getElementByClassName( aElem, sClassName /*, sTagName */)
{
var aElementSet = getElementsByClassName( aElem, sClassName );
if ( aElementSet.length == 1 )
return aElementSet[0];
else
return null;
}

function getClassAttribute(  aElem )
{
if( aElem )
return aElem.getAttribute( 'class' );
return '';
}

function createElementGroup( aParentElement, aElementList, nFrom, nCount, sGroupClass, sGroupId )
{
var nTo = nFrom + nCount;
if( nCount < 1 || aElementList.length < nTo )
{
log( 'createElementGroup: not enough elements available.' );
return;
}
var firstElement = aElementList[nFrom];
if( !firstElement )
{
log( 'createElementGroup: element not found.' );
return;
}
var aGroupElement = document.createElementNS( NSS['svg'], 'g' );
if( sGroupId )
aGroupElement.setAttribute( 'id', sGroupId );
if( sGroupClass )
aGroupElement.setAttribute( 'class', sGroupClass );
aParentElement.insertBefore( aGroupElement, firstElement );
var i = nFrom;
for( ; i < nTo; ++i )
{
aParentElement.removeChild( aElementList[i] );
aGroupElement.appendChild( aElementList[i] );
}
}

function initVisibilityProperty( aElement )
{
var nVisibility = VISIBLE;
var sVisibility = aElement.getAttribute( 'visibility' );
if( sVisibility ) nVisibility = aVisibilityValue[ sVisibility ];
return nVisibility;
}

function setElementVisibility( aElement, nCurrentVisibility, nNewVisibility )
{
if( nCurrentVisibility !=  nNewVisibility )
{
checkElemAndSetAttribute( aElement, 'visibility', aVisibilityAttributeValue[nNewVisibility] );
return nNewVisibility;
}
return nCurrentVisibility;
}

function getSafeIndex( nIndex, nMin, nMax )
{
if( nIndex < nMin )
return nMin;
else if( nIndex > nMax )
return nMax;
else
return nIndex;
}

function getRandomInt( nMax )
{
return Math.floor( Math.random() * nMax );
}

function isTextFieldElement( aElement )
{
var sClassName = aElement.getAttribute( 'class' );
return ( sClassName === aSlideNumberClassName ) ||
( sClassName === aFooterClassName ) ||
( sClassName === aHeaderClassName ) ||
( sClassName === aDateTimeClassName );
}


function DebugPrinter()
{
this.bEnabled = false;
}


DebugPrinter.prototype.on = function()
{
this.bEnabled = true;
};

DebugPrinter.prototype.off = function()
{
this.bEnabled = false;
};

DebugPrinter.prototype.isEnabled = function()
{
return this.bEnabled;
};

DebugPrinter.prototype.print = function( sMessage, nTime )
{
if( this.isEnabled() )
{
var sInfo = 'DBG: ' + sMessage;
if( nTime )
sInfo += ' (at: ' + String( nTime / 1000 ) + 's)';
log( sInfo );
}
};


var aGenericDebugPrinter = new DebugPrinter();
aGenericDebugPrinter.off();
var DBGLOG = bind2( DebugPrinter.prototype.print, aGenericDebugPrinter );

var NAVDBG = new DebugPrinter();
NAVDBG.off();

var ANIMDBG = new DebugPrinter();
ANIMDBG.off();

var aRegisterEventDebugPrinter = new DebugPrinter();
aRegisterEventDebugPrinter.off();

var aTimerEventQueueDebugPrinter = new DebugPrinter();
aTimerEventQueueDebugPrinter.off();

var aEventMultiplexerDebugPrinter = new DebugPrinter();
aEventMultiplexerDebugPrinter.off();

var aNextEffectEventArrayDebugPrinter = new DebugPrinter();
aNextEffectEventArrayDebugPrinter.off();

var aActivityQueueDebugPrinter = new DebugPrinter();
aActivityQueueDebugPrinter.off();

var aAnimatedElementDebugPrinter = new DebugPrinter();
aAnimatedElementDebugPrinter.off();


function MetaDocument()
{
var aMetaDocElem = document.getElementById( aOOOElemMetaSlides );
assert( aMetaDocElem, 'MetaDocument: the svg element with id:' + aOOOElemMetaSlides + 'is not valid.');

this.nNumberOfSlides = parseInt( aMetaDocElem.getAttributeNS( NSS['ooo'], aOOOAttrNumberOfSlides ) );
assert( typeof this.nNumberOfSlides == 'number' && this.nNumberOfSlides > 0,
'MetaDocument: number of slides is zero or undefined.' );
this.nStartSlideNumber = parseInt( aMetaDocElem.getAttributeNS( NSS['ooo'], aOOOAttrStartSlideNumber ) ) || 0;
this.sPageNumberingType = aMetaDocElem.getAttributeNS( NSS['ooo'], aOOOAttrNumberingType ) || 'arabic';
this.bIsUsePositionedChars = ( aMetaDocElem.getAttributeNS( NSS['ooo'], aOOOAttrUsePositionedChars ) === 'true' );

this.aClipPathGroup = getElementByClassName( ROOT_NODE, aClipPathGroupClassName );
assert( this.aClipPathGroup, 'MetaDocument: the clip path group element is not valid.');

this.aPresentationClipPath = document.getElementById( aPresentationClipPathId );
assert( this.aPresentationClipPath,
'MetaDocument: the presentation clip path element element is not valid.');

this.aMetaSlideSet = [];
this.aMasterPageSet = {};
this.aTextFieldHandlerSet = {};
this.aTextFieldContentProviderSet = [];
this.aSlideNumberProvider = new SlideNumberProvider( this.nStartSlideNumber + 1, this.sPageNumberingType );

this.bIsAnimated = false;
this.aSlideAnimationsMap = {};
this.initSlideAnimationsMap();

this.theMetaDummySlide = new MetaSlide( 'ooo:meta_dummy_slide', this );

for( var i = 0; i < this.nNumberOfSlides; ++i )
{
var sMetaSlideId = aOOOElemMetaSlide + '_' + i;
this.aMetaSlideSet.push( new MetaSlide( sMetaSlideId, this ) );
}
assert( this.aMetaSlideSet.length == this.nNumberOfSlides,
'MetaDocument: aMetaSlideSet.length != nNumberOfSlides.' );
}

MetaDocument.prototype =
{

getCurrentSlide : function()
{
return this.aMetaSlideSet[nCurSlide];
},

setCurrentSlide : function( nSlideIndex )
{
if( nSlideIndex >= 0 &&  nSlideIndex < this.nNumberOfSlides )
{
if( nCurSlide !== undefined )
this.aMetaSlideSet[nCurSlide].hide();
this.aMetaSlideSet[nSlideIndex].show();
nCurSlide = nSlideIndex;
}
else
{
log('MetaDocument.setCurrentSlide: slide index out of range: ' + nSlideIndex );
}
},


initSlideAnimationsMap : function()
{
var aAnimationsSection = document.getElementById( 'presentation-animations' );
if( aAnimationsSection )
{
var aAnimationsDefSet = aAnimationsSection.getElementsByTagName( 'defs' );

this.bIsAnimated = ( typeof aAnimationsDefSet.length =='number' &&
aAnimationsDefSet.length > 0 );

for( var i = 0; i < aAnimationsDefSet.length; ++i )
{
var sSlideId = aAnimationsDefSet[i].getAttributeNS( NSS['ooo'], aOOOAttrSlide );
var aChildSet = getElementChildren( aAnimationsDefSet[i] );
if( sSlideId && ( aChildSet.length === 1 ) )
{
this.aSlideAnimationsMap[ sSlideId ] = aChildSet[0];
}
}
}
}

}; // end MetaDocument prototype

function MetaSlide( sMetaSlideId, aMetaDoc )
{
this.theDocument = document;
this.id = sMetaSlideId;
this.theMetaDoc = aMetaDoc;

this.element = this.theDocument.getElementById( this.id );
assert( this.element,
'MetaSlide: meta_slide element <' + this.id + '> not found.' );

this.slideId = this.element.getAttributeNS( NSS['ooo'], aOOOAttrSlide );
this.slideElement = this.theDocument.getElementById( this.slideId );
assert( this.slideElement,
'MetaSlide: slide element <' + this.slideId + '> not found.' );

if( this.slideId !== 'dummy_slide' )
this.nSlideNumber = parseInt( this.slideId.substr(2) );
else
this.nSlideNumber= -1;

this.aContainerElement = this.slideElement.parentNode;
this.slideContainerId = this.aContainerElement.getAttribute( 'id' );
this.aVisibilityStatusElement = this.aContainerElement.parentNode;

this.pageElement = getElementByClassName( this.slideElement, aPageClassName );
assert( this.pageElement,
'MetaSlide: page element <' + this.slideId + '> not found.' );

this.masterPage = this.initMasterPage();

this.nAreMasterObjectsVisible     = this.initVisibilityProperty( aOOOAttrMasterObjectsVisibility,  VISIBLE );
this.nIsBackgroundVisible         = this.initVisibilityProperty( aOOOAttrBackgroundVisibility,     VISIBLE );
this.nIsPageNumberVisible         = this.initVisibilityProperty( aOOOAttrPageNumberVisibility,     HIDDEN );
this.nIsDateTimeVisible           = this.initVisibilityProperty( aOOOAttrDateTimeVisibility,       VISIBLE );
this.nIsFooterVisible             = this.initVisibilityProperty( aOOOAttrFooterVisibility,         VISIBLE );
this.nIsHeaderVisible             = this.initVisibilityProperty( aOOOAttrHeaderVisibility,         VISIBLE );

this.bIsDateTimeVariable = undefined;

this.aTextFieldContentProviderSet = {};
this.aTextFieldContentProviderSet[aSlideNumberClassName]   = this.initSlideNumberFieldContentProvider();
this.aTextFieldContentProviderSet[aDateTimeClassName]      = this.initDateTimeFieldContentProvider( aOOOAttrDateTimeField );
this.aTextFieldContentProviderSet[aFooterClassName]        = this.initFixedTextFieldContentProvider( aOOOAttrFooterField );
this.aTextFieldContentProviderSet[aHeaderClassName]        = this.initFixedTextFieldContentProvider( aOOOAttrHeaderField );

this.aTransitionHandler = null;
this.bHasTransition = this.initHasTransition() || true;
if( this.bHasTransition )
{
this.aTransitionHandler = new SlideTransition( this.getSlideAnimationsRoot(), this.slideId );
}

this.aSlideAnimationsHandler = new SlideAnimations( aSlideShow.getContext() );
this.aSlideAnimationsHandler.importAnimations( this.getSlideAnimationsRoot() );
this.aSlideAnimationsHandler.parseElements();

if( false && this.aSlideAnimationsHandler.aRootNode )
log( this.aSlideAnimationsHandler.aRootNode.info( true ) );

this.aTextShapeSet = this.collectTextShapes();

this.aHyperlinkSet = this.initHyperlinks();

}

MetaSlide.prototype =
{

show : function()
{
this.updateMasterPageView();
this.aVisibilityStatusElement.setAttribute( 'visibility', 'inherit' );
},

hide : function()
{
this.aVisibilityStatusElement.setAttribute( 'visibility', 'hidden' );
},

updateMasterPageView : function()
{
if( !this.aMasterPageView )
{
this.aMasterPageView = new MasterPageView( this );
this.aMasterPageView.attachToSlide();
}
this.aMasterPageView.update();
},

initMasterPage : function()
{
var sMasterPageId = this.element.getAttributeNS( NSS['ooo'], aOOOAttrMaster );

if( !this.theMetaDoc.aMasterPageSet.hasOwnProperty( sMasterPageId ) )
{
this.theMetaDoc.aMasterPageSet[ sMasterPageId ] = new MasterPage( sMasterPageId, this );

this.theMetaDoc.aTextFieldHandlerSet[ sMasterPageId ] = {};
}
return this.theMetaDoc.aMasterPageSet[ sMasterPageId ];
},

initHasTransition : function()
{
var sHasTransition = this.element.getAttributeNS( NSS['ooo'], aOOOAttrHasTransition );
return ( sHasTransition === 'true' );
},

initVisibilityProperty : function( aVisibilityAttribute, nDefaultValue )
{
var nVisibility = nDefaultValue;
var sVisibility = getOOOAttribute( this.element, aVisibilityAttribute );
if( sVisibility )
nVisibility = aVisibilityValue[ sVisibility ];
return nVisibility;
},

initSlideNumberFieldContentProvider : function()
{
return this.theMetaDoc.aSlideNumberProvider;
},

initDateTimeFieldContentProvider : function( aOOOAttrDateTimeField )
{
var sTextFieldId = getOOOAttribute( this.element, aOOOAttrDateTimeField );
if( !sTextFieldId )  return null;

var nLength = aOOOElemTextField.length + 1;
var nIndex = parseInt(sTextFieldId.substring( nLength ) );
if( typeof nIndex != 'number') return null;

if( !this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ] )
{
var aTextField;
var aTextFieldElem = document.getElementById( sTextFieldId );
var sClassName = getClassAttribute( aTextFieldElem );
if( sClassName == 'FixedDateTimeField' )
{
aTextField = new FixedTextProvider( aTextFieldElem );
this.bIsDateTimeVariable = false;
}
else if( sClassName == 'VariableDateTimeField' )
{
aTextField = new CurrentDateTimeProvider( aTextFieldElem );
this.bIsDateTimeVariable = true;
}
else
{
aTextField = null;
}
this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ] = aTextField;
}
return this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ];
},

initFixedTextFieldContentProvider : function( aOOOAttribute )
{
var sTextFieldId = getOOOAttribute( this.element, aOOOAttribute );
if( !sTextFieldId ) return null;

var nLength = aOOOElemTextField.length + 1;
var nIndex = parseInt( sTextFieldId.substring( nLength ) );
if( typeof nIndex != 'number') return null;

if( !this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ] )
{
var aTextFieldElem = document.getElementById( sTextFieldId );
this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ]
= new FixedTextProvider( aTextFieldElem );
}
return this.theMetaDoc.aTextFieldContentProviderSet[ nIndex ];
},

collectTextShapes : function()
{
var aTextShapeSet = [];
var aTextShapeIndexElem = getElementByClassName( document, 'TextShapeIndex' );
if( aTextShapeIndexElem )
{
var aIndexEntryList = getElementChildren( aTextShapeIndexElem );
var i;
for( i = 0; i < aIndexEntryList.length; ++i )
{
var sSlideId = getOOOAttribute( aIndexEntryList[i], 'slide' );
if( sSlideId === this.slideId )
{
var sTextShapeIds = getOOOAttribute( aIndexEntryList[i], 'id-list' );
if( sTextShapeIds )
{
var aTextShapeIdSet =  sTextShapeIds.split( ' ' );
var j;
for( j = 0; j < aTextShapeIdSet.length; ++j )
{
var aTextShapeElem = document.getElementById( aTextShapeIdSet[j] );
if( aTextShapeElem )
{
aTextShapeSet.push( aTextShapeElem );
}
else
{
log( 'warning: MetaSlide.collectTextShapes: text shape with id <' + aTextShapeIdSet[j] + '> is not valid.'  );
}
}
}
break;
}
}
}
return aTextShapeSet;
},

initHyperlinks : function()
{
var aHyperlinkSet = {};
var i;
for( i = 0; i < this.aTextShapeSet.length; ++i )
{
if( this.aTextShapeSet[i] )
{
var aHyperlinkIdList = getElementByClassName( this.aTextShapeSet[i], 'HyperlinkIdList' );
if( aHyperlinkIdList )
{
var sHyperlinkIds = aHyperlinkIdList.textContent;
if( sHyperlinkIds )
{
var aHyperlinkIdSet = sHyperlinkIds.trim().split( ' ' );
var j;
for( j = 0; j < aHyperlinkIdSet.length; ++j )
{
var sId = aHyperlinkIdSet[j];
aHyperlinkSet[ sId ] = new HyperlinkElement( sId, this.aSlideAnimationsHandler.aEventMultiplexer );
}
}
}
}
}
return aHyperlinkSet;
},

getSlideAnimationsRoot : function()
{
return this.theMetaDoc.aSlideAnimationsMap[ this.slideId ];
}

}; // end MetaSlide prototype

function MasterPage( sMasterPageId, aMetaSlide )
{
this.id = sMasterPageId;
this.metaSlide = aMetaSlide;

this.element = document.getElementById( this.id );
assert( this.element,
'MasterPage: master page element <' + this.id + '> not found.' );

this.background = getElementByClassName( this.element, 'Background' );
if( this.background )
{
this.backgroundId = this.background.getAttribute( 'id' );
this.backgroundVisibility = initVisibilityProperty( this.background );
}
else
{
this.backgroundId = '';
log( 'MasterPage: the background element is not valid.' );
}

this.backgroundObjects = getElementByClassName( this.element, 'BackgroundObjects' );
if( this.backgroundObjects )
{
this.backgroundObjectsId = this.backgroundObjects.getAttribute( 'id' );
this.backgroundObjectsVisibility = initVisibilityProperty( this.backgroundObjects );

if( this.backgroundObjectsVisibility != HIDDEN )
{
var aBackgroundObjectList = getElementChildren( this.backgroundObjects );
var nFrom = 0;
var nCount = 0;
var nSubGroupId = 1;
var sClass;
var sId = '';
this.aBackgroundObjectSubGroupIdList = [];
var i = 0;
for( ; i < aBackgroundObjectList.length; ++i )
{
sClass = aBackgroundObjectList[i].getAttribute( 'class' );
if( !sClass || ( ( sClass !== aDateTimeClassName ) && ( sClass !== aFooterClassName )
&& ( sClass !== aHeaderClassName ) && ( sClass !== aSlideNumberClassName ) ) )
{
if( nCount === 0 )
{
nFrom = i;
sId = this.backgroundObjectsId + '.' + nSubGroupId;
++nSubGroupId;
this.aBackgroundObjectSubGroupIdList.push( sId );
}
++nCount;
}
else
{
this.aBackgroundObjectSubGroupIdList.push( sClass );
if( nCount !== 0 )
{
createElementGroup( this.backgroundObjects, aBackgroundObjectList, nFrom, nCount, 'BackgroundObjectSubgroup', sId );
nCount = 0;
}
}
}
if( nCount !== 0 )
{
createElementGroup( this.backgroundObjects, aBackgroundObjectList, nFrom, nCount, 'BackgroundObjectSubgroup', sId );
}
}
}
else
{
this.backgroundObjectsId = '';
log( 'MasterPage: the background objects element is not valid.' );
}

this.aPlaceholderShapeSet = {};
this.initPlaceholderShapes();
}

MasterPage.prototype =
{

initPlaceholderShapes : function()
{
this.aPlaceholderShapeSet[ aSlideNumberClassName ] = new PlaceholderShape( this, aSlideNumberClassName );
this.aPlaceholderShapeSet[ aDateTimeClassName ] = new PlaceholderShape( this, aDateTimeClassName );
this.aPlaceholderShapeSet[ aFooterClassName ] = new PlaceholderShape( this, aFooterClassName );
this.aPlaceholderShapeSet[ aHeaderClassName ] = new PlaceholderShape( this, aHeaderClassName );
}

}; // end MasterPage prototype

function PlaceholderShape( aMasterPage, sClassName )
{
this.masterPage = aMasterPage;
this.className = sClassName;

this.element = null;
this.textElement = null;
this.init();
}

PlaceholderShape.prototype.isValid = function()
{
return ( this.element && this.textElement );
};


PlaceholderShape.prototype.init = function()
{

var aTextFieldElement = getElementByClassName( this.masterPage.backgroundObjects, this.className );
if( aTextFieldElement )
{
var aPlaceholderElement = getElementByClassName( aTextFieldElement, 'PlaceholderText' );
if( aPlaceholderElement )
{
var aSVGRectElem = getElementByClassName( aTextFieldElement, 'BoundingBox' );
if( aSVGRectElem )
{
var aRect = new Rectangle( aSVGRectElem );
var sTextAdjust = getOOOAttribute( aTextFieldElement, aOOOAttrTextAdjust ) || 'left';
var sTextAnchor, sX;
if( sTextAdjust == 'left' )
{
sTextAnchor = 'start';
sX = String( aRect.left );
}
else if( sTextAdjust == 'right' )
{
sTextAnchor = 'end';
sX = String( aRect.right );
}
else if( sTextAdjust == 'center' )
{
sTextAnchor = 'middle';
var nMiddle = ( aRect.left + aRect.right ) / 2;
sX = String( parseInt( String( nMiddle ) ) );
}
if( sTextAnchor )
aPlaceholderElement.setAttribute( 'text-anchor', sTextAnchor );
if( sX )
aPlaceholderElement.setAttribute( 'x', sX );
}

if( this.masterPage.metaSlide.theMetaDoc.bIsUsePositionedChars )
{
var aTextLineGroupElem = aPlaceholderElement.parentNode.parentNode;
if( aTextLineGroupElem )
{
var sFontFamilyAttr = aTextLineGroupElem.getAttribute( 'font-family' );
if( sFontFamilyAttr )
{
var aChildSet = getElementChildren( aTextLineGroupElem );
if( aChildSet.length > 1  )
var i = 1;
for( ; i < aChildSet.length; ++i )
{
aTextLineGroupElem.removeChild( aChildSet[i] );
}
}
}
}
this.element = aTextFieldElement;
this.textElement = aPlaceholderElement;
}
}
};

function MasterPageView( aMetaSlide )
{
this.aMetaSlide = aMetaSlide;
this.aSlideElement = aMetaSlide.slideElement;
this.aPageElement = aMetaSlide.pageElement;
this.aMasterPage = aMetaSlide.masterPage;
this.aMPVElement = this.createElement();
this.bIsAttached = false;
}


MasterPageView.prototype.attachToSlide = function()
{
if( !this.bIsAttached )
{
var aInsertedElement = this.aSlideElement.insertBefore( this.aMPVElement, this.aPageElement );
assert( aInsertedElement === this.aMPVElement,
'MasterPageView.attachToSlide: aInsertedElement != this.aMPVElement' );

this.bIsAttached = true;
}
};

MasterPageView.prototype.detachFromSlide = function()
{
if( this.bIsAttached )
{
this.aSlideElement.removeChild( this.aMPVElement );
this.bIsAttached = false;
}
};

MasterPageView.prototype.update = function()
{
if( this.aDateTimeFieldHandler && this.aMetaSlide.bIsDateTimeVariable )
this.aDateTimeFieldHandler.update();
};


MasterPageView.prototype.createElement = function()
{
var theDocument = document;
var aMasterPageViewElement = theDocument.createElementNS( NSS['svg'], 'g' );
assert( aMasterPageViewElement,
'MasterPageView.createElement: failed to create a master page view element.' );
aMasterPageViewElement.setAttribute( 'class', 'MasterPageView' );

var aWhiteRect = theDocument.createElementNS( NSS['svg'], 'rect' );
var nWidthExt = WIDTH / 1000;
var nHeightExt = HEIGHT / 1000;
aWhiteRect.setAttribute( 'x', String( -nWidthExt / 2 ) );
aWhiteRect.setAttribute( 'y', String( -nHeightExt / 2 ) );
aWhiteRect.setAttribute( 'width', String( WIDTH + nWidthExt ) );
aWhiteRect.setAttribute( 'height', String( HEIGHT + nHeightExt ) );
aWhiteRect.setAttribute( 'fill', '#FFFFFF' );
aMasterPageViewElement.appendChild( aWhiteRect );

if( this.aMetaSlide.nIsBackgroundVisible )
{
this.aBackgroundElement = theDocument.createElementNS( NSS['svg'], 'use' );
this.aBackgroundElement.setAttribute( 'class', 'Background' );
setNSAttribute( 'xlink', this.aBackgroundElement,
'href', '#' + this.aMasterPage.backgroundId );

aMasterPageViewElement.appendChild( this.aBackgroundElement );
}

if( this.aMetaSlide.nAreMasterObjectsVisible )
{
this.aBackgroundObjectsElement = theDocument.createElementNS( NSS['svg'], 'g' );
this.aBackgroundObjectsElement.setAttribute( 'class', 'BackgroundObjects' );

var aBackgroundObjectSubGroupIdList = this.aMasterPage.aBackgroundObjectSubGroupIdList;
this.aBackgroundSubGroupElementSet = [];
var aPlaceholderShapeSet = this.aMasterPage.aPlaceholderShapeSet;
var aTextFieldContentProviderSet = this.aMetaSlide.aTextFieldContentProviderSet;
var aDefsElement = this.aMetaSlide.element.parentNode;
var aTextFieldHandlerSet = this.aMetaSlide.theMetaDoc.aTextFieldHandlerSet;
var sMasterSlideId = this.aMasterPage.id;

var i = 0;
var sId;
for( ; i < aBackgroundObjectSubGroupIdList.length; ++i )
{
sId = aBackgroundObjectSubGroupIdList[i];
if( sId === aSlideNumberClassName )
{
if( aPlaceholderShapeSet[aSlideNumberClassName] &&
aPlaceholderShapeSet[aSlideNumberClassName].isValid() &&
this.aMetaSlide.nIsPageNumberVisible &&
aTextFieldContentProviderSet[aSlideNumberClassName] )
{
this.aSlideNumberFieldHandler =
new SlideNumberFieldHandler( aPlaceholderShapeSet[aSlideNumberClassName],
aTextFieldContentProviderSet[aSlideNumberClassName] );
this.aSlideNumberFieldHandler.update( this.aMetaSlide.nSlideNumber );
this.aSlideNumberFieldHandler.appendTo( this.aBackgroundObjectsElement );
}
}
else if( sId === aDateTimeClassName )
{
if( this.aMetaSlide.nIsDateTimeVisible )
{
this.aDateTimeFieldHandler =
this.initTextFieldHandler( aDateTimeClassName, aPlaceholderShapeSet,
aTextFieldContentProviderSet, aDefsElement,
aTextFieldHandlerSet, sMasterSlideId );
}
}
else if( sId === aFooterClassName )
{
if( this.aMetaSlide.nIsFooterVisible )
{
this.aFooterFieldHandler =
this.initTextFieldHandler( aFooterClassName, aPlaceholderShapeSet,
aTextFieldContentProviderSet, aDefsElement,
aTextFieldHandlerSet, sMasterSlideId );
}
}
else if( sId === aHeaderClassName )
{
if( this.aMetaSlide.nIsHeaderVisible )
{
this.aHeaderFieldHandler =
this.initTextFieldHandler( aHeaderClassName, aPlaceholderShapeSet,
aTextFieldContentProviderSet, aDefsElement,
aTextFieldHandlerSet, sMasterSlideId );
}
}
else
{
var aBackgroundSubGroupElement = theDocument.createElementNS( NSS['svg'], 'use' );
aBackgroundSubGroupElement.setAttribute( 'class', 'BackgroundObjectSubGroup' );
setNSAttribute( 'xlink', aBackgroundSubGroupElement,
'href', '#' + sId );
this.aBackgroundSubGroupElementSet.push( aBackgroundSubGroupElement );
this.aBackgroundObjectsElement.appendChild( aBackgroundSubGroupElement );
}

}
aMasterPageViewElement.appendChild( this.aBackgroundObjectsElement );
}

return aMasterPageViewElement;
};

MasterPageView.prototype.initTextFieldHandler =
function( sClassName, aPlaceholderShapeSet, aTextFieldContentProviderSet,
aDefsElement, aTextFieldHandlerSet, sMasterSlideId )
{
var aTextFieldHandler = null;
if( aPlaceholderShapeSet[sClassName] &&
aPlaceholderShapeSet[sClassName].isValid()
&& aTextFieldContentProviderSet[sClassName] )
{
var sTextFieldContentProviderId = aTextFieldContentProviderSet[sClassName].sId;
if ( !aTextFieldHandlerSet[ sMasterSlideId ][ sTextFieldContentProviderId ] )
{
aTextFieldHandlerSet[ sMasterSlideId ][ sTextFieldContentProviderId ] =
new TextFieldHandler( aPlaceholderShapeSet[sClassName],
aTextFieldContentProviderSet[sClassName] );
aTextFieldHandler = aTextFieldHandlerSet[ sMasterSlideId ][ sTextFieldContentProviderId ];
aTextFieldHandler.update();
aTextFieldHandler.appendTo( aDefsElement );
}
else
{
aTextFieldHandler = aTextFieldHandlerSet[ sMasterSlideId ][ sTextFieldContentProviderId ];
}

var aTextFieldElement = document.createElementNS( NSS['svg'], 'use' );
aTextFieldElement.setAttribute( 'class', sClassName );
setNSAttribute( 'xlink', aTextFieldElement,
'href', '#' + aTextFieldHandler.sId );
this.aBackgroundObjectsElement.appendChild( aTextFieldElement );
}
return aTextFieldHandler;
};

function TextFieldHandler( aPlaceholderShape, aTextContentProvider )
{
this.aPlaceHolderShape = aPlaceholderShape;
this.aTextContentProvider = aTextContentProvider;
assert( this.aTextContentProvider,
'TextFieldHandler: text content provider not defined.' );
this.sId = 'tf' + String( TextFieldHandler.getUniqueId() );
this.aTextFieldElement = null;
this.aTextPlaceholderElement = null;
this.cloneElement();
}


TextFieldHandler.CURR_UNIQUE_ID = 0;

TextFieldHandler.getUniqueId = function()
{
++TextFieldHandler.CURR_UNIQUE_ID;
return TextFieldHandler.CURR_UNIQUE_ID;
};

TextFieldHandler.prototype.cloneElement = function()
{
assert( this.aPlaceHolderShape && this.aPlaceHolderShape.isValid(),
'TextFieldHandler.cloneElement: placeholder shape is not valid.' );
this.aTextFieldElement = this.aPlaceHolderShape.element.cloneNode( true /* deep clone */ );
assert( this.aTextFieldElement,
'TextFieldHandler.cloneElement: aTextFieldElement is not defined' );
this.aTextFieldElement.setAttribute( 'id', this.sId );
this.aTextFieldElement.removeAttribute( 'visibility' );
this.aTextPlaceholderElement = getElementByClassName( this.aTextFieldElement, 'PlaceholderText' );
assert( this.aTextPlaceholderElement,
'TextFieldHandler.cloneElement: aTextPlaceholderElement is not defined' );
};


TextFieldHandler.prototype.appendTo = function( aParentNode )
{
if( !this.aTextFieldElement )
{
log( 'TextFieldHandler.appendTo: aTextFieldElement is not defined' );
return;
}
if( !aParentNode )
{
log( 'TextFieldHandler.appendTo: parent node is not defined' );
return;
}

aParentNode.appendChild( this.aTextFieldElement );
};

TextFieldHandler.prototype.setTextContent = function( sText )
{
if( !this.aTextPlaceholderElement )
{
log( 'PlaceholderShape.setTextContent: text element is not valid in placeholder of type '
+ this.className + ' that belongs to master slide ' + this.masterPage.id );
return;
}
this.aTextPlaceholderElement.textContent = sText;
};

TextFieldHandler.prototype.update = function()
{
if( !this.aTextContentProvider )
log('TextFieldHandler.update: text content provider not defined.');
else
this.aTextContentProvider.update( this );
};

function SlideNumberFieldHandler( aPlaceholderShape, aTextContentProvider )
{
SlideNumberFieldHandler.superclass.constructor.call( this, aPlaceholderShape, aTextContentProvider );
}
extend( SlideNumberFieldHandler, TextFieldHandler );


SlideNumberFieldHandler.prototype.update = function( nPageNumber )
{
if( !this.aTextContentProvider )
log('TextFieldHandler.update: text content provider not defined.');
else
this.aTextContentProvider.update( this, nPageNumber );
};


function TextFieldContentProvider( aTextFieldContentElement )
{
if( aTextFieldContentElement )
this.sId = aTextFieldContentElement.getAttribute( 'id' );
}

function FixedTextProvider( aTextFieldContentElement )
{
FixedTextProvider.superclass.constructor.call( this, aTextFieldContentElement );
this.text = aTextFieldContentElement.textContent;
}
extend( FixedTextProvider, TextFieldContentProvider );


FixedTextProvider.prototype.update = function( aFixedTextField )
{
aFixedTextField.setTextContent( this.text );
};

function CurrentDateTimeProvider( aTextFieldContentElement )
{
CurrentDateTimeProvider.superclass.constructor.call( this, aTextFieldContentElement );
this.dateTimeFormat = getOOOAttribute( aTextFieldContentElement, aOOOAttrDateTimeFormat );
}
extend( CurrentDateTimeProvider, TextFieldContentProvider );


CurrentDateTimeProvider.prototype.update = function( aDateTimeField )
{
var sText = this.createDateTimeText( this.dateTimeFormat );
aDateTimeField.setTextContent( sText );
};


CurrentDateTimeProvider.prototype.createDateTimeText = function( sDateTimeFormat )
{
var aDate = new Date();
var sDate = aDate.toLocaleString();
return sDate;
};

function SlideNumberProvider( nInitialSlideNumber, sPageNumberingType )
{
SlideNumberProvider.superclass.constructor.call( this, null );
this.nInitialSlideNumber = nInitialSlideNumber;
this.pageNumberingType = sPageNumberingType;

}
extend( SlideNumberProvider, TextFieldContentProvider );


SlideNumberProvider.prototype.getNumberingType = function()
{
return this.pageNumberingType;
};


SlideNumberProvider.prototype.update = function( aSlideNumberField, nSlideNumber )
{
if( nSlideNumber === undefined )
{
if( nCurSlide === undefined )
nSlideNumber = this.nInitialSlideNumber;
else
nSlideNumber = nCurSlide + 1;
}
var sText = this.createSlideNumberText( nSlideNumber, this.getNumberingType() );
aSlideNumberField.setTextContent( sText );
};


SlideNumberProvider.prototype.createSlideNumberText = function( nSlideNumber, sNumberingType )
{
return String( nSlideNumber );
};


function SlideIndexPage()
{
this.pageElementId = 'slide_index';
this.pageBgColor = 'rgb(252,252,252)';
this.pageElement = this.createPageElement();
assert( this.pageElement, 'SlideIndexPage: pageElement is not valid' );
this.indexColumns = INDEX_COLUMNS_DEFAULT;
this.totalThumbnails = this.indexColumns * this.indexColumns;
this.selectedSlideIndex = undefined;

this.xSpacingFactor = 600/28000;
this.ySpacingFactor = 450/21000;
this.xSpacing = WIDTH * this.xSpacingFactor;
this.ySpacing = HEIGHT * this.ySpacingFactor;
this.halfBorderWidthFactor = ( 300/28000 ) * ( this.indexColumns / 3 );
this.halfBorderWidth = WIDTH * this.halfBorderWidthFactor;
this.borderWidth = 2 * this.halfBorderWidth;
this.scaleFactor = ( 1 - ( this.indexColumns + 1 ) * this.xSpacingFactor ) /
( this.indexColumns * ( 1 + 2 * this.halfBorderWidthFactor ) );

this.thumbnailMouseAreaTemplateId = 'thumbnail_mouse_area';
this.thumbnailMouseAreaTemplateElement = null;
this.thumbnailBorderTemplateId = 'thumbnail_border';
this.thumbnailBorderTemplateElement = null;
this.createTemplateElements();

this.aThumbnailSet = new Array( this.totalThumbnails );
for( var i = 0; i < this.totalThumbnails; ++i )
{
this.aThumbnailSet[i] = new Thumbnail( this, i );
this.aThumbnailSet[i].updateView();
}

this.curThumbnailIndex = 0;
}


SlideIndexPage.prototype.getTotalThumbnails = function()
{
return this.totalThumbnails;
};

SlideIndexPage.prototype.show = function()
{
this.pageElement.setAttribute( 'display', 'inherit' );
};

SlideIndexPage.prototype.hide = function()
{
this.pageElement.setAttribute( 'display', 'none' );
};

SlideIndexPage.prototype.setSelection = function( nIndex )
{
nIndex = getSafeIndex( nIndex, 0, this.getTotalThumbnails() - 1 );
if( this.curThumbnailIndex != nIndex )
{
this.aThumbnailSet[ this.curThumbnailIndex ].unselect();
this.aThumbnailSet[ nIndex ].select();
this.curThumbnailIndex = nIndex;
}
this.selectedSlideIndex = this.aThumbnailSet[ nIndex ].slideIndex;
};

SlideIndexPage.prototype.createPageElement = function()
{
var aPageElement = document.createElementNS( NSS['svg'], 'g' );
aPageElement.setAttribute( 'id', this.pageElementId );
aPageElement.setAttribute( 'display', 'none' );
aPageElement.setAttribute( 'visibility', 'visible' );

var sPageBgColor = this.pageBgColor + ';';
var aRectElement = document.createElementNS( NSS['svg'], 'rect' );
aRectElement.setAttribute( 'x', 0 );
aRectElement.setAttribute( 'y', 0 );
aRectElement.setAttribute( 'width', WIDTH );
aRectElement.setAttribute( 'height', HEIGHT );
aRectElement.setAttribute( 'style', 'stroke:none;fill:' + sPageBgColor );

aPageElement.appendChild( aRectElement );
ROOT_NODE.appendChild( aPageElement );
return( document.getElementById( this.pageElementId ) );
};

SlideIndexPage.prototype.createTemplateElements = function()
{
var aDefsElement = document.createElementNS( NSS['svg'], 'defs' );
var aRectElement = document.createElementNS( NSS['svg'], 'rect' );
aRectElement.setAttribute( 'id', this.thumbnailBorderTemplateId );
aRectElement.setAttribute( 'x', -this.halfBorderWidth );
aRectElement.setAttribute( 'y', -this.halfBorderWidth );
aRectElement.setAttribute( 'rx', this.halfBorderWidth );
aRectElement.setAttribute( 'ry', this.halfBorderWidth );
aRectElement.setAttribute( 'width', WIDTH + this.halfBorderWidth );
aRectElement.setAttribute( 'height', HEIGHT + this.halfBorderWidth );
aRectElement.setAttribute( 'stroke-width', this.borderWidth );
aRectElement.setAttribute( 'fill', 'none' );
aDefsElement.appendChild( aRectElement );

aRectElement = document.createElementNS( NSS['svg'], 'rect' );
aRectElement.setAttribute( 'id', this.thumbnailMouseAreaTemplateId );
aRectElement.setAttribute( 'x', 0 );
aRectElement.setAttribute( 'y', 0 );
aRectElement.setAttribute( 'width', WIDTH );
aRectElement.setAttribute( 'height', HEIGHT );
aRectElement.setAttribute( 'fill', this.pageBgColor );
aDefsElement.appendChild( aRectElement );

this.pageElement.appendChild( aDefsElement );

this.thumbnailMouseAreaTemplateElement = document.getElementById( this.thumbnailMouseAreaTemplateId );
this.thumbnailBorderTemplateElement = document.getElementById( this.thumbnailBorderTemplateId );
};

SlideIndexPage.prototype.decreaseNumberOfColumns  = function()
{
this.setNumberOfColumns( this.indexColumns - 1 );
};

SlideIndexPage.prototype.increaseNumberOfColumns  = function()
{
this.setNumberOfColumns( this.indexColumns + 1 );
};

SlideIndexPage.prototype.resetNumberOfColumns  = function()
{
this.setNumberOfColumns( INDEX_COLUMNS_DEFAULT );
};

SlideIndexPage.prototype.setNumberOfColumns  = function( nNumberOfColumns )
{
if( this.indexColumns == nNumberOfColumns )  return;
if( nNumberOfColumns < 2 || nNumberOfColumns > 6 ) return;

var suspendHandle = ROOT_NODE.suspendRedraw(500);

var nOldTotalThumbnails = this.totalThumbnails;
this.indexColumns = nNumberOfColumns;
this.totalThumbnails = nNumberOfColumns * nNumberOfColumns;

this.aThumbnailSet[this.curThumbnailIndex].unselect();

var i;
for( i = this.totalThumbnails; i < nOldTotalThumbnails; ++i )
{
this.aThumbnailSet[i].removeElement();
}

for( i = nOldTotalThumbnails; i < this.totalThumbnails; ++i )
{
this.aThumbnailSet[i] = new Thumbnail( this, i );
}

this.halfBorderWidthFactor = ( 300/28000 ) * ( this.indexColumns / 3 );
this.halfBorderWidth = WIDTH * this.halfBorderWidthFactor;
this.borderWidth = 2 * this.halfBorderWidth;
this.scaleFactor = ( 1 - ( this.indexColumns + 1 ) * this.xSpacingFactor ) /
( this.indexColumns * ( 1 + 2 * this.halfBorderWidthFactor ) );

var aRectElement = this.thumbnailBorderTemplateElement;
aRectElement.setAttribute( 'x', -this.halfBorderWidth );
aRectElement.setAttribute( 'y', -this.halfBorderWidth );
aRectElement.setAttribute( 'rx', this.halfBorderWidth );
aRectElement.setAttribute( 'ry', this.halfBorderWidth );
aRectElement.setAttribute( 'width', WIDTH + this.halfBorderWidth );
aRectElement.setAttribute( 'height', HEIGHT + this.halfBorderWidth );
aRectElement.setAttribute( 'stroke-width', this.borderWidth );

for( i = 0; i < this.totalThumbnails; ++i )
{
this.aThumbnailSet[i].updateView();
}

this.curThumbnailIndex = this.selectedSlideIndex % this.totalThumbnails;
this.aThumbnailSet[this.curThumbnailIndex].select();

INDEX_OFFSET = -1;
indexSetPageSlide( this.selectedSlideIndex );

ROOT_NODE.unsuspendRedraw( suspendHandle );
ROOT_NODE.forceRedraw();
};


function Thumbnail( aSlideIndexPage, nIndex )
{
this.container = aSlideIndexPage;
this.index = nIndex;//= getSafeIndex( nIndex, 0, this.container.getTotalThumbnails() );
this.pageElement = this.container.pageElement;
this.thumbnailId = 'thumbnail' + this.index;
this.thumbnailElement = this.createThumbnailElement();
this.slideElement = getElementByClassName( this.thumbnailElement, 'Slide' );
this.borderElement = getElementByClassName( this.thumbnailElement, 'Border' );
this.mouseAreaElement = getElementByClassName( this.thumbnailElement, 'MouseArea' );
this.aTransformSet = new Array( 3 );
this.visibility = VISIBLE;
this.isSelected = false;
}

Thumbnail.prototype.sNormalBorderColor = 'rgb(216,216,216)';
Thumbnail.prototype.sSelectionBorderColor = 'rgb(92,92,255)';

Thumbnail.prototype.removeElement = function()
{
if( this.thumbnailElement )
this.container.pageElement.removeChild( this.thumbnailElement );
};

Thumbnail.prototype.show = function()
{
if( this.visibility == HIDDEN )
{
this.thumbnailElement.setAttribute( 'display', 'inherit' );
this.visibility = VISIBLE;
}
};

Thumbnail.prototype.hide = function()
{
if( this.visibility == VISIBLE )
{
this.thumbnailElement.setAttribute( 'display', 'none' );
this.visibility = HIDDEN;
}
};

Thumbnail.prototype.select = function()
{
if( !this.isSelected )
{
this.borderElement.setAttribute( 'stroke', this.sSelectionBorderColor );
this.isSelected = true;
}
};

Thumbnail.prototype.unselect = function()
{
if( this.isSelected )
{
this.borderElement.setAttribute( 'stroke', this.sNormalBorderColor );
this.isSelected = false;
}
};

Thumbnail.prototype.updateView = function()
{
this.column = this.index % this.container.indexColumns;
this.row = ( this.index - this.column ) / this.container.indexColumns;
this.halfBorderWidth = this.container.halfBorderWidth;
this.borderWidth = this.container.borderWidth;
this.width = ( WIDTH + this.borderWidth ) * this.container.scaleFactor;
this.height = ( HEIGHT + this.borderWidth ) * this.container.scaleFactor;
this.aTransformSet[2] = 'translate(' + this.halfBorderWidth + ' ' + this.halfBorderWidth + ')';
this.aTransformSet[1] = 'scale(' + this.container.scaleFactor + ')';
var sTransformAttrValue = this.computeTransform();
this.thumbnailElement.setAttribute( 'transform', sTransformAttrValue );
this.mouseAreaElement.setAttribute( 'onmouseover', 'theSlideIndexPage.aThumbnailSet[' + this.index  + '].onMouseOver()' );
};

Thumbnail.prototype.update = function( nIndex )
{
if( this.slideIndex == nIndex )  return;

var aMetaSlide = theMetaDoc.aMetaSlideSet[nIndex];
aMetaSlide.updateMasterPageView();
setNSAttribute( 'xlink', this.slideElement, 'href', '#' + aMetaSlide.slideId );
this.slideIndex = nIndex;
};

Thumbnail.prototype.clear = function( nIndex )
{
setNSAttribute( 'xlink', this.slideElement, 'href', '' );
};

Thumbnail.prototype.createThumbnailElement = function()
{
var aThumbnailElement = document.createElementNS( NSS['svg'], 'g' );
aThumbnailElement.setAttribute( 'id', this.thumbnailId );
aThumbnailElement.setAttribute( 'display', 'inherit' );

var aSlideElement = document.createElementNS( NSS['svg'], 'use' );
setNSAttribute( 'xlink', aSlideElement, 'href', '' );
aSlideElement.setAttribute( 'class', 'Slide' );
aThumbnailElement.appendChild( aSlideElement );

var aMouseAreaElement = document.createElementNS( NSS['svg'], 'use' );
setNSAttribute( 'xlink', aMouseAreaElement, 'href', '#' + this.container.thumbnailMouseAreaTemplateId );
aMouseAreaElement.setAttribute( 'class', 'MouseArea' );
aMouseAreaElement.setAttribute( 'opacity', 0.0 );
aThumbnailElement.appendChild( aMouseAreaElement );

var aBorderElement = document.createElementNS( NSS['svg'], 'use' );
setNSAttribute( 'xlink', aBorderElement, 'href', '#' + this.container.thumbnailBorderTemplateId );
aBorderElement.setAttribute( 'stroke', this.sNormalBorderColor );
aBorderElement.setAttribute( 'class', 'Border' );
aThumbnailElement.appendChild( aBorderElement );

this.container.pageElement.appendChild( aThumbnailElement );
return( document.getElementById( this.thumbnailId ) );
};

Thumbnail.prototype.computeTransform = function()
{
var nXSpacing = this.container.xSpacing;
var nYSpacing = this.container.ySpacing;

var nXOffset = nXSpacing + ( this.width + nXSpacing ) * this.column;
var nYOffset = nYSpacing + ( this.height + nYSpacing ) * this.row;

this.aTransformSet[0] = 'translate(' + nXOffset + ' ' + nYOffset + ')';

var sTransform = this.aTransformSet.join( ' ' );

return sTransform;
};

Thumbnail.prototype.onMouseOver = function()
{
if( ( currentMode == INDEX_MODE ) && ( this.container.curThumbnailIndex !=  this.index ) )
{
this.container.setSelection( this.index );
}
};


function init()
{
var VIEWBOX = ROOT_NODE.getAttribute('viewBox');

if( VIEWBOX )
{
WIDTH = ROOT_NODE.viewBox.animVal.width;
HEIGHT = ROOT_NODE.viewBox.animVal.height;
}

aSlideShow = new SlideShow();
theMetaDoc =  new MetaDocument();
aSlideShow.bIsEnabled = theMetaDoc.bIsAnimated;
theSlideIndexPage = new SlideIndexPage();
aSlideShow.displaySlide( theMetaDoc.nStartSlideNumber, false );


}

function presentationEngineStop()
{
alert( 'We are sorry! An unexpected error occurred.\nThe presentation engine will be stopped' );
document.onkeydown = null;
document.onkeypress = null;
document.onclick = null;
window.onmousewheel = null;
}

function assert( condition, message )
{
if (!condition)
{
presentationEngineStop();
if (typeof console == 'object')
console.trace();
throw new Error( message );
}
}

function dispatchEffects(dir)
{

if( dir == 1 )
{
var bRet = aSlideShow.nextEffect();

if( !bRet )
{
switchSlide( 1, false );
}
}
else
{
switchSlide( dir, false );
}
}

function skipAllEffects()
{
var bRet = aSlideShow.skipAllEffects();
if( !bRet )
{
switchSlide( 1, true );
}
}

function skipEffects(dir)
{
if( dir == 1 )
{
var bRet = aSlideShow.skipPlayingOrNextEffect();

if( !bRet )
{
switchSlide( 1, true );
}
}
else
{
switchSlide( dir, true );
}
}

function switchSlide( nOffset, bSkipTransition )
{
var nNextSlide = nCurSlide + nOffset;
aSlideShow.displaySlide( nNextSlide, bSkipTransition );
}

function displayIndex( offsetNumber )
{
var aMetaSlideSet = theMetaDoc.aMetaSlideSet;
offsetNumber = getSafeIndex( offsetNumber, 0, aMetaSlideSet.length - 1 );

var nTotalThumbnails = theSlideIndexPage.getTotalThumbnails();
var nEnd = Math.min( offsetNumber + nTotalThumbnails, aMetaSlideSet.length);

var aThumbnailSet = theSlideIndexPage.aThumbnailSet;
var j = 0;
for( var i = offsetNumber; i < nEnd; ++i, ++j )
{
aThumbnailSet[j].update( i );
aThumbnailSet[j].show();
}
for( ; j < nTotalThumbnails; ++j )
{
aThumbnailSet[j].hide();
}

if (INDEX_OFFSET != offsetNumber)
INDEX_OFFSET = offsetNumber;
}

function toggleSlideIndex()
{

if( currentMode == SLIDE_MODE )
{

theMetaDoc.getCurrentSlide().hide();
INDEX_OFFSET = -1;
indexSetPageSlide( nCurSlide );
theSlideIndexPage.show();
currentMode = INDEX_MODE;
}
else if( currentMode == INDEX_MODE )
{
theSlideIndexPage.hide();
var nNewSlide = theSlideIndexPage.selectedSlideIndex;

aSlideShow.displaySlide( nNewSlide, true );
currentMode = SLIDE_MODE;
}

}

function abandonIndexMode()
{
theSlideIndexPage.selectedSlideIndex = nCurSlide;
toggleSlideIndex();
}


var CURR_UNIQUE_ID = 0;

function getUniqueId()
{
++CURR_UNIQUE_ID;
return CURR_UNIQUE_ID;
}

function mem_fn( sMethodName )
{
return  function( aObject )
{
var aMethod = aObject[ sMethodName ];
if( aMethod )
aMethod.call( aObject );
else
log( 'method sMethodName not found' );
};
}

function bind( aObject, aMethod )
{
return  function()
{
return aMethod.call( aObject, arguments[0] );
};
}

function bind2( aFunction )
{
if( !aFunction  )
log( 'bind2: passed function is not valid.' );

var aBoundArgList = arguments;

var aResultFunction = null;

switch( aBoundArgList.length )
{
case 1: aResultFunction = function()
{
return aFunction.call( arguments[0], arguments[1],
arguments[2], arguments[3],
arguments[4] );
};
break;
case 2: aResultFunction = function()
{
return aFunction.call( aBoundArgList[1], arguments[0],
arguments[1], arguments[2],
arguments[3] );
};
break;
case 3: aResultFunction = function()
{
return aFunction.call( aBoundArgList[1], aBoundArgList[2],
arguments[0], arguments[1],
arguments[2] );
};
break;
case 4: aResultFunction = function()
{
return aFunction.call( aBoundArgList[1], aBoundArgList[2],
aBoundArgList[3], arguments[0],
arguments[1] );
};
break;
case 5: aResultFunction = function()
{
return aFunction.call( aBoundArgList[1], aBoundArgList[2],
aBoundArgList[3], aBoundArgList[4],
arguments[0] );
};
break;
default:
log( 'bind2: arity not handled.' );
}

return aResultFunction;
}

function getCurrentSystemTime()
{
return ( new Date() ).getTime();
}

function getSlideAnimationsRoot( sSlideId )
{
return theMetaDoc.aSlideAnimationsMap[ sSlideId ];
}

function getElementChildren( aElement )
{
var aChildrenArray = [];

var nSize = aElement.childNodes.length;

for( var i = 0; i < nSize; ++i )
{
if( aElement.childNodes[i].nodeType == 1 )
aChildrenArray.push( aElement.childNodes[i] );
}

return aChildrenArray;
}

function removeWhiteSpaces( str )
{
if( !str )
return '';

var re = / */;
var aSplitString = str.split( re );
return aSplitString.join('');
}

function clamp( nValue, nMinimum, nMaximum )
{
if( nValue < nMinimum )
{
return nMinimum;
}
else if( nValue > nMaximum )
{
return nMaximum;
}
else
{
return nValue;
}
}

function makeMatrixString( a, b, c, d, e, f )
{
var s = 'matrix(';
s += a + ', ';
s += b + ', ';
s += c + ', ';
s += d + ', ';
s += e + ', ';
s += f + ')';

return s;
}

function matrixToString( aSVGMatrix )
{
return makeMatrixString( aSVGMatrix.a, aSVGMatrix.b, aSVGMatrix.c,
aSVGMatrix.d, aSVGMatrix.e, aSVGMatrix.f );
}


function numberParser( sValue )
{
if( sValue === '.' )
return undefined;
var reFloatNumber = /^[+-]?[0-9]*[.]?[0-9]*$/;

if( reFloatNumber.test( sValue ) )
return parseFloat( sValue );
else
return undefined;
}

function booleanParser( sValue )
{
sValue = sValue.toLowerCase();
if( sValue === 'true' )
return true;
else if( sValue === 'false' )
return false;
else
return undefined;
}

function colorParser( sValue )
{

function hsl( nHue, nSaturation, nLuminance )
{
return new HSLColor( nHue, nSaturation / 100, nLuminance / 100 );
}

function rgb( nRed, nGreen, nBlue )
{
return new RGBColor( nRed / 255, nGreen / 255, nBlue / 255 );
}

function prgb( nRed, nGreen, nBlue )
{
return new RGBColor( nRed / 100, nGreen / 100, nBlue / 100 );
}

var sCommaPattern = ' *[,] *';
var sIntegerPattern = '[+-]?[0-9]+';
var sHexDigitPattern = '[0-9A-Fa-f]';

var sHexColorPattern = '#(' + sHexDigitPattern + '{2})('
+ sHexDigitPattern + '{2})('
+ sHexDigitPattern + '{2})';

var sRGBIntegerPattern = 'rgb[(] *' + sIntegerPattern + sCommaPattern
+ sIntegerPattern + sCommaPattern
+ sIntegerPattern + ' *[)]';

var sRGBPercentPattern = 'rgb[(] *' + sIntegerPattern + '%' + sCommaPattern
+ sIntegerPattern + '%' + sCommaPattern
+ sIntegerPattern + '%' + ' *[)]';

var sHSLPercentPattern = 'hsl[(] *' + sIntegerPattern + sCommaPattern
+ sIntegerPattern + '%' + sCommaPattern
+ sIntegerPattern + '%' + ' *[)]';

var reHexColor = new RegExp( sHexColorPattern );
var reRGBInteger = new RegExp( sRGBIntegerPattern );
var reRGBPercent = new RegExp( sRGBPercentPattern );
var reHSLPercent = new RegExp( sHSLPercentPattern );

if( reHexColor.test( sValue ) )
{
var aRGBTriple = reHexColor.exec( sValue );

var nRed    = parseInt( aRGBTriple[1], 16 ) / 255;
var nGreen  = parseInt( aRGBTriple[2], 16 ) / 255;
var nBlue   = parseInt( aRGBTriple[3], 16 ) / 255;

return new RGBColor( nRed, nGreen, nBlue );
}
else if( reHSLPercent.test( sValue ) )
{
sValue = sValue.replace( '%', '' ).replace( '%', '' );
return eval( sValue );
}
else if( reRGBInteger.test( sValue ) )
{
return eval( sValue );
}
else if( reRGBPercent.test( sValue ) )
{
sValue = 'p' + sValue.replace( '%', '' ).replace( '%', '' ).replace( '%', '' );
return eval( sValue );
}
else
{
return null;
}
}


function RGBColor( nRed, nGreen, nBlue )
{
this.eColorSpace = COLOR_SPACE_RGB;
this.nRed = nRed;
this.nGreen = nGreen;
this.nBlue = nBlue;
}


RGBColor.prototype.clone = function()
{
return new RGBColor( this.nRed, this.nGreen, this.nBlue );
};

RGBColor.prototype.equal = function( aRGBColor )
{
return ( this.nRed == aRGBColor.nRed ) &&
( this.nGreen == aRGBColor.nGreen ) &&
( this.nBlue == aRGBColor.nBlue );
};

RGBColor.prototype.add = function( aRGBColor )
{
this.nRed += aRGBColor.nRed;
this.nGreen += aRGBColor.nGreen;
this.nBlue += aRGBColor.nBlue;
return this;
};

RGBColor.prototype.scale = function( aT )
{
this.nRed *= aT;
this.nGreen *= aT;
this.nBlue *= aT;
return this;
};

RGBColor.clamp = function( aRGBColor )
{
var aClampedRGBColor = new RGBColor( 0, 0, 0 );

aClampedRGBColor.nRed   = clamp( aRGBColor.nRed, 0.0, 1.0 );
aClampedRGBColor.nGreen = clamp( aRGBColor.nGreen, 0.0, 1.0 );
aClampedRGBColor.nBlue  = clamp( aRGBColor.nBlue, 0.0, 1.0 );

return aClampedRGBColor;
};

RGBColor.prototype.convertToHSL = function()
{
var nRed   = clamp( this.nRed, 0.0, 1.0 );
var nGreen = clamp( this.nGreen, 0.0, 1.0 );
var nBlue  = clamp( this.nBlue, 0.0, 1.0 );

var nMax = Math.max( nRed, nGreen, nBlue );
var nMin = Math.min( nRed, nGreen, nBlue );
var nDelta = nMax - nMin;

var nLuminance  = ( nMax + nMin ) / 2.0;
var nSaturation = 0.0;
var nHue = 0.0;
if( nDelta !== 0 )
{
nSaturation = ( nLuminance > 0.5 ) ?
( nDelta / ( 2.0 - nMax - nMin) ) :
( nDelta / ( nMax + nMin ) );

if( nRed == nMax )
nHue = ( nGreen - nBlue ) / nDelta;
else if( nGreen == nMax )
nHue = 2.0 + ( nBlue - nRed ) / nDelta;
else if( nBlue == nMax )
nHue = 4.0 + ( nRed - nGreen ) / nDelta;

nHue *= 60.0;

if( nHue < 0.0 )
nHue += 360.0;
}

return new HSLColor( nHue, nSaturation, nLuminance );

};

RGBColor.prototype.toString = function( bClamped )
{
var aRGBColor;
if( bClamped )
{
aRGBColor = RGBColor.clamp( this );
}
else
{
aRGBColor = this;
}

var nRed = Math.round( aRGBColor.nRed * 255 );
var nGreen = Math.round( aRGBColor.nGreen * 255 );
var nBlue = Math.round( aRGBColor.nBlue * 255 );

return ( 'rgb(' + nRed + ',' + nGreen + ',' + nBlue + ')' );
};

RGBColor.interpolate = function( aStartRGB , aEndRGB, nT )
{
var aResult = aStartRGB.clone();
var aTEndRGB = aEndRGB.clone();
aResult.scale( 1.0 - nT );
aTEndRGB.scale( nT );
aResult.add( aTEndRGB );

return aResult;
};


function HSLColor( nHue, nSaturation, nLuminance )
{
this.eColorSpace = COLOR_SPACE_HSL;
this.nHue = nHue;
this.nSaturation = nSaturation;
this.nLuminance = nLuminance;

this.normalizeHue();
}


HSLColor.prototype.clone = function()
{
return new HSLColor( this.nHue, this.nSaturation, this.nLuminance );
};

HSLColor.prototype.equal = function( aHSLColor )
{
return ( this.nHue == aHSLColor.nHue ) &&
( this.nSaturation += aHSLColor.nSaturation ) &&
( this.nLuminance += aHSLColor.nLuminance );
};

HSLColor.prototype.add = function( aHSLColor )
{
this.nHue += aHSLColor.nHue;
this.nSaturation += aHSLColor.nSaturation;
this.nLuminance += aHSLColor.nLuminance;
this.normalizeHue();
return this;
};

HSLColor.prototype.scale = function( aT )
{
this.nHue *= aT;
this.nSaturation *= aT;
this.nLuminance *= aT;
this.normalizeHue();
return this;
};

HSLColor.clamp = function( aHSLColor )
{
var aClampedHSLColor = new HSLColor( 0, 0, 0 );

aClampedHSLColor.nHue = aHSLColor.nHue % 360;
if( aClampedHSLColor.nHue < 0 )
aClampedHSLColor.nHue += 360;
aClampedHSLColor.nSaturation = clamp( aHSLColor.nSaturation, 0.0, 1.0 );
aClampedHSLColor.nLuminance = clamp( aHSLColor.nLuminance, 0.0, 1.0 );
};

HSLColor.prototype.normalizeHue = function()
{
this.nHue = this.nHue % 360;
if( this.nHue < 0 ) this.nHue += 360;
};

HSLColor.prototype.toString = function()
{
return 'hsl(' + this.nHue.toFixed( 3 ) + ','
+ this.nSaturation.toFixed( 3 ) + ','
+ this.nLuminance.toFixed( 3 ) + ')';
};

HSLColor.prototype.convertToRGB = function()
{

var nHue = this.nHue % 360;
if( nHue < 0 ) nHue += 360;
var nSaturation =  clamp( this.nSaturation, 0.0, 1.0 );
var nLuminance = clamp( this.nLuminance, 0.0, 1.0 );


if( nSaturation === 0 )
{
return new RGBColor( nLuminance, nLuminance, nLuminance );
}

var nVal1 = ( nLuminance <= 0.5 ) ?
( nLuminance * (1.0 + nSaturation) ) :
( nLuminance + nSaturation - nLuminance * nSaturation );

var nVal2 = 2.0 * nLuminance - nVal1;

var nRed    = HSLColor.hsl2rgbHelper( nVal2, nVal1, nHue + 120 );
var nGreen  = HSLColor.hsl2rgbHelper( nVal2, nVal1, nHue );
var nBlue   = HSLColor.hsl2rgbHelper( nVal2, nVal1, nHue - 120 );

return new RGBColor( nRed, nGreen, nBlue );
};

HSLColor.hsl2rgbHelper = function( nValue1, nValue2, nHue )
{
nHue = nHue % 360;
if( nHue < 0 )
nHue += 360;

if( nHue < 60.0 )
return nValue1 + ( nValue2 - nValue1 ) * nHue / 60.0;
else if( nHue < 180.0 )
return nValue2;
else if( nHue < 240.0 )
return ( nValue1 + ( nValue2 - nValue1 ) * ( 240.0 - nHue ) / 60.0 );
else
return nValue1;
};

HSLColor.interpolate = function( aFrom, aTo, nT, bCCW )
{
var nS = 1.0 - nT;

var nHue = 0.0;
if( aFrom.nHue <= aTo.nHue && !bCCW )
{
nHue = nS * (aFrom.nHue + 360.0) + nT * aTo.nHue;
}
else if( aFrom.nHue > aTo.nHue && bCCW )
{
nHue = nS * aFrom.nHue + nT * (aTo.nHue + 360.0);
}
else
{
nHue = nS * aFrom.nHue + nT * aTo.nHue;
}

var nSaturation = nS * aFrom.nSaturation + nT * aTo.nSaturation;
var nLuminance = nS * aFrom.nLuminance + nT * aTo.nLuminance;

return new HSLColor( nHue, nSaturation, nLuminance );
};


SVGIdentityMatrix = document.documentElement.createSVGMatrix();

SVGMatrix.prototype.setToIdentity = function()
{
this.a = this.d = 1;
this.b = this.c = this.d = this.e = 0;
};

SVGMatrix.prototype.setToRotationAroundPoint = function( nX, nY, nAngle )
{
nAngle = Math.PI * nAngle / 180;
var nSin = Math.sin( nAngle );
var nCos = Math.cos( nAngle );

this.a = nCos; this.c = -nSin; this.e = nX * (1 - nCos) + nY * nSin;
this.b = nSin; this.d =  nCos; this.f = nY * (1 - nCos) - nX * nSin;
};


SVGPathElement.prototype.prependPath = function( aPath )
{
var sPathData = aPath.getAttribute( 'd' );
sPathData += ( ' ' + this.getAttribute( 'd' ) );
this.setAttribute( 'd', sPathData );
};

SVGPathElement.prototype.appendPath = function( aPath )
{
var sPathData = this.getAttribute( 'd' );
sPathData += ( ' ' + aPath.getAttribute( 'd' ) );
this.setAttribute( 'd', sPathData );
};

SVGPathElement.prototype.matrixTransform = function( aSVGMatrix )
{
var aPathSegList = this.pathSegList;
var nLength = aPathSegList.numberOfItems;
var i;
for( i = 0; i < nLength; ++i )
{
aPathSegList.getItem( i ).matrixTransform( aSVGMatrix );
}
};

SVGPathElement.prototype.changeOrientation = function()
{
var aPathSegList = this.pathSegList;
var nLength = aPathSegList.numberOfItems;
if( nLength == 0 ) return;

var nCurrentX = 0;
var nCurrentY = 0;

var aPathSeg = aPathSegList.getItem( 0 );
if( aPathSeg.pathSegTypeAsLetter == 'M' )
{
nCurrentX = aPathSeg.x;
nCurrentY = aPathSeg.y;
aPathSegList.removeItem( 0 );
--nLength;
}

var i;
for( i = 0; i < nLength; ++i )
{
aPathSeg = aPathSegList.getItem( i );
var aPoint = aPathSeg.changeOrientation( nCurrentX, nCurrentY );
nCurrentX = aPoint.x;
nCurrentY = aPoint.y;
}


for( i = nLength - 2; i >= 0; --i )
{
aPathSeg = aPathSegList.removeItem( i );
aPathSegList.appendItem( aPathSeg );
}

var aMovePathSeg = this.createSVGPathSegMovetoAbs( nCurrentX, nCurrentY );
aPathSegList.insertItemBefore( aMovePathSeg, 0 );

};


var SVGPathSeg = typeof SVGPathSeg === 'undefined' ? function() {} : SVGPathSeg;

try
{   // Firefox, Google Chrome, Internet Explorer, Safari.

SVGPathSegMovetoAbs.prototype.matrixTransform = function( aSVGMatrix )
{
SVGPathMatrixTransform( this, aSVGMatrix );
};

SVGPathSegLinetoAbs.prototype.matrixTransform = function( aSVGMatrix )
{
SVGPathMatrixTransform( this, aSVGMatrix );
};

SVGPathSegCurvetoQuadraticAbs.prototype.matrixTransform = function( aSVGMatrix )
{
SVGPathMatrixTransform( this, aSVGMatrix );
var nX = this.x1;
this.x1 = aSVGMatrix.a * nX + aSVGMatrix.c * this.y1 + aSVGMatrix.e;
this.y1 = aSVGMatrix.b * nX + aSVGMatrix.d * this.y1 + aSVGMatrix.f;
};

SVGPathSegCurvetoCubicAbs.prototype.matrixTransform = function( aSVGMatrix )
{
SVGPathMatrixTransform( this, aSVGMatrix );
var nX = this.x1;
this.x1 = aSVGMatrix.a * nX + aSVGMatrix.c * this.y1 + aSVGMatrix.e;
this.y1 = aSVGMatrix.b * nX + aSVGMatrix.d * this.y1 + aSVGMatrix.f;
nX = this.x2;
this.x2 = aSVGMatrix.a * nX + aSVGMatrix.c * this.y2 + aSVGMatrix.e;
this.y2 = aSVGMatrix.b * nX + aSVGMatrix.d * this.y2 + aSVGMatrix.f;
};


SVGPathSegMovetoAbs.prototype.changeOrientation = function( nCurrentX, nCurrentY )
{
var aPoint = { x: this.x, y: this.y };
this.x = nCurrentX;
this.y = nCurrentY;
return aPoint;
};

SVGPathSegLinetoAbs.prototype.changeOrientation = function( nCurrentX, nCurrentY )
{
var aPoint = { x: this.x, y: this.y };
this.x = nCurrentX;
this.y = nCurrentY;
return aPoint;
};

SVGPathSegCurvetoQuadraticAbs.prototype.changeOrientation = function( nCurrentX, nCurrentY )
{
var aPoint = { x: this.x, y: this.y };
this.x = nCurrentX;
this.y = nCurrentY;
return aPoint;
};

SVGPathSegCurvetoCubicAbs.prototype.changeOrientation = function( nCurrentX, nCurrentY )
{
var aPoint = { x: this.x, y: this.y };
this.x = nCurrentX;
this.y = nCurrentY;
var nX = this.x1;
this.x1 = this.x2;
this.x2 = nX;
var nY = this.y1;
this.y1 = this.y2;
this.y2 = nY;
return aPoint;
};

}
catch( e )
{   // Opera

if( e.name == 'ReferenceError' )
{
SVGPathSeg.prototype.matrixTransform = function( aSVGMatrix )
{
var nX;
switch( this.pathSegTypeAsLetter )
{
case 'C':
nX = this.x2;
this.x2 = aSVGMatrix.a * nX + aSVGMatrix.c * this.y2 + aSVGMatrix.e;
this.y2 = aSVGMatrix.b * nX + aSVGMatrix.d * this.y2 + aSVGMatrix.f;
case 'Q':
nX = this.x1;
this.x1 = aSVGMatrix.a * nX + aSVGMatrix.c * this.y1 + aSVGMatrix.e;
this.y1 = aSVGMatrix.b * nX + aSVGMatrix.d * this.y1 + aSVGMatrix.f;
case 'M':
case 'L':
SVGPathMatrixTransform( this, aSVGMatrix );
break;
default:
log( 'SVGPathSeg.matrixTransform: unexpected path segment type: '
+ this.pathSegTypeAsLetter );
}
};

SVGPathSeg.prototype.changeOrientation = function( nCurrentX, nCurrentY )
{
switch( this.pathSegTypeAsLetter )
{
case 'C':
var nX = this.x1;
this.x1 = this.x2;
this.x2 = nX;
var nY = this.y1;
this.y1 = this.y2;
this.y2 = nY;
case 'M':
case 'L':
case 'Q':
var aPoint = { x: this.x, y: this.y };
this.x = nCurrentX;
this.y = nCurrentY;
return aPoint;
default:
log( 'SVGPathSeg.changeOrientation: unexpected path segment type: '
+ this.pathSegTypeAsLetter );
return null;
}
}
}
else throw e;
}

function SVGPathMatrixTransform( aPath, aSVGMatrix )
{
var nX = aPath.x;
aPath.x = aSVGMatrix.a * nX + aSVGMatrix.c * aPath.y + aSVGMatrix.e;
aPath.y = aSVGMatrix.b * nX + aSVGMatrix.d * aPath.y + aSVGMatrix.f;
}


function PriorityQueue( aCompareFunc )
{
this.aSequence = [];
this.aCompareFunc = aCompareFunc;
}

PriorityQueue.prototype.clone = function()
{
var aCopy = new PriorityQueue( this.aCompareFunc );
var src = this.aSequence;
var dest = [];
var i, l;
for( i = 0, l = src.length; i < l; ++i )
{
if( i in src )
{
dest.push( src[i] );
}
}
aCopy.aSequence = dest;
return aCopy;
};

PriorityQueue.prototype.top = function()
{
return this.aSequence[this.aSequence.length - 1];
};

PriorityQueue.prototype.isEmpty = function()
{
return ( this.aSequence.length === 0 );
};

PriorityQueue.prototype.push = function( aValue )
{
this.aSequence.unshift( aValue );
this.aSequence.sort(this.aCompareFunc);
};

PriorityQueue.prototype.clear = function()
{
this.aSequence = [];
};

PriorityQueue.prototype.pop = function()
{
return this.aSequence.pop();
};


var ANIMATION_NODE_CUSTOM               = 0;
var ANIMATION_NODE_PAR                  = 1;
var ANIMATION_NODE_SEQ                  = 2;
var ANIMATION_NODE_ITERATE              = 3;
var ANIMATION_NODE_ANIMATE              = 4;
var ANIMATION_NODE_SET                  = 5;
var ANIMATION_NODE_ANIMATEMOTION        = 6;
var ANIMATION_NODE_ANIMATECOLOR         = 7;
var ANIMATION_NODE_ANIMATETRANSFORM     = 8;
var ANIMATION_NODE_TRANSITIONFILTER     = 9;
var ANIMATION_NODE_AUDIO                = 10;
var ANIMATION_NODE_COMMAND              = 11;

aAnimationNodeTypeInMap = {
'par'               : ANIMATION_NODE_PAR,
'seq'               : ANIMATION_NODE_SEQ,
'iterate'           : ANIMATION_NODE_ITERATE,
'animate'           : ANIMATION_NODE_ANIMATE,
'set'               : ANIMATION_NODE_SET,
'animatemotion'     : ANIMATION_NODE_ANIMATEMOTION,
'animatecolor'      : ANIMATION_NODE_ANIMATECOLOR,
'animatetransform'  : ANIMATION_NODE_ANIMATETRANSFORM,
'transitionfilter'  : ANIMATION_NODE_TRANSITIONFILTER,
'audio'             : ANIMATION_NODE_AUDIO,
'command'           : ANIMATION_NODE_COMMAND
};


function getAnimationElementType( aElement )
{
var sName = aElement.localName.toLowerCase();

if( sName && aAnimationNodeTypeInMap[ sName ] )
return aAnimationNodeTypeInMap[ sName ];
else
return ANIMATION_NODE_CUSTOM;
}


var INVALID_NODE                = 0;
var UNRESOLVED_NODE             = 1;
var RESOLVED_NODE               = 2;
var ACTIVE_NODE                 = 4;
var FROZEN_NODE                 = 8;
var ENDED_NODE                  = 16;

function getNodeStateName( eNodeState )
{
switch( eNodeState )
{
case INVALID_NODE:
return 'INVALID';
case UNRESOLVED_NODE:
return 'UNRESOLVED';
case RESOLVED_NODE:
return 'RESOLVED';
case ACTIVE_NODE:
return 'ACTIVE';
case FROZEN_NODE:
return 'FROZEN';
case ENDED_NODE:
return 'ENDED';
default:
return 'UNKNOWN';
}
}


IMPRESS_DEFAULT_NODE                    = 0;
IMPRESS_ON_CLICK_NODE                   = 1;
IMPRESS_WITH_PREVIOUS_NODE              = 2;
IMPRESS_AFTER_PREVIOUS_NODE             = 3;
IMPRESS_MAIN_SEQUENCE_NODE              = 4;
IMPRESS_TIMING_ROOT_NODE                = 5;
IMPRESS_INTERACTIVE_SEQUENCE_NODE       = 6;

aImpressNodeTypeInMap = {
'on-click'                  : IMPRESS_ON_CLICK_NODE,
'with-previous'             : IMPRESS_WITH_PREVIOUS_NODE,
'after-previous'            : IMPRESS_AFTER_PREVIOUS_NODE,
'main-sequence'             : IMPRESS_MAIN_SEQUENCE_NODE,
'timing-root'               : IMPRESS_TIMING_ROOT_NODE,
'interactive-sequence'      : IMPRESS_INTERACTIVE_SEQUENCE_NODE
};

aImpressNodeTypeOutMap = [ 'default', 'on-click', 'with-previous', 'after-previous',
'main-sequence', 'timing-root', 'interactive-sequence' ];


aPresetClassInMap = {};


aPresetIdInMap = {};


var RESTART_MODE_DEFAULT            = 0;
var RESTART_MODE_INHERIT            = 0;
var RESTART_MODE_ALWAYS             = 1;
var RESTART_MODE_WHEN_NOT_ACTIVE    = 2;
var RESTART_MODE_NEVER              = 3;

aRestartModeInMap = {
'inherit'       : RESTART_MODE_DEFAULT,
'always'        : RESTART_MODE_ALWAYS,
'whenNotActive' : RESTART_MODE_WHEN_NOT_ACTIVE,
'never'         : RESTART_MODE_NEVER
};

aRestartModeOutMap = [ 'inherit','always', 'whenNotActive', 'never' ];


var FILL_MODE_DEFAULT           = 0;
var FILL_MODE_INHERIT           = 0;
var FILL_MODE_REMOVE            = 1;
var FILL_MODE_FREEZE            = 2;
var FILL_MODE_HOLD              = 3;
var FILL_MODE_TRANSITION        = 4;
var FILL_MODE_AUTO              = 5;

aFillModeInMap = {
'inherit'       : FILL_MODE_DEFAULT,
'remove'        : FILL_MODE_REMOVE,
'freeze'        : FILL_MODE_FREEZE,
'hold'          : FILL_MODE_HOLD,
'transition'    : FILL_MODE_TRANSITION,
'auto'          : FILL_MODE_AUTO
};

aFillModeOutMap = [ 'inherit', 'remove', 'freeze', 'hold', 'transition', 'auto' ];


var ADDITIVE_MODE_BASE          = 0;
var ADDITIVE_MODE_SUM           = 1;
var ADDITIVE_MODE_REPLACE       = 2;
var ADDITIVE_MODE_MULTIPLY      = 3;
var ADDITIVE_MODE_NONE          = 4;

aAddittiveModeInMap = {
'base'          : ADDITIVE_MODE_BASE,
'sum'           : ADDITIVE_MODE_SUM,
'replace'       : ADDITIVE_MODE_REPLACE,
'multiply'      : ADDITIVE_MODE_MULTIPLY,
'none'          : ADDITIVE_MODE_NONE
};

aAddittiveModeOutMap = [ 'base', 'sum', 'replace', 'multiply', 'none' ];


var ACCUMULATE_MODE_NONE        = 0;
var ACCUMULATE_MODE_SUM         = 1;

aAccumulateModeOutMap = [ 'none', 'sum' ];

var CALC_MODE_DISCRETE          = 0;
var CALC_MODE_LINEAR            = 1;
var CALC_MODE_PACED             = 2;
var CALC_MODE_SPLINE            = 3;

aCalcModeInMap = {
'discrete'      : CALC_MODE_DISCRETE,
'linear'        : CALC_MODE_LINEAR,
'paced'         : CALC_MODE_PACED,
'spline'        : CALC_MODE_SPLINE
};

aCalcModeOutMap = [ 'discrete', 'linear', 'paced', 'spline' ];


var COLOR_SPACE_RGB = 0;
var COLOR_SPACE_HSL = 1;

aColorSpaceInMap = { 'rgb': COLOR_SPACE_RGB, 'hsl': COLOR_SPACE_HSL };

aColorSpaceOutMap = [ 'rgb', 'hsl' ];


var CLOCKWISE               = 0;
var COUNTERCLOCKWISE        = 1;

aClockDirectionInMap = { 'clockwise': CLOCKWISE, 'counter-clockwise': COUNTERCLOCKWISE };

aClockDirectionOutMap = [ 'clockwise', 'counter-clockwise' ];


UNKNOWN_PROPERTY        = 0;
NUMBER_PROPERTY         = 1;
ENUM_PROPERTY           = 2;
COLOR_PROPERTY          = 3;
STRING_PROPERTY         = 4;
BOOL_PROPERTY           = 5;

aValueTypeOutMap = [ 'unknown', 'number', 'enum', 'color', 'string', 'boolean' ];


var aAttributeMap =
{
'height':           {   'type':         NUMBER_PROPERTY,
'get':          'getHeight',
'set':          'setHeight',
'getmod':       'makeScaler( 1/nHeight )',
'setmod':       'makeScaler( nHeight)'          },

'opacity':          {   'type':         NUMBER_PROPERTY,
'get':          'getOpacity',
'set':          'setOpacity'                    },

'width':            {   'type':         NUMBER_PROPERTY,
'get':          'getWidth',
'set':          'setWidth',
'getmod':       'makeScaler( 1/nWidth )',
'setmod':       'makeScaler( nWidth)'           },

'x':                {   'type':         NUMBER_PROPERTY,
'get':          'getX',
'set':          'setX',
'getmod':       'makeScaler( 1/nWidth )',
'setmod':       'makeScaler( nWidth)'           },

'y':                {   'type':         NUMBER_PROPERTY,
'get':          'getY',
'set':          'setY',
'getmod':       'makeScaler( 1/nHeight )',
'setmod':       'makeScaler( nHeight)'          },

'fill':             {   'type':         ENUM_PROPERTY,
'get':          'getFillStyle',
'set':          'setFillStyle'                  },

'stroke':           {   'type':         ENUM_PROPERTY,
'get':          'getStrokeStyle',
'set':          'setStrokeStyle'                },

'visibility':       {   'type':         ENUM_PROPERTY,
'get':          'getVisibility',
'set':          'setVisibility'                 },

'fill-color':       {   'type':         COLOR_PROPERTY,
'get':          'getFillColor',
'set':          'setFillColor'                  },

'stroke-color':     {   'type':         COLOR_PROPERTY,
'get':          'getStrokeColor',
'set':          'setStrokeColor'                },

'color':            {   'type':         COLOR_PROPERTY,
'get':          'getFontColor',
'set':          'setFontColor'                  }

};


TRANSITION_INVALID              = 0;    // Invalid type
TRANSITION_CLIP_POLYPOLYGON     = 1;    // Transition expressed by parametric clip polygon
TRANSITION_SPECIAL              = 2;    // Transition expressed by hand-crafted function

aTransitionClassOutMap = ['invalid', 'clip polypolygon', 'special'];


BARWIPE_TRANSITION          = 1;
BOXWIPE_TRANSITION          = 2;
FOURBOXWIPE_TRANSITION      = 3;
ELLIPSEWIPE_TRANSITION      = 4; // 17
CLOCKWIPE_TRANSITION        = 5; // 22
PINWHEELWIPE_TRANSITION     = 6; // 23
PUSHWIPE_TRANSITION         = 7; // 35
SLIDEWIPE_TRANSITION        = 8; // 36
FADE_TRANSITION             = 9; // 37
RANDOMBARWIPE_TRANSITION    = 10; // 38
CHECKERBOARDWIPE_TRANSITION = 11; // 39
DISSOLVE_TRANSITION         = 12; // 40

aTransitionTypeInMap = {
'barWipe'           : BARWIPE_TRANSITION,
'boxWipe'           : BOXWIPE_TRANSITION,
'fourBoxWipe'       : FOURBOXWIPE_TRANSITION,
'ellipseWipe'       : ELLIPSEWIPE_TRANSITION,
'clockWipe'         : CLOCKWIPE_TRANSITION,
'pinWheelWipe'      : PINWHEELWIPE_TRANSITION,
'pushWipe'          : PUSHWIPE_TRANSITION,
'slideWipe'         : SLIDEWIPE_TRANSITION,
'fade'              : FADE_TRANSITION,
'randomBarWipe'     : RANDOMBARWIPE_TRANSITION,
'checkerBoardWipe'  : CHECKERBOARDWIPE_TRANSITION,
'dissolve'          : DISSOLVE_TRANSITION
};

aTransitionTypeOutMap = [ '', 'barWipe', 'boxWipe', 'fourBoxWipe', 'ellipseWipe',
'clockWipe', 'pinWheelWipe', 'pushWipe', 'slideWipe',
'fade', 'randomBarWipe', 'checkerBoardWipe', 'dissolve' ];


DEFAULT_TRANS_SUBTYPE               = 0;
LEFTTORIGHT_TRANS_SUBTYPE           = 1;
TOPTOBOTTOM_TRANS_SUBTYPE           = 2;
CORNERSIN_TRANS_SUBTYPE             = 3; // 11
CORNERSOUT_TRANS_SUBTYPE            = 4;
VERTICAL_TRANS_SUBTYPE              = 5;
HORIZONTAL_TRANS_SUBTYPE            = 6; // 14
DOWN_TRANS_SUBTYPE                  = 7; // 19
CIRCLE_TRANS_SUBTYPE                = 8; // 27
CLOCKWISETWELVE_TRANS_SUBTYPE       = 9; // 33
CLOCKWISETHREE_TRANS_SUBTYPE        = 10;
CLOCKWISESIX_TRANS_SUBTYPE          = 11;
CLOCKWISENINE_TRANS_SUBTYPE         = 12;
TWOBLADEVERTICAL_TRANS_SUBTYPE      = 13;
TWOBLADEHORIZONTAL_TRANS_SUBTYPE    = 14;
FOURBLADE_TRANS_SUBTYPE             = 15; // 39
FROMLEFT_TRANS_SUBTYPE              = 16; // 97
FROMTOP_TRANS_SUBTYPE               = 17;
FROMRIGHT_TRANS_SUBTYPE             = 18;
FROMBOTTOM_TRANS_SUBTYPE            = 19;
CROSSFADE_TRANS_SUBTYPE             = 20;
FADETOCOLOR_TRANS_SUBTYPE           = 21;
FADEFROMCOLOR_TRANS_SUBTYPE         = 22;
FADEOVERCOLOR_TRANS_SUBTYPE         = 23;
THREEBLADE_TRANS_SUBTYPE            = 24;
EIGHTBLADE_TRANS_SUBTYPE            = 25;
ONEBLADE_TRANS_SUBTYPE              = 26; // 107
ACROSS_TRANS_SUBTYPE                = 27;

aTransitionSubtypeInMap = {
'default'           : DEFAULT_TRANS_SUBTYPE,
'leftToRight'       : LEFTTORIGHT_TRANS_SUBTYPE,
'topToBottom'       : TOPTOBOTTOM_TRANS_SUBTYPE,
'cornersIn'         : CORNERSIN_TRANS_SUBTYPE,
'cornersOut'        : CORNERSOUT_TRANS_SUBTYPE,
'vertical'          : VERTICAL_TRANS_SUBTYPE,
'horizontal'        : HORIZONTAL_TRANS_SUBTYPE,
'down'              : DOWN_TRANS_SUBTYPE,
'circle'            : CIRCLE_TRANS_SUBTYPE,
'clockwiseTwelve'   : CLOCKWISETWELVE_TRANS_SUBTYPE,
'clockwiseThree'    : CLOCKWISETHREE_TRANS_SUBTYPE,
'clockwiseSix'      : CLOCKWISESIX_TRANS_SUBTYPE,
'clockwiseNine'     : CLOCKWISENINE_TRANS_SUBTYPE,
'twoBladeVertical'  : TWOBLADEVERTICAL_TRANS_SUBTYPE,
'twoBladeHorizontal': TWOBLADEHORIZONTAL_TRANS_SUBTYPE,
'fourBlade'         : FOURBLADE_TRANS_SUBTYPE,
'fromLeft'          : FROMLEFT_TRANS_SUBTYPE,
'fromTop'           : FROMTOP_TRANS_SUBTYPE,
'fromRight'         : FROMRIGHT_TRANS_SUBTYPE,
'fromBottom'        : FROMBOTTOM_TRANS_SUBTYPE,
'crossfade'         : CROSSFADE_TRANS_SUBTYPE,
'fadeToColor'       : FADETOCOLOR_TRANS_SUBTYPE,
'fadeFromColor'     : FADEFROMCOLOR_TRANS_SUBTYPE,
'fadeOverColor'     : FADEOVERCOLOR_TRANS_SUBTYPE,
'threeBlade'        : THREEBLADE_TRANS_SUBTYPE,
'eightBlade'        : EIGHTBLADE_TRANS_SUBTYPE,
'oneBlade'          : ONEBLADE_TRANS_SUBTYPE,
'across'            : ACROSS_TRANS_SUBTYPE
};

aTransitionSubtypeOutMap = [ 'default', 'leftToRight', 'topToBottom', 'cornersIn',
'cornersOut', 'vertical', 'horizontal', 'down', 'circle',
'clockwiseTwelve', 'clockwiseThree', 'clockwiseSix',
'clockwiseNine', 'twoBladeVertical', 'twoBladeHorizontal',
'fourBlade', 'fromLeft', 'fromTop', 'fromRight',
'fromBottom', 'crossfade', 'fadeToColor', 'fadeFromColor',
'fadeOverColor', 'threeBlade', 'eightBlade', 'oneBlade',
'across' ];


TRANSITION_MODE_IN  = 1;
TRANSITION_MODE_OUT = 0;

aTransitionModeInMap = { 'out': TRANSITION_MODE_OUT, 'in': TRANSITION_MODE_IN };
aTransitionModeOutMap = [ 'out', 'in' ];


REVERSEMETHOD_IGNORE                    = 0;
REVERSEMETHOD_INVERT_SWEEP              = 1;
REVERSEMETHOD_SUBTRACT_POLYGON          = 2;
REVERSEMETHOD_SUBTRACT_AND_INVERT       = 3;
REVERSEMETHOD_ROTATE_180                = 4;
REVERSEMETHOD_FLIP_X                    = 5;
REVERSEMETHOD_FLIP_Y                    = 6;

aReverseMethodOutMap = ['ignore', 'invert sweep', 'subtract polygon',
'subtract and invert', 'rotate 180', 'flip x', 'flip y'];


var aTransitionInfoTable = {};

aTransitionInfoTable[0] = {};
aTransitionInfoTable[0][0] =
{
'class' : TRANSITION_INVALID,
'rotationAngle' : 0.0,
'scaleX' : 0.0,
'scaleY' : 0.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : false,
'scaleIsotropically' : false
};


aTransitionInfoTable[BARWIPE_TRANSITION] = {};
aTransitionInfoTable[BARWIPE_TRANSITION][LEFTTORIGHT_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_X,
'outInvertsSweep' : false,
'scaleIsotropically' : false
};
aTransitionInfoTable[BARWIPE_TRANSITION][TOPTOBOTTOM_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_Y,
'outInvertsSweep' : false,
'scaleIsotropically' : false
};

aTransitionInfoTable[FOURBOXWIPE_TRANSITION] = {};
aTransitionInfoTable[FOURBOXWIPE_TRANSITION][CORNERSIN_TRANS_SUBTYPE] =
aTransitionInfoTable[FOURBOXWIPE_TRANSITION][CORNERSOUT_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_SUBTRACT_AND_INVERT,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[ELLIPSEWIPE_TRANSITION] = {};
aTransitionInfoTable[ELLIPSEWIPE_TRANSITION][CIRCLE_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_SUBTRACT_AND_INVERT,
'outInvertsSweep' : true,
'scaleIsotropically' : true
};
aTransitionInfoTable[ELLIPSEWIPE_TRANSITION][HORIZONTAL_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_SUBTRACT_AND_INVERT,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[ELLIPSEWIPE_TRANSITION][VERTICAL_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_SUBTRACT_AND_INVERT,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[CLOCKWIPE_TRANSITION] = {};
aTransitionInfoTable[CLOCKWIPE_TRANSITION][CLOCKWISETWELVE_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_X,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[CLOCKWIPE_TRANSITION][CLOCKWISETHREE_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_Y,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[CLOCKWIPE_TRANSITION][CLOCKWISESIX_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 180.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_X,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[CLOCKWIPE_TRANSITION][CLOCKWISENINE_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 270.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_Y,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[PINWHEELWIPE_TRANSITION] = {};
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][ONEBLADE_TRANS_SUBTYPE] =
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][TWOBLADEVERTICAL_TRANS_SUBTYPE] =
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][THREEBLADE_TRANS_SUBTYPE] =
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][FOURBLADE_TRANS_SUBTYPE] =
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][EIGHTBLADE_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_X,
'outInvertsSweep' : true,
'scaleIsotropically' : true
};
aTransitionInfoTable[PINWHEELWIPE_TRANSITION][TWOBLADEHORIZONTAL_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : -90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_Y,
'outInvertsSweep' : true,
'scaleIsotropically' : true
};

aTransitionInfoTable[PUSHWIPE_TRANSITION] = {};
aTransitionInfoTable[PUSHWIPE_TRANSITION][FROMLEFT_TRANS_SUBTYPE] =
aTransitionInfoTable[PUSHWIPE_TRANSITION][FROMTOP_TRANS_SUBTYPE] =
aTransitionInfoTable[PUSHWIPE_TRANSITION][FROMRIGHT_TRANS_SUBTYPE] =
aTransitionInfoTable[PUSHWIPE_TRANSITION][FROMBOTTOM_TRANS_SUBTYPE] =
{
'class' : TRANSITION_SPECIAL,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[SLIDEWIPE_TRANSITION] = {};
aTransitionInfoTable[SLIDEWIPE_TRANSITION][FROMLEFT_TRANS_SUBTYPE] =
aTransitionInfoTable[SLIDEWIPE_TRANSITION][FROMTOP_TRANS_SUBTYPE] =
aTransitionInfoTable[SLIDEWIPE_TRANSITION][FROMRIGHT_TRANS_SUBTYPE] =
aTransitionInfoTable[SLIDEWIPE_TRANSITION][FROMBOTTOM_TRANS_SUBTYPE] =
{
'class' : TRANSITION_SPECIAL,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[FADE_TRANSITION] = {};
aTransitionInfoTable[FADE_TRANSITION][CROSSFADE_TRANS_SUBTYPE] =
aTransitionInfoTable[FADE_TRANSITION][FADETOCOLOR_TRANS_SUBTYPE] =
aTransitionInfoTable[FADE_TRANSITION][FADEFROMCOLOR_TRANS_SUBTYPE] =
aTransitionInfoTable[FADE_TRANSITION][FADEOVERCOLOR_TRANS_SUBTYPE] =
{
'class' : TRANSITION_SPECIAL,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};


aTransitionInfoTable[RANDOMBARWIPE_TRANSITION] = {};
aTransitionInfoTable[RANDOMBARWIPE_TRANSITION][VERTICAL_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[RANDOMBARWIPE_TRANSITION][HORIZONTAL_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[CHECKERBOARDWIPE_TRANSITION] = {};
aTransitionInfoTable[CHECKERBOARDWIPE_TRANSITION][DOWN_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 90.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_Y,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};
aTransitionInfoTable[CHECKERBOARDWIPE_TRANSITION][ACROSS_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_FLIP_X,
'outInvertsSweep' : true,
'scaleIsotropically' : false
};

aTransitionInfoTable[DISSOLVE_TRANSITION] = {};
aTransitionInfoTable[DISSOLVE_TRANSITION][DEFAULT_TRANS_SUBTYPE] =
{
'class' : TRANSITION_CLIP_POLYPOLYGON,
'rotationAngle' : 0.0,
'scaleX' : 1.0,
'scaleY' : 1.0,
'reverseMethod' : REVERSEMETHOD_IGNORE,
'outInvertsSweep' : true,
'scaleIsotropically' : true
};


function createStateTransitionTable()
{
var aSTT = {};

aSTT[RESTART_MODE_NEVER] = {};
aSTT[RESTART_MODE_WHEN_NOT_ACTIVE] = {};
aSTT[RESTART_MODE_ALWAYS] = {};

var aTable =
aSTT[RESTART_MODE_NEVER][FILL_MODE_REMOVE] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = ENDED_NODE;
aTable[FROZEN_NODE]         = INVALID_NODE;  // this state is unreachable here
aTable[ENDED_NODE]          = ENDED_NODE;    // this state is a sink here (cannot restart)

aTable =
aSTT[RESTART_MODE_NEVER][FILL_MODE_FREEZE] =
aSTT[RESTART_MODE_NEVER][FILL_MODE_HOLD] =
aSTT[RESTART_MODE_NEVER][FILL_MODE_TRANSITION] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = FROZEN_NODE | ENDED_NODE;
aTable[FROZEN_NODE]         = ENDED_NODE;
aTable[ENDED_NODE]          = ENDED_NODE;   // this state is a sink here (cannot restart)

aTable =
aSTT[RESTART_MODE_WHEN_NOT_ACTIVE][FILL_MODE_REMOVE] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = ENDED_NODE;
aTable[FROZEN_NODE]         = INVALID_NODE;  // this state is unreachable here
aTable[ENDED_NODE]          = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible

aTable =
aSTT[RESTART_MODE_WHEN_NOT_ACTIVE][FILL_MODE_FREEZE] =
aSTT[RESTART_MODE_WHEN_NOT_ACTIVE][FILL_MODE_HOLD] =
aSTT[RESTART_MODE_WHEN_NOT_ACTIVE][FILL_MODE_TRANSITION] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = FROZEN_NODE | ENDED_NODE;
aTable[FROZEN_NODE]         = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible
aTable[ENDED_NODE]          = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible

aTable =
aSTT[RESTART_MODE_ALWAYS][FILL_MODE_REMOVE] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible
aTable[FROZEN_NODE]         = INVALID_NODE;  // this state is unreachable here
aTable[ENDED_NODE]          = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible

aTable =
aSTT[RESTART_MODE_ALWAYS][FILL_MODE_FREEZE] =
aSTT[RESTART_MODE_ALWAYS][FILL_MODE_HOLD] =
aSTT[RESTART_MODE_ALWAYS][FILL_MODE_TRANSITION] = {};
aTable[INVALID_NODE]        = INVALID_NODE;
aTable[UNRESOLVED_NODE]     = RESOLVED_NODE | ENDED_NODE;
aTable[RESOLVED_NODE]       = ACTIVE_NODE | ENDED_NODE;
aTable[ACTIVE_NODE]         = RESOLVED_NODE | ACTIVE_NODE | FROZEN_NODE | ENDED_NODE;
aTable[FROZEN_NODE]         = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible
aTable[ENDED_NODE]          = RESOLVED_NODE | ACTIVE_NODE | ENDED_NODE;  // restart is possible

return aSTT;
}

var aStateTransitionTable = createStateTransitionTable();


function getTransitionTable( eRestartMode, eFillMode )
{
if( eRestartMode == RESTART_MODE_DEFAULT )
{
log( 'getTransitionTable: unexpected restart mode: ' + eRestartMode
+ '. Used NEVER instead.');
eRestartMode = RESTART_MODE_NEVER;
}

if( eFillMode == FILL_MODE_DEFAULT ||
eFillMode == FILL_MODE_AUTO )
{
eFillMode = FILL_MODE_REMOVE;
}

return aStateTransitionTable[eRestartMode][eFillMode];
}


var EVENT_TRIGGER_UNKNOWN               = 0;
var EVENT_TRIGGER_ON_SLIDE_BEGIN        = 1;
var EVENT_TRIGGER_ON_SLIDE_END          = 2;
var EVENT_TRIGGER_BEGIN_EVENT           = 3;
var EVENT_TRIGGER_END_EVENT             = 4;
var EVENT_TRIGGER_ON_CLICK              = 5;
var EVENT_TRIGGER_ON_DBL_CLICK          = 6;
var EVENT_TRIGGER_ON_MOUSE_ENTER        = 7;
var EVENT_TRIGGER_ON_MOUSE_LEAVE        = 8;
var EVENT_TRIGGER_ON_NEXT_EFFECT        = 9;
var EVENT_TRIGGER_ON_PREV_EFFECT        = 10;
var EVENT_TRIGGER_REPEAT                = 11;

aEventTriggerOutMap = [ 'unknown', 'slideBegin', 'slideEnd', 'begin', 'end', 'click',
'doubleClick', 'mouseEnter', 'mouseLeave', 'next', 'previous', 'repeat' ];


function getEventTriggerType( sEventTrigger )
{
if( sEventTrigger == 'begin' )
return EVENT_TRIGGER_BEGIN_EVENT;
else if( sEventTrigger == 'end' )
return EVENT_TRIGGER_END_EVENT;
else if( sEventTrigger == 'next' )
return EVENT_TRIGGER_ON_NEXT_EFFECT;
else if( sEventTrigger == 'prev' )
return EVENT_TRIGGER_ON_PREV_EFFECT;
else if( sEventTrigger == 'click' )
return EVENT_TRIGGER_ON_CLICK;
else
return EVENT_TRIGGER_UNKNOWN;
}


var UNKNOWN_TIMING          = 0;
var OFFSET_TIMING           = 1;
var WALLCLOCK_TIMING        = 2;
var INDEFINITE_TIMING       = 3;
var EVENT_TIMING            = 4;
var SYNCBASE_TIMING         = 5;
var MEDIA_TIMING            = 6;

aTimingTypeOutMap = [ 'unknown', 'offset', 'wallclock', 'indefinite', 'event', 'syncbase', 'media' ];


var CHARCODE_PLUS       = '+'.charCodeAt(0);
var CHARCODE_MINUS      = '-'.charCodeAt(0);
var CHARCODE_0          = '0'.charCodeAt(0);
var CHARCODE_9          = '9'.charCodeAt(0);


function Timing( aAnimationNode, sTimingAttribute )
{
this.aAnimationNode = aAnimationNode;     // the node, the timing attribute belongs to
this.sTimingDescription = removeWhiteSpaces( sTimingAttribute );
this.eTimingType = UNKNOWN_TIMING;
this.nOffset = 0.0;                       // in seconds
this.sEventBaseElementId = '';            // the element id for event based timing
this.eEventType = EVENT_TRIGGER_UNKNOWN;  // the event type
}

Timing.prototype.getAnimationNode = function()
{
return this.aAnimationNode;
};

Timing.prototype.getType = function()
{
return this.eTimingType;
};

Timing.prototype.getOffset = function()
{
return this.nOffset;
};

Timing.prototype.getEventBaseElementId = function()
{
return this.sEventBaseElementId;
};

Timing.prototype.getEventType = function()
{
return this.eEventType;
};

Timing.prototype.parse = function()
{
if( !this.sTimingDescription )
{
this.eTimingType = OFFSET_TIMING;
return;
}

if( this.sTimingDescription == 'indefinite' )
this.eTimingType = INDEFINITE_TIMING;
else
{
var nFirstCharCode = this.sTimingDescription.charCodeAt(0);
var bPositiveOffset = !( nFirstCharCode == CHARCODE_MINUS );
if ( ( nFirstCharCode == CHARCODE_PLUS ) ||
( nFirstCharCode == CHARCODE_MINUS ) ||
( ( nFirstCharCode >= CHARCODE_0 ) && ( nFirstCharCode <= CHARCODE_9 ) ) )
{
var sClockValue
= ( ( nFirstCharCode == CHARCODE_PLUS ) || ( nFirstCharCode == CHARCODE_MINUS ) )
? this.sTimingDescription.substr( 1 )
: this.sTimingDescription;

var TimeInSec = Timing.parseClockValue( sClockValue );
if( TimeInSec != undefined )
{
this.eTimingType = OFFSET_TIMING;
this.nOffset = bPositiveOffset ? TimeInSec : -TimeInSec;
}
}
else
{
var aTimingSplit = [];
bPositiveOffset = true;
if( this.sTimingDescription.indexOf( '+' ) != -1 )
{
aTimingSplit = this.sTimingDescription.split( '+' );
}
else if( this.sTimingDescription.indexOf( '-' ) != -1 )
{
aTimingSplit = this.sTimingDescription.split( '-' );
bPositiveOffset = false;
}
else
{
aTimingSplit[0] = this.sTimingDescription;
aTimingSplit[1] = '';
}

if( aTimingSplit[0].indexOf( '.' ) != -1 )
{
var aEventSplit = aTimingSplit[0].split( '.' );
this.sEventBaseElementId = aEventSplit[0];
this.eEventType = getEventTriggerType( aEventSplit[1] );
}
else
{
this.eEventType = getEventTriggerType( aTimingSplit[0] );
}

if( this.eEventType == EVENT_TRIGGER_UNKNOWN )
return;

if( ( this.eEventType == EVENT_TRIGGER_BEGIN_EVENT ) ||
( this.eEventType == EVENT_TRIGGER_END_EVENT ) )
{
this.eTimingType = SYNCBASE_TIMING;
}
else
{
this.eTimingType = EVENT_TIMING;
}

if( aTimingSplit[1] )
{
sClockValue = aTimingSplit[1];
TimeInSec = Timing.parseClockValue( sClockValue );
if( TimeInSec != undefined )
{
this.nOffset = ( bPositiveOffset ) ? TimeInSec : -TimeInSec;
}
else
{
this.eTimingType = UNKNOWN_TIMING;
}

}
}
}

};

Timing.parseClockValue = function( sClockValue )
{
if( !sClockValue )
return 0.0;

var nTimeInSec = undefined;

var reFullClockValue = /^([0-9]+):([0-5][0-9]):([0-5][0-9])(.[0-9]+)?$/;
var rePartialClockValue = /^([0-5][0-9]):([0-5][0-9])(.[0-9]+)?$/;
var reTimeCountValue = /^([0-9]+)(.[0-9]+)?(h|min|s|ms)?$/;

if( reFullClockValue.test( sClockValue ) )
{
var aClockTimeParts = reFullClockValue.exec( sClockValue );

var nHours = parseInt( aClockTimeParts[1] );
var nMinutes = parseInt( aClockTimeParts[2] );
var nSeconds = parseInt( aClockTimeParts[3] );
if( aClockTimeParts[4] )
nSeconds += parseFloat( aClockTimeParts[4] );

nTimeInSec = ( ( nHours * 60 ) +  nMinutes ) * 60 + nSeconds;

}
else if( rePartialClockValue.test( sClockValue ) )
{
aClockTimeParts = rePartialClockValue.exec( sClockValue );

nMinutes = parseInt( aClockTimeParts[1] );
nSeconds = parseInt( aClockTimeParts[2] );
if( aClockTimeParts[3] )
nSeconds += parseFloat( aClockTimeParts[3] );

nTimeInSec = nMinutes * 60 + nSeconds;
}
else if( reTimeCountValue.test( sClockValue ) )
{
aClockTimeParts = reTimeCountValue.exec( sClockValue );

var nTimeCount = parseInt( aClockTimeParts[1] );
if( aClockTimeParts[2] )
nTimeCount += parseFloat( aClockTimeParts[2] );

if( aClockTimeParts[3] )
{
if( aClockTimeParts[3] == 'h' )
{
nTimeInSec = nTimeCount * 3600;
}
else if( aClockTimeParts[3] == 'min' )
{
nTimeInSec = nTimeCount * 60;
}
else if( aClockTimeParts[3] == 's' )
{
nTimeInSec = nTimeCount;
}
else if( aClockTimeParts[3] == 'ms' )
{
nTimeInSec = nTimeCount / 1000;
}
}
else
{
nTimeInSec = nTimeCount;
}

}

if( nTimeInSec )
nTimeInSec = parseFloat( nTimeInSec.toFixed( 3 ) );
return nTimeInSec;
};

Timing.prototype.info = function( bVerbose )
{

var sInfo = '';

if( bVerbose )
{
sInfo = 'description: ' + this.sTimingDescription + ', ';

sInfo += ', type: ' +  aTimingTypeOutMap[ this.getType() ];
sInfo += ', offset: ' + this.getOffset();
sInfo += ', event base element id: ' + this.getEventBaseElementId();
sInfo += ', timing event type: ' + aEventTriggerOutMap[ this.getEventType() ];
}
else
{
switch( this.getType() )
{
case INDEFINITE_TIMING:
sInfo += 'indefinite';
break;
case OFFSET_TIMING:
sInfo += this.getOffset();
break;
case EVENT_TIMING:
case SYNCBASE_TIMING:
if( this.getEventBaseElementId() )
sInfo += this.getEventBaseElementId() + '.';
sInfo += aEventTriggerOutMap[ this.getEventType() ];
if( this.getOffset() )
{
if( this.getOffset() > 0 )
sInfo += '+';
sInfo += this.getOffset();
}
}
}

return sInfo;
};


function Duration( sDurationAttribute )
{
this.bIndefinite = false;
this.bMedia = false;
this.nValue = undefined;
this.bDefined = false;

if( !sDurationAttribute )
return;

if( sDurationAttribute == 'indefinite' )
this.bIndefinite = true;
else if( sDurationAttribute == 'media' )
this.bMedia = true;
else
{
this.nValue = Timing.parseClockValue( sDurationAttribute );
if( this.nValue <= 0.0 )
this.nValue = 0.001;  // duration must be always greater than 0
}
this.bDefined = true;
}


Duration.prototype.isSet = function()
{
return this.bDefined;
};

Duration.prototype.isIndefinite = function()
{
return this.bIndefinite;
};

Duration.prototype.isMedia = function()
{
return this.bMedia;
};

Duration.prototype.isValue = function()
{
return this.nValue != undefined;
};

Duration.prototype.getValue= function()
{
return this.nValue;
};

Duration.prototype.info= function()
{
var sInfo;

if( this.isIndefinite() )
sInfo = 'indefinite';
else if( this.isMedia() )
sInfo = 'media';
else if( this.getValue() )
sInfo = this.getValue();

return sInfo;
};


function AnimationNode()
{
}

AnimationNode.prototype.init = function() {};
AnimationNode.prototype.resolve = function() {};
AnimationNode.prototype.activate = function() {};
AnimationNode.prototype.deactivate = function() {};
AnimationNode.prototype.end = function() {};
AnimationNode.prototype.getState = function() {};
AnimationNode.prototype.registerDeactivatingListener = function() {};
AnimationNode.prototype.notifyDeactivating = function() {};


function NodeContext( aSlideShowContext )
{
this.aContext = aSlideShowContext;
this.aAnimationNodeMap = null;
this.aAnimatedElementMap = null;
this.aSourceEventElementMap = null;
this.nStartDelay = 0.0;
this.bFirstRun = undefined;
this.aSlideHeight = HEIGHT;
this.aSlideWidth = WIDTH;
}


NodeContext.prototype.makeSourceEventElement = function( sId, aEventBaseElem )
{
if( !aEventBaseElem )
{
log( 'NodeContext.makeSourceEventElement: event base element is not valid' );
return null;
}

if( !this.aContext.aEventMultiplexer )
{
log( 'NodeContext.makeSourceEventElement: event multiplexer not initialized' );
return null;
}

if( !this.aSourceEventElementMap[ sId ] )
{
this.aSourceEventElementMap[ sId ] = new SourceEventElement( sId, aEventBaseElem, this.aContext.aEventMultiplexer );
}
return this.aSourceEventElementMap[ sId ];
};


function StateTransition( aBaseNode )
{
this.aNode = aBaseNode;
this.eToState = INVALID_NODE;
}

StateTransition.prototype.enter = function( eNodeState, bForce )
{
if( !bForce ) bForce = false;

if( this.eToState != INVALID_NODE )
{
log( 'StateTransition.enter: commit() before enter()ing again!' );
return false;
}
if( !bForce && !this.aNode.isTransition( this.aNode.getState(), eNodeState  ) )
return false;

if( ( this.aNode.nCurrentStateTransition & eNodeState ) != 0 )
return false; // already in wanted transition

this.aNode.nCurrentStateTransition |= eNodeState;
this.eToState = eNodeState;
return true;
};

StateTransition.prototype.commit = function()
{
if( this.eToState != INVALID_NODE )
{
this.aNode.eCurrentState = this.eToState;
this.clear();
}
};

StateTransition.prototype.clear = function()
{
if( this.eToState != INVALID_NODE )
{
this.aNode.nCurrentStateTransition &= ~this.eToState;
this.eToState = INVALID_NODE;
}
};


function BaseNode( aAnimElem, aParentNode, aNodeContext )
{
this.nId = getUniqueId();
this.sClassName = 'BaseNode';

if( !aAnimElem )
log( 'BaseNode(id:' + this.nId + ') constructor: aAnimElem is not valid' );

if( !aNodeContext )
log( 'BaseNode(id:' + this.nId + ') constructor: aNodeContext is not valid' );

if( !aNodeContext.aContext )
log( 'BaseNode(id:' + this.nId + ') constructor: aNodeContext.aContext is not valid' );


this.bIsContainer = false;
this.aElement = aAnimElem;
this.aParentNode = aParentNode;
this.aNodeContext = aNodeContext;
this.aContext = aNodeContext.aContext;
this.nStartDelay = aNodeContext.nStartDelay;
this.eCurrentState = UNRESOLVED_NODE;
this.nCurrentStateTransition = 0;
this.aDeactivatingListenerArray = [];
this.aActivationEvent = null;
this.aDeactivationEvent = null;

this.aBegin = null;
this.aDuration = null;
this.aEnd = null;
this.bMainSequenceRootNode = false;
this.bInteractiveSequenceRootNode = false;
this.eFillMode = FILL_MODE_FREEZE;
this.eRestartMode = RESTART_MODE_NEVER;
this.nReapeatCount = undefined;
this.nAccelerate = 0.0;
this.nDecelerate = 0.0;
this.bAutoReverse = false;

}
extend( BaseNode, AnimationNode );


BaseNode.prototype.getId = function()
{
return this.nId;
};

BaseNode.prototype.parseElement = function()
{
var aAnimElem = this.aElement;

var sIdAttr = aAnimElem.getAttributeNS( NSS['xml'], 'id' );
if( sIdAttr )
this.aNodeContext.aAnimationNodeMap[ sIdAttr ] = this;

this.aBegin = null;
var sBeginAttr = aAnimElem.getAttributeNS( NSS['smil'], 'begin' );
this.aBegin = new Timing( this, sBeginAttr );
this.aBegin.parse();

this.aEnd = null;
var sEndAttr = aAnimElem.getAttributeNS( NSS['smil'], 'end' );
if( sEndAttr )
{
this.aEnd = new Timing( this, sEndAttr );
this.aEnd.parse();
}

this.aDuration = null;
var sDurAttr = aAnimElem.getAttributeNS( NSS['smil'], 'dur' );
this.aDuration = new Duration( sDurAttr );
if( !this.aDuration.isSet() )
{
if( this.isContainer() )
this.aDuration = null;
else
this.aDuration = new Duration( 'indefinite' );
}

var sFillAttr = aAnimElem.getAttributeNS( NSS['smil'], 'fill' );
if( sFillAttr && aFillModeInMap[ sFillAttr ])
this.eFillMode = aFillModeInMap[ sFillAttr ];
else
this.eFillMode = FILL_MODE_DEFAULT;

var sRestartAttr = aAnimElem.getAttributeNS( NSS['smil'], 'restart' );
if( sRestartAttr && aRestartModeInMap[ sRestartAttr ] )
this.eRestartMode = aRestartModeInMap[ sRestartAttr ];
else
this.eRestartMode = RESTART_MODE_DEFAULT;

var sRepeatCount = aAnimElem.getAttributeNS( NSS['smil'], 'repeatCount' );
if( !sRepeatCount )
this.nReapeatCount = 1;
else
this.nReapeatCount = parseFloat( sRepeatCount );
if( ( isNaN(this.nReapeatCount) ) && ( sRepeatCount != 'indefinite' ) )
this.nReapeatCount = 1;

this.nAccelerate = 0.0;
var sAccelerateAttr = aAnimElem.getAttributeNS( NSS['smil'], 'accelerate' );
if( sAccelerateAttr )
this.nAccelerate = parseFloat( sAccelerateAttr );
if( isNaN(this.nAccelerate) )
this.nAccelerate = 0.0;

this.nDecelerate = 0.0;
var sDecelerateAttr = aAnimElem.getAttributeNS( NSS['smil'], 'decelerate' );
if( sDecelerateAttr )
this.nDecelerate = parseFloat( sDecelerateAttr );
if( isNaN(this.nDecelerate) )
this.nDecelerate = 0.0;

this.bAutoreverse = false;
var sAutoReverseAttr = aAnimElem.getAttributeNS( NSS['smil'], 'autoReverse' );
if( sAutoReverseAttr == 'true' )
this.bAutoreverse = true;


if( this.eFillMode == FILL_MODE_DEFAULT )
if( this.getParentNode() )
this.eFillMode = this.getParentNode().getFillMode();
else
this.eFillMode = FILL_MODE_AUTO;

if( this.eFillMode ==  FILL_MODE_AUTO ) // see SMIL recommendation document
{
this.eFillMode = ( this.aEnd ||
( this.nReapeatCount != 1) ||
( this.aDuration && !this.aDuration.isIndefinite() ) )
? FILL_MODE_REMOVE
: FILL_MODE_FREEZE;
}

if( this.eRestartMode == RESTART_MODE_DEFAULT )
if( this.getParentNode() )
this.eRestartMode = this.getParentNode().getRestartMode();
else
this.eRestartMode = RESTART_MODE_ALWAYS;

if( ( this.nAccelerate + this.nDecelerate ) > 1.0 )
{
this.nAccelerate = 0.0;
this.nDecelerate = 0.0;
}

this.aStateTransTable = getTransitionTable( this.getRestartMode(), this.getFillMode() );

return true;
};

BaseNode.prototype.getParentNode = function()
{
return this.aParentNode;
};

BaseNode.prototype.init = function()
{
this.DBG( this.callInfo( 'init' ) );
if( ! this.checkValidNode() )
return false;
if( this.aActivationEvent )
this.aActivationEvent.dispose();
if( this.aDeactivationEvent )
this.aDeactivationEvent.dispose();

this.eCurrentState = UNRESOLVED_NODE;

return this.init_st();
};

BaseNode.prototype.resolve = function()
{
if( ! this.checkValidNode() )
return false;

this.DBG( this.callInfo( 'resolve' ) );

if( this.eCurrentState == RESOLVED_NODE )
log( 'BaseNode.resolve: already in RESOLVED state' );

var aStateTrans = new StateTransition( this );

if( aStateTrans.enter( RESOLVED_NODE ) &&
this.isTransition( RESOLVED_NODE, ACTIVE_NODE ) &&
this.resolve_st() )
{
aStateTrans.commit();

if( this.aActivationEvent )
{
this.aActivationEvent.charge();
}
else
{
this.aActivationEvent = makeDelay( bind( this, this.activate ), this.getBegin().getOffset() + this.nStartDelay );
}
registerEvent( this.getId(), this.getBegin(), this.aActivationEvent, this.aNodeContext );

return true;
}

return false;
};

BaseNode.prototype.activate = function()
{
if( ! this.checkValidNode() )
return false;

if( this.eCurrentState == ACTIVE_NODE )
log( 'BaseNode.activate: already in ACTIVE state' );

this.DBG( this.callInfo( 'activate' ), getCurrentSystemTime() );

var aStateTrans = new StateTransition( this );

if( aStateTrans.enter( ACTIVE_NODE ) )
{
this.activate_st();
aStateTrans.commit();
if( !this.aContext.aEventMultiplexer )
log( 'BaseNode.activate: this.aContext.aEventMultiplexer is not valid' );
this.aContext.aEventMultiplexer.notifyEvent( EVENT_TRIGGER_BEGIN_EVENT, this.getId() );
return true;
}
return false;
};

BaseNode.prototype.deactivate = function()
{
if( this.inStateOrTransition( ENDED_NODE | FROZEN_NODE ) || !this.checkValidNode() )
return;

if( this.isTransition( this.eCurrentState, FROZEN_NODE ) )
{
this.DBG( this.callInfo( 'deactivate' ), getCurrentSystemTime() );

var aStateTrans = new StateTransition( this );
if( aStateTrans.enter( FROZEN_NODE, true /* FORCE */ ) )
{
this.deactivate_st( FROZEN_NODE );
aStateTrans.commit();

this.notifyEndListeners();

if( this.aActivationEvent )
this.aActivationEvent.dispose();
if( this.aDeactivationEvent )
this.aDeactivationEvent.dispose();
}
}
else
{
this.end();
}
};

BaseNode.prototype.end = function()
{
var bIsFrozenOrInTransitionToFrozen = this.inStateOrTransition( FROZEN_NODE );
if( this.inStateOrTransition( ENDED_NODE ) || !this.checkValidNode() )
return;

if( !(this.isTransition( this.eCurrentState, ENDED_NODE ) ) )
log( 'BaseNode.end: end state not reachable in transition table' );

this.DBG( this.callInfo( 'end' ), getCurrentSystemTime() );

var aStateTrans = new StateTransition( this );
if( aStateTrans.enter( ENDED_NODE, true /* FORCE */ ) )
{
this.deactivate_st( ENDED_NODE );
aStateTrans.commit();

if( !bIsFrozenOrInTransitionToFrozen )
this.notifyEndListeners();

if( this.aActivationEvent )
this.aActivationEvent.dispose();
if( this.aDeactivationEvent )
this.aDeactivationEvent.dispose();
}
};

BaseNode.prototype.dispose = function()
{
if( this.aActivationEvent )
this.aActivationEvent.dispose();
if( this.aDeactivationEvent )
this.aDeactivationEvent.dispose();
this.aDeactivatingListenerArray = [];
};

BaseNode.prototype.getState = function()
{
return this.eCurrentState;
};

BaseNode.prototype.registerDeactivatingListener = function( aNotifiee )
{
if (! this.checkValidNode())
return false;

if( !aNotifiee )
{
log( 'BaseNode.registerDeactivatingListener(): invalid notifee' );
return false;
}
this.aDeactivatingListenerArray.push( aNotifiee );

return true;
};

BaseNode.prototype.notifyDeactivating = function( aNotifier )
{
assert( ( aNotifier.getState() == FROZEN_NODE ) || ( aNotifier.getState() == ENDED_NODE ),
'BaseNode.notifyDeactivating: Notifier node is neither in FROZEN nor in ENDED state' );
};

BaseNode.prototype.isMainSequenceRootNode = function()
{
return this.bMainSequenceRootNode;
};

BaseNode.prototype.isInteractiveSequenceRootNode = function()
{
return this.bInteractiveSequenceRootNode;
};

BaseNode.prototype.makeDeactivationEvent = function( nDelay )
{
if( this.aDeactivationEvent )
{
this.aDeactivationEvent.charge();
}
else
{
if( typeof( nDelay ) == typeof(0) )
this.aDeactivationEvent = makeDelay( bind( this, this.deactivate ), nDelay );
else
this.aDeactivationEvent = null;
}
return this.aDeactivationEvent;
};

BaseNode.prototype.scheduleDeactivationEvent = function( aEvent )
{
this.DBG( this.callInfo( 'scheduleDeactivationEvent' ) );

if( !aEvent )
{
if( this.getDuration() && this.getDuration().isValue() )
aEvent = this.makeDeactivationEvent( this.getDuration().getValue() );
}
if( aEvent )
{
this.aContext.aTimerEventQueue.addEvent( aEvent );
}
};

BaseNode.prototype.checkValidNode = function()
{
return ( this.eCurrentState != INVALID_NODE );
};

BaseNode.prototype.init_st = function()
{
return true;
};

BaseNode.prototype.resolve_st = function()
{
return true;
};

BaseNode.prototype.activate_st = function()
{
this.scheduleDeactivationEvent();
};

BaseNode.prototype.deactivate_st = function( aNodeState )
{
};

BaseNode.prototype.notifyEndListeners = function()
{
var nDeactivatingListenerCount = this.aDeactivatingListenerArray.length;

for( var i = 0; i < nDeactivatingListenerCount; ++i )
{
this.aDeactivatingListenerArray[i].notifyDeactivating( this );
}

this.aContext.aEventMultiplexer.notifyEvent( EVENT_TRIGGER_END_EVENT, this.getId() );
if( this.getParentNode() && this.getParentNode().isMainSequenceRootNode() )
this.aContext.aEventMultiplexer.notifyNextEffectEndEvent();
};

BaseNode.prototype.getContext = function()
{
return this.aContext;
};

BaseNode.prototype.isTransition = function( eFromState, eToState )
{
return ( ( this.aStateTransTable[ eFromState ] & eToState ) != 0 );
};

BaseNode.prototype.inStateOrTransition = function( nMask )
{
return ( ( ( this.eCurrentState & nMask ) != 0 ) || ( ( this.nCurrentStateTransition & nMask ) != 0 ) );
};

BaseNode.prototype.isContainer = function()
{
return this.bIsContainer;
};

BaseNode.prototype.getBegin = function()
{
return this.aBegin;
};

BaseNode.prototype.getDuration = function()
{
return this.aDuration;
};

BaseNode.prototype.getEnd = function()
{
return this.aEnd;
};

BaseNode.prototype.getFillMode = function()
{
return this.eFillMode;
};

BaseNode.prototype.getRestartMode = function()
{
return this.eRestartMode;
};

BaseNode.prototype.getRepeatCount = function()
{
return this.nReapeatCount;
};

BaseNode.prototype.getAccelerateValue = function()
{
return this.nAccelerate;
};

BaseNode.prototype.getDecelerateValue = function()
{
return this.nDecelerate;
};

BaseNode.prototype.isAutoReverseEnabled = function()
{
return this.bAutoreverse;
};

BaseNode.prototype.info = function( bVerbose )
{
var sInfo = 'class name: ' + this.sClassName;
sInfo += ';  element name: ' + this.aElement.localName;
sInfo += ';  id: ' + this.getId();
sInfo += ';  state: ' + getNodeStateName( this.getState() );

if( bVerbose )
{
sInfo += ';  is container: ' + this.isContainer();

if( this.getBegin() )
sInfo += ';  begin: ' + this.getBegin().info();

if( this.getDuration() )
sInfo += ';  dur: ' + this.getDuration().info();

if( this.getEnd() )
sInfo += ';  end: ' + this.getEnd().info();

if( this.getFillMode() )
sInfo += ';  fill: ' + aFillModeOutMap[ this.getFillMode() ];

if( this.getRestartMode() )
sInfo += ';  restart: ' + aRestartModeOutMap[ this.getRestartMode() ];

if( this.getRepeatCount() && ( this.getRepeatCount() != 1.0 ) )
sInfo += ';  repeatCount: ' + this.getRepeatCount();

if( this.getAccelerateValue() )
sInfo += ';  accelerate: ' + this.getAccelerateValue();

if( this.getDecelerateValue() )
sInfo += ';  decelerate: ' + this.getDecelerateValue();

if( this.isAutoReverseEnabled() )
sInfo += ';  autoReverse: true';

}

return sInfo;
};

BaseNode.prototype.callInfo = function( sMethodName )
{
var sInfo = this.sClassName +
'( ' + this.getId() +
', ' + getNodeStateName( this.getState() ) +
' ).' + sMethodName;
return sInfo;
};

BaseNode.prototype.DBG = function( sMessage, nTime )
{
ANIMDBG.print( sMessage, nTime );
};


function AnimationBaseNode( aAnimElem, aParentNode, aNodeContext )
{
AnimationBaseNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'AnimationBaseNode';
this.bIsContainer = false;
this.aTargetElement = null;
this.bIsTargetTextElement = false;
this.aAnimatedElement = null;
this.aActivity = null;

this.nMinFrameCount = undefined;
this.eAdditiveMode = undefined;

}
extend( AnimationBaseNode, BaseNode );


AnimationBaseNode.prototype.parseElement = function()
{
var bRet = AnimationBaseNode.superclass.parseElement.call( this );

var aAnimElem = this.aElement;

this.aTargetElement = null;
var sTargetElementAttr = aAnimElem.getAttributeNS( NSS['smil'], 'targetElement' );
if( sTargetElementAttr )
this.aTargetElement = document.getElementById( sTargetElementAttr );

if( !this.aTargetElement )
{
this.eCurrentState = INVALID_NODE;
log( 'AnimationBaseNode.parseElement: target element not found: ' + sTargetElementAttr );
}

var sSubItemAttr = aAnimElem.getAttributeNS( NSS['anim'], 'sub-item' );
this.bIsTargetTextElement = ( sSubItemAttr && ( sSubItemAttr === 'text' ) );

var sAdditiveAttr = aAnimElem.getAttributeNS( NSS['smil'], 'additive' );
if( sAdditiveAttr && aAddittiveModeInMap[sAdditiveAttr] )
this.eAdditiveMode = aAddittiveModeInMap[sAdditiveAttr];
else
this.eAdditiveMode = ADDITIVE_MODE_REPLACE;

this.nMinFrameCount = ( this.getDuration().isValue() )
? ( this.getDuration().getValue() * MINIMUM_FRAMES_PER_SECONDS )
: MINIMUM_FRAMES_PER_SECONDS;
if( this.nMinFrameCount < 1.0 )
this.nMinFrameCount = 1;
else if( this.nMinFrameCount > MINIMUM_FRAMES_PER_SECONDS )
this.nMinFrameCount = MINIMUM_FRAMES_PER_SECONDS;


if( this.aTargetElement )
{
if( aAnimElem.getAttributeNS( NSS['smil'], 'attributeName' ) === 'visibility' )
{
if( aAnimElem.getAttributeNS( NSS['smil'], 'to' ) === 'visible' )
this.aTargetElement.setAttribute( 'visibility', 'hidden' );
}

if( !this.aNodeContext.aAnimatedElementMap[ sTargetElementAttr ] )
{
if( this.bIsTargetTextElement )
{
this.aNodeContext.aAnimatedElementMap[ sTargetElementAttr ]
= new AnimatedTextElement( this.aTargetElement );
}
else
{
this.aNodeContext.aAnimatedElementMap[ sTargetElementAttr ]
= new AnimatedElement( this.aTargetElement );
}
}
this.aAnimatedElement = this.aNodeContext.aAnimatedElementMap[ sTargetElementAttr ];

this.aAnimatedElement.setAdditiveMode( this.eAdditiveMode );
}


return bRet;
};

AnimationBaseNode.prototype.init_st = function()
{
if( this.aActivity )
this.aActivity.activate( makeEvent( bind( this, this.deactivate ) ) );
else
this.aActivity = this.createActivity();
return true;
};

AnimationBaseNode.prototype.resolve_st = function()
{
return true;
};

AnimationBaseNode.prototype.activate_st = function()
{
if( this.aActivity )
{
this.saveStateOfAnimatedElement();
this.aActivity.setTargets( this.getAnimatedElement() );
if( this.getContext().bIsSkipping  )
{
this.aActivity.end();
}
else
{
this.getContext().aActivityQueue.addActivity( this.aActivity );
}
}
else
{
AnimationBaseNode.superclass.scheduleDeactivationEvent.call( this );
}

};

AnimationBaseNode.prototype.deactivate_st = function( eDestState )
{
if( eDestState == FROZEN_NODE )
{
if( this.aActivity )
this.aActivity.end();
}
if( eDestState == ENDED_NODE )
{
if( this.aActivity )
this.aActivity.dispose();
if( ( this.getFillMode() == FILL_MODE_REMOVE ) && this.getAnimatedElement()  )
this.removeEffect();
}
};

AnimationBaseNode.prototype.createActivity = function()
{
log( 'AnimationBaseNode.createActivity: abstract method called' );
};

AnimationBaseNode.prototype.fillActivityParams = function()
{

var nDuration = 0.001;
if( this.getDuration().isValue() )
{
nDuration = this.getDuration().getValue();
}
else
{
log( 'AnimationBaseNode.fillActivityParams: duration is not a number' );
}

var aActivityParamSet = new ActivityParamSet();

aActivityParamSet.aEndEvent             = makeEvent( bind( this, this.deactivate ) );
aActivityParamSet.aTimerEventQueue      = this.aContext.aTimerEventQueue;
aActivityParamSet.aActivityQueue        = this.aContext.aActivityQueue;
aActivityParamSet.nMinDuration          = nDuration;
aActivityParamSet.nMinNumberOfFrames    = this.getMinFrameCount();
aActivityParamSet.bAutoReverse          = this.isAutoReverseEnabled();
aActivityParamSet.nRepeatCount          = this.getRepeatCount();
aActivityParamSet.nAccelerationFraction = this.getAccelerateValue();
aActivityParamSet.nDecelerationFraction = this.getDecelerateValue();
aActivityParamSet.nSlideWidth           = this.aNodeContext.aSlideWidth;
aActivityParamSet.nSlideHeight          = this.aNodeContext.aSlideHeight;

return aActivityParamSet;
};

AnimationBaseNode.prototype.hasPendingAnimation = function()
{
return true;
};

AnimationBaseNode.prototype.saveStateOfAnimatedElement = function()
{
this.getAnimatedElement().saveState( this.getId() );
};

AnimationBaseNode.prototype.removeEffect = function()
{
this.getAnimatedElement().restoreState( this.getId() );
};

AnimationBaseNode.prototype.getTargetElement = function()
{
return this.aTargetElement;
};

AnimationBaseNode.prototype.getAnimatedElement = function()
{
return this.aAnimatedElement;
};

AnimationBaseNode.prototype.dispose= function()
{
if( this.aActivity )
this.aActivity.dispose();

AnimationBaseNode.superclass.dispose.call( this );
};

AnimationBaseNode.prototype.getMinFrameCount = function()
{
return this.nMinFrameCount;
};

AnimationBaseNode.prototype.getAdditiveMode = function()
{
return this.eAdditiveMode;
};

AnimationBaseNode.prototype.info = function( bVerbose )
{
var sInfo = AnimationBaseNode.superclass.info.call( this, bVerbose );

if( bVerbose )
{
if( this.getMinFrameCount() )
sInfo += ';  min frame count: ' + this.getMinFrameCount();

sInfo += ';  additive: ' + aAddittiveModeOutMap[ this.getAdditiveMode() ];

if( this.getTargetElement() )
{
var sElemId = this.getTargetElement().getAttribute( 'id' );
sInfo += ';  targetElement: ' +  sElemId;
}
}

return sInfo;
};


function AnimationBaseNode2( aAnimElem, aParentNode, aNodeContext )
{
AnimationBaseNode2.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sAttributeName = '';
this.aToValue = null;

}
extend( AnimationBaseNode2, AnimationBaseNode );


AnimationBaseNode2.prototype.parseElement = function()
{
var bRet = AnimationBaseNode2.superclass.parseElement.call( this );

var aAnimElem = this.aElement;

this.sAttributeName = aAnimElem.getAttributeNS( NSS['smil'], 'attributeName' );
if( !this.sAttributeName )
{
this.eCurrentState = INVALID_NODE;
log( 'AnimationBaseNode2.parseElement: target attribute name not found: ' + this.sAttributeName );
}

this.aToValue = aAnimElem.getAttributeNS( NSS['smil'], 'to' );

return bRet;
};

AnimationBaseNode2.prototype.getAttributeName = function()
{
return this.sAttributeName;
};

AnimationBaseNode2.prototype.getToValue = function()
{
return this.aToValue;
};

AnimationBaseNode2.prototype.info = function( bVerbose )
{
var sInfo = AnimationBaseNode2.superclass.info.call( this, bVerbose );

if( bVerbose )
{
if( this.getAttributeName() )
sInfo += ';  attributeName: ' + this.getAttributeName();

if( this.getToValue() )
sInfo += ';  to: ' + this.getToValue();
}

return sInfo;
};


function AnimationBaseNode3( aAnimElem, aParentNode, aNodeContext )
{
AnimationBaseNode3.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.eAccumulate = undefined;
this.eCalcMode = undefined;
this.aFromValue = null;
this.aByValue = null;
this.aKeyTimes = null;
this.aValues = null;
this.aFormula= null;
}
extend( AnimationBaseNode3, AnimationBaseNode2 );


AnimationBaseNode3.prototype.parseElement = function()
{
var bRet = AnimationBaseNode3.superclass.parseElement.call( this );

var aAnimElem = this.aElement;

this.eAccumulate = ACCUMULATE_MODE_NONE;
var sAccumulateAttr = aAnimElem.getAttributeNS( NSS['smil'], 'accumulate' );
if( sAccumulateAttr == 'sum' )
this.eAccumulate = ACCUMULATE_MODE_SUM;

this.eCalcMode = CALC_MODE_LINEAR;
var sCalcModeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'calcMode' );
if( sCalcModeAttr && aCalcModeInMap[ sCalcModeAttr ] )
this.eCalcMode = aCalcModeInMap[ sCalcModeAttr ];

this.aFromValue = aAnimElem.getAttributeNS( NSS['smil'], 'from' );

this.aByValue = aAnimElem.getAttributeNS( NSS['smil'], 'by' );

this.aKeyTimes = [];
var sKeyTimesAttr = aAnimElem.getAttributeNS( NSS['smil'], 'keyTimes' );
sKeyTimesAttr = removeWhiteSpaces( sKeyTimesAttr );
if( sKeyTimesAttr )
{
var aKeyTimes = sKeyTimesAttr.split( ';' );
for( var i = 0; i < aKeyTimes.length; ++i )
this.aKeyTimes.push( parseFloat( aKeyTimes[i] ) );
}

var sValuesAttr = aAnimElem.getAttributeNS( NSS['smil'], 'values' );
if( sValuesAttr )
{
this.aValues = sValuesAttr.split( ';' );
}
else
{
this.aValues = [];
}

this.aFormula = aAnimElem.getAttributeNS( NSS['anim'], 'formula' );

return bRet;
};

AnimationBaseNode3.prototype.getAccumulate = function()
{
return this.eAccumulate;
};

AnimationBaseNode3.prototype.getCalcMode = function()
{
return this.eCalcMode;
};

AnimationBaseNode3.prototype.getFromValue = function()
{
return this.aFromValue;
};

AnimationBaseNode3.prototype.getByValue = function()
{
return this.aByValue;
};

AnimationBaseNode3.prototype.getKeyTimes = function()
{
return this.aKeyTimes;
};

AnimationBaseNode3.prototype.getValues = function()
{
return this.aValues;
};

AnimationBaseNode3.prototype.getFormula = function()
{
return this.aFormula;
};

AnimationBaseNode3.prototype.info = function( bVerbose )
{
var sInfo = AnimationBaseNode3.superclass.info.call( this, bVerbose );

if( bVerbose )
{
if( this.getAccumulate() )
sInfo += ';  accumulate: ' + aAccumulateModeOutMap[ this.getAccumulate() ];

sInfo += ';  calcMode: ' + aCalcModeOutMap[ this.getCalcMode() ];

if( this.getFromValue() )
sInfo += ';  from: ' + this.getFromValue();

if( this.getByValue() )
sInfo += ';  by: ' + this.getByValue();

if( this.getKeyTimes().length )
sInfo += ';  keyTimes: ' + this.getKeyTimes().join( ',' );

if( this.getKeyTimes().length )
sInfo += ';  values: ' + this.getValues().join( ',' );

if( this.getFormula() )
sInfo += ';  formula: ' + this.getFormula();
}

return sInfo;
};


function BaseContainerNode( aAnimElem, aParentNode, aNodeContext )
{
BaseContainerNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'BaseContainerNode';
this.bIsContainer = true;
this.aChildrenArray = [];
this.nFinishedChildren = 0;
this.bDurationIndefinite = false;
this.nLeftIterations = 1;

this.eImpressNodeType = undefined;
this.ePresetClass =  undefined;
this.ePresetId =  undefined;
}
extend( BaseContainerNode, BaseNode );


BaseContainerNode.prototype.parseElement= function()
{
var bRet = BaseContainerNode.superclass.parseElement.call( this );

var aAnimElem = this.aElement;

this.eImpressNodeType = IMPRESS_DEFAULT_NODE;
var sNodeTypeAttr = aAnimElem.getAttributeNS( NSS['presentation'], 'node-type' );
if( sNodeTypeAttr && aImpressNodeTypeInMap[ sNodeTypeAttr ] )
this.eImpressNodeType = aImpressNodeTypeInMap[ sNodeTypeAttr ];
this.bMainSequenceRootNode = ( this.eImpressNodeType == IMPRESS_MAIN_SEQUENCE_NODE );
this.bInteractiveSequenceRootNode = ( this.eImpressNodeType == IMPRESS_INTERACTIVE_SEQUENCE_NODE );

this.ePresetClass =  undefined;
var sPresetClassAttr = aAnimElem.getAttributeNS( NSS['presentation'], 'preset-class' );
if( sPresetClassAttr && aPresetClassInMap[ sPresetClassAttr ] )
this.ePresetClass = aPresetClassInMap[ sPresetClassAttr ];

this.ePresetId =  undefined;
var sPresetIdAttr = aAnimElem.getAttributeNS( NSS['presentation'], 'preset-id' );
if( sPresetIdAttr && aPresetIdInMap[ sPresetIdAttr ] )
this.ePresetId = aPresetIdInMap[ sPresetIdAttr ];


var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
this.aChildrenArray[i].parseElement();
}


this.bDurationIndefinite
= ( !this.getDuration() || this.getDuration().isIndefinite()  ) &&
( !this.getEnd() || ( this.getEnd().getType() != OFFSET_TIMING ) );

return bRet;
};

BaseContainerNode.prototype.appendChildNode = function( aAnimationNode )
{
if( ! this.checkValidNode() )
return ;

if( aAnimationNode.registerDeactivatingListener( this ) )
this.aChildrenArray.push( aAnimationNode );
};

BaseContainerNode.prototype.init_st = function()
{
this.nLeftIterations = this.getRepeatCount();

return this.init_children();
};

BaseContainerNode.prototype.init_children = function()
{
this.nFinishedChildren = 0;
var nChildrenCount = this.aChildrenArray.length;
var nInitChildren = 0;
for( var i = 0; i < nChildrenCount; ++i )
{
if( this.aChildrenArray[i].init() )
{
++nInitChildren;
}
}
return ( nChildrenCount == nInitChildren );
};


BaseContainerNode.prototype.deactivate_st = function( eDestState )
{
this.nLeftIterations = 0;
if( eDestState == FROZEN_NODE )
{
this.forEachChildNode( mem_fn( 'deactivate' ), ~( FROZEN_NODE | ENDED_NODE ) );
}
else
{
this.forEachChildNode( mem_fn( 'end' ), ~ENDED_NODE );
if( this.getFillMode() == FILL_MODE_REMOVE )
this.removeEffect();
}
};

BaseContainerNode.prototype.hasPendingAnimation = function()
{
var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
if( this.aChildrenArray[i].hasPendingAnimation() )
return true;
}
return false;
};

BaseContainerNode.prototype.activate_st = function()
{
log( 'BaseContainerNode.activate_st: abstract method called' );
};

BaseContainerNode.prototype.notifyDeactivating = function( aAnimationNode )
{
log( 'BaseContainerNode.notifyDeactivating: abstract method called' );
};

BaseContainerNode.prototype.isDurationIndefinite = function()
{
return this.bDurationIndefinite;
};

BaseContainerNode.prototype.isChildNode = function( aAnimationNode )
{
var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
if( this.aChildrenArray[i].getId() == aAnimationNode.getId() )
return true;
}
return false;
};

BaseContainerNode.prototype.notifyDeactivatedChild = function( aChildNode )
{
assert( ( aChildNode.getState() == FROZEN_NODE ) || ( aChildNode.getState() == ENDED_NODE ),
'BaseContainerNode.notifyDeactivatedChild: passed child node is neither in FROZEN nor in ENDED state' );

assert( this.getState() != INVALID_NODE,
'BaseContainerNode.notifyDeactivatedChild: this node is invalid' );

if( !this.isChildNode( aChildNode ) )
{
log( 'BaseContainerNode.notifyDeactivatedChild: unknown child notifier!' );
return false;
}

var nChildrenCount = this.aChildrenArray.length;

assert( ( this.nFinishedChildren < nChildrenCount ),
'BaseContainerNode.notifyDeactivatedChild: assert(this.nFinishedChildren < nChildrenCount) failed' );

++this.nFinishedChildren;
var bFinished = ( this.nFinishedChildren >= nChildrenCount );

if( bFinished && this.isDurationIndefinite() )
{
if( this.nLeftIterations >= 1.0 )
{
this.nLeftIterations -= 1.0;
}
if( this.nLeftIterations >= 1.0 )
{
bFinished = false;
var aRepetitionEvent = makeDelay( bind( this, this.repeat ), 0.0 );
this.aContext.aTimerEventQueue.addEvent( aRepetitionEvent );
}
else
{
this.deactivate();
}
}

return bFinished;
};

BaseContainerNode.prototype.repeat = function()
{
this.forEachChildNode( mem_fn( 'end' ), ~ENDED_NODE );
this.removeEffect();
var bInitialized = this.init_children();
if( bInitialized )
this.activate_st();
return bInitialized;
};

BaseContainerNode.prototype.removeEffect = function()
{
var nChildrenCount = this.aChildrenArray.length;
if( nChildrenCount == 0 )
return;
for( var i = nChildrenCount - 1; i >= 0; --i )
{
if( ( this.aChildrenArray[i].getState() & ( FROZEN_NODE | ENDED_NODE ) ) == 0 )
{
log( 'BaseContainerNode.removeEffect: child(id:'
+ this.aChildrenArray[i].getId() + ') is neither frozen nor ended;'
+ ' state: '
+ aTransitionModeOutMap[ this.aChildrenArray[i].getState() ] );
continue;
}
this.aChildrenArray[i].removeEffect();
}
};

BaseContainerNode.prototype.saveStateOfAnimatedElement = function()
{
var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
this.aChildrenArray[i].saveStateOfAnimatedElement();
}
};

BaseContainerNode.prototype.forEachChildNode = function( aFunction, eNodeStateMask )
{
if( !eNodeStateMask )
eNodeStateMask = -1;

var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
if( ( eNodeStateMask != -1 ) && ( ( this.aChildrenArray[i].getState() & eNodeStateMask ) == 0 ) )
continue;
aFunction( this.aChildrenArray[i] );
}
};

BaseContainerNode.prototype.dispose = function()
{
var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
this.aChildrenArray[i].dispose();
}

BaseContainerNode.superclass.dispose.call( this );
};

BaseContainerNode.prototype.getImpressNodeType = function()
{
return this.eImpressNodeType;
};

BaseContainerNode.prototype.info = function( bVerbose )
{
var sInfo = BaseContainerNode.superclass.info.call( this, bVerbose );

if( bVerbose )
{
if( this.getImpressNodeType() )
sInfo += ';  node-type: ' + aImpressNodeTypeOutMap[ this.getImpressNodeType() ];
}

var nChildrenCount = this.aChildrenArray.length;
for( var i = 0; i < nChildrenCount; ++i )
{
sInfo += '\n';
sInfo += this.aChildrenArray[i].info( bVerbose );
}

return sInfo;
};


function ParallelTimeContainer( aAnimElem, aParentNode, aNodeContext )
{
ParallelTimeContainer.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'ParallelTimeContainer';
}
extend( ParallelTimeContainer, BaseContainerNode );


ParallelTimeContainer.prototype.activate_st = function()
{
var nChildrenCount = this.aChildrenArray.length;
var nResolvedChildren = 0;
for( var i = 0; i < nChildrenCount; ++i )
{
if( this.aChildrenArray[i].resolve() )
{
++nResolvedChildren;
}
}

if( nChildrenCount != nResolvedChildren )
{
log( 'ParallelTimeContainer.activate_st: resolving all children failed' );
return;
}


if( this.isDurationIndefinite() && ( nChildrenCount == 0  ) )
{
this.scheduleDeactivationEvent( this.makeDeactivationEvent( 0.0 ) );
}
else
{
this.scheduleDeactivationEvent();
}
};

ParallelTimeContainer.prototype.notifyDeactivating = function( aAnimationNode )
{
this.notifyDeactivatedChild( aAnimationNode );
};


function SequentialTimeContainer( aAnimElem, aParentNode, aNodeContext )
{
SequentialTimeContainer.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'SequentialTimeContainer';
this.bIsRewinding = false;
this.aCurrentSkipEvent = null;
this.aRewindCurrentEffectEvent = null;
this.aRewindLastEffectEvent = null;
}
extend( SequentialTimeContainer, BaseContainerNode );


SequentialTimeContainer.prototype.activate_st = function()
{
var nChildrenCount = this.aChildrenArray.length;
for( ; this.nFinishedChildren < nChildrenCount; ++this.nFinishedChildren )
{
if( this.resolveChild( this.aChildrenArray[ this.nFinishedChildren ] ) )
break;
else
log( 'SequentialTimeContainer.activate_st: resolving child failed!' );
}

if( this.isDurationIndefinite() && ( ( nChildrenCount == 0 ) || ( this.nFinishedChildren >= nChildrenCount ) ) )
{
this.scheduleDeactivationEvent( this.makeDeactivationEvent( 0.0 ) );
}
else
{
this.scheduleDeactivationEvent();
}
};

SequentialTimeContainer.prototype.notifyDeactivating = function( aNotifier )
{
if( this.bIsRewinding )
return;

if( this.notifyDeactivatedChild( aNotifier ) )
return;

assert( this.nFinishedChildren < this.aChildrenArray.length,
'SequentialTimeContainer.notifyDeactivating: assertion (this.nFinishedChildren < this.aChildrenArray.length) failed' );

var aNextChild = this.aChildrenArray[ this.nFinishedChildren ];

assert( aNextChild.getState() == UNRESOLVED_NODE,
'SequentialTimeContainer.notifyDeactivating: assertion (aNextChild.getState == UNRESOLVED_NODE) failed' );

if( !this.resolveChild( aNextChild ) )
{
this.deactivate();
}
};

SequentialTimeContainer.prototype.skipEffect = function( aChildNode )
{
if( this.isChildNode( aChildNode ) )
{
this.getContext().aActivityQueue.endAll();
this.getContext().bIsSkipping = true;
this.getContext().aTimerEventQueue.forceEmpty();
this.getContext().bIsSkipping = false;
var aEvent = makeEvent( bind2( aChildNode.deactivate, aChildNode ) );
this.getContext().aTimerEventQueue.addEvent( aEvent );
}
else
{
log( 'SequentialTimeContainer.skipEffect: unknown child: '
+ aChildNode.getId() );
}
};

SequentialTimeContainer.prototype.rewindCurrentEffect = function( aChildNode )
{
if( this.isChildNode( aChildNode ) )
{
assert( !this.bIsRewinding,
'SequentialTimeContainer.rewindCurrentEffect: is already rewinding.' );

this.bIsRewinding = true;
this.getContext().aActivityQueue.endAll();
this.getContext().bIsSkipping = true;
this.getContext().aTimerEventQueue.forceEmpty();
this.getContext().bIsSkipping = false;
this.getContext().aActivityQueue.endAll();

aChildNode.end();
aChildNode.removeEffect();
aChildNode.init();
this.resolveChild( aChildNode );
this.notifyRewindedEvent( aChildNode );
this.bIsRewinding = false;
}
else
{
log( 'SequentialTimeContainer.rewindCurrentEffect: unknown child: '
+ aChildNode.getId() );
}
};

SequentialTimeContainer.prototype.rewindLastEffect = function( aChildNode )
{
if( this.isChildNode( aChildNode ) )
{
assert( !this.bIsRewinding,
'SequentialTimeContainer.rewindLastEffect: is already rewinding.' );

this.bIsRewinding = true;
this.getContext().aTimerEventQueue.forceEmpty();
this.getContext().aActivityQueue.clear();
aChildNode.end();

--this.nFinishedChildren;
var aPreviousChildNode = this.aChildrenArray[ this.nFinishedChildren ];

aPreviousChildNode.removeEffect();
aPreviousChildNode.init();
aChildNode.init();
this.resolveChild( aPreviousChildNode );
this.notifyRewindedEvent( aChildNode );
this.bIsRewinding = false;
}
else
{
log( 'SequentialTimeContainer.rewindLastEffect: unknown child: '
+ aChildNode.getId() );
}
};

SequentialTimeContainer.prototype.resolveChild = function( aChildNode )
{
var bResolved = aChildNode.resolve();

if( bResolved && ( this.isMainSequenceRootNode() || this.isInteractiveSequenceRootNode() ) )
{
if( this.aCurrentSkipEvent )
this.aCurrentSkipEvent.dispose();
this.aCurrentSkipEvent = makeEvent( bind2( SequentialTimeContainer.prototype.skipEffect, this, aChildNode ) );

if( this.aRewindCurrentEffectEvent )
this.aRewindCurrentEffectEvent.dispose();
this.aRewindCurrentEffectEvent = makeEvent( bind2( SequentialTimeContainer.prototype.rewindCurrentEffect, this, aChildNode ) );

if( this.aRewindLastEffectEvent )
this.aRewindLastEffectEvent.dispose();
this.aRewindLastEffectEvent = makeEvent( bind2( SequentialTimeContainer.prototype.rewindLastEffect, this, aChildNode ) );

if( this.isMainSequenceRootNode() )
{
this.aContext.aEventMultiplexer.registerSkipEffectEvent( this.aCurrentSkipEvent );
this.aContext.aEventMultiplexer.registerRewindCurrentEffectEvent( this.aRewindCurrentEffectEvent );
this.aContext.aEventMultiplexer.registerRewindLastEffectEvent( this.aRewindLastEffectEvent );
}
else if( this.isInteractiveSequenceRootNode() )
{
this.aContext.aEventMultiplexer.registerSkipInteractiveEffectEvent( aChildNode.getId(), this.aCurrentSkipEvent );
this.aContext.aEventMultiplexer.registerRewindRunningInteractiveEffectEvent( aChildNode.getId(), this.aRewindCurrentEffectEvent );
this.aContext.aEventMultiplexer.registerRewindEndedInteractiveEffectEvent( aChildNode.getId(), this.aRewindLastEffectEvent );
}
}
return bResolved;
};

SequentialTimeContainer.prototype.notifyRewindedEvent = function( aChildNode )
{
if( this.isInteractiveSequenceRootNode() )
{
this.aContext.aEventMultiplexer.notifyRewindedEffectEvent( aChildNode.getId() );

var sId = aChildNode.getBegin().getEventBaseElementId();
if( sId )
{
this.aContext.aEventMultiplexer.notifyRewindedEffectEvent( sId );
}
}
};

SequentialTimeContainer.prototype.dispose = function()
{
if( this.aCurrentSkipEvent )
this.aCurrentSkipEvent.dispose();

SequentialTimeContainer.superclass.dispose.call( this );
};


function PropertyAnimationNode(  aAnimElem, aParentNode, aNodeContext )
{
PropertyAnimationNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'PropertyAnimationNode';
}
extend( PropertyAnimationNode, AnimationBaseNode3 );


PropertyAnimationNode.prototype.createActivity = function()
{


var aActivityParamSet = this.fillActivityParams();

var aAnimation = createPropertyAnimation( this.getAttributeName(),
this.getAnimatedElement(),
this.aNodeContext.aSlideWidth,
this.aNodeContext.aSlideHeight );

var aInterpolator = null;  // createActivity will compute it;
return createActivity( aActivityParamSet, this, aAnimation, aInterpolator );

};


function AnimationSetNode(  aAnimElem, aParentNode, aNodeContext )
{
AnimationSetNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'AnimationSetNode';
}
extend( AnimationSetNode, AnimationBaseNode2 );


AnimationSetNode.prototype.createActivity = function()
{
var aAnimation = createPropertyAnimation( this.getAttributeName(),
this.getAnimatedElement(),
this.aNodeContext.aSlideWidth,
this.aNodeContext.aSlideHeight );

var aActivityParamSet = this.fillActivityParams();

return new SetActivity( aActivityParamSet, aAnimation, this.getToValue() );
};


function AnimationColorNode(  aAnimElem, aParentNode, aNodeContext )
{
AnimationColorNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'AnimationColorNode';

this.eColorInterpolation = undefined;
this.eColorInterpolationDirection = undefined;
}
extend( AnimationColorNode, AnimationBaseNode3 );


AnimationColorNode.prototype.parseElement = function()
{
var bRet = AnimationColorNode.superclass.parseElement.call( this );

var aAnimElem = this.aElement;

this.eColorInterpolation = COLOR_SPACE_RGB;
var sColorInterpolationAttr = aAnimElem.getAttributeNS( NSS['anim'], 'color-interpolation' );
if( sColorInterpolationAttr && aColorSpaceInMap[ sColorInterpolationAttr ] )
this.eColorInterpolation = aColorSpaceInMap[ sColorInterpolationAttr ];

this.eColorInterpolationDirection = CLOCKWISE;
var sColorInterpolationDirectionAttr = aAnimElem.getAttributeNS( NSS['anim'], 'color-interpolation-direction' );
if( sColorInterpolationDirectionAttr && aClockDirectionInMap[ sColorInterpolationDirectionAttr ] )
this.eColorInterpolationDirection = aClockDirectionInMap[ sColorInterpolationDirectionAttr ];

return bRet;
};

AnimationColorNode.prototype.createActivity = function()
{


var aActivityParamSet = this.fillActivityParams();

var aAnimation = createPropertyAnimation( this.getAttributeName(),
this.getAnimatedElement(),
this.aNodeContext.aSlideWidth,
this.aNodeContext.aSlideHeight );

var aColorAnimation;
var aInterpolator;
if( this.getColorInterpolation() === COLOR_SPACE_HSL )
{
ANIMDBG.print( 'AnimationColorNode.createActivity: color space hsl'  );
aColorAnimation = new HSLAnimationWrapper( aAnimation );
var aInterpolatorMaker = aInterpolatorHandler.getInterpolator( this.getCalcMode(),
COLOR_PROPERTY,
COLOR_SPACE_HSL );
aInterpolator = aInterpolatorMaker( this.getColorInterpolationDirection() );
}
else
{
ANIMDBG.print( 'AnimationColorNode.createActivity: color space rgb'  );
aColorAnimation = aAnimation;
aInterpolator = aInterpolatorHandler.getInterpolator( this.getCalcMode(),
COLOR_PROPERTY,
COLOR_SPACE_RGB );
}

return createActivity( aActivityParamSet, this, aColorAnimation, aInterpolator );


};

AnimationColorNode.prototype.getColorInterpolation = function()
{
return this.eColorInterpolation;
};

AnimationColorNode.prototype.getColorInterpolationDirection = function()
{
return this.eColorInterpolationDirection;
};

AnimationColorNode.prototype.info = function( bVerbose )
{
var sInfo = AnimationColorNode.superclass.info.call( this, bVerbose );

if( bVerbose )
{
sInfo += ';  color-interpolation: ' + aColorSpaceOutMap[ this.getColorInterpolation() ];

sInfo += ';  color-interpolation-direction: ' + aClockDirectionOutMap[ this.getColorInterpolationDirection() ];
}
return sInfo;
};


function AnimationTransitionFilterNode(  aAnimElem, aParentNode, aNodeContext )
{
AnimationTransitionFilterNode.superclass.constructor.call( this, aAnimElem, aParentNode, aNodeContext );

this.sClassName = 'AnimationTransitionFilterNode';

this.eTransitionType = undefined;
this.eTransitionSubType = undefined;
this.bReverseDirection = undefined;
this.eTransitionMode = undefined;
}
extend( AnimationTransitionFilterNode, AnimationBaseNode );


AnimationTransitionFilterNode.prototype.createActivity = function()
{
var aActivityParamSet = this.fillActivityParams();

return createShapeTransition( aActivityParamSet,
this.getAnimatedElement(),
this.aNodeContext.aSlideWidth,
this.aNodeContext.aSlideHeight,
this );
};

AnimationTransitionFilterNode.prototype.parseElement = function()
{
var bRet = AnimationTransitionFilterNode.superclass.parseElement.call( this );
var bIsValidTransition = true;

var aAnimElem = this.aElement;

this.eTransitionType = undefined;
var sTypeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'type' );
if( sTypeAttr && aTransitionTypeInMap[ sTypeAttr ] )
{
this.eTransitionType = aTransitionTypeInMap[ sTypeAttr ];
}
else
{
bIsValidTransition = false;
log( 'AnimationTransitionFilterNode.parseElement: transition type not valid: ' + sTypeAttr );
}

this.eTransitionSubType = undefined;
var sSubTypeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'subtype' );
if( sSubTypeAttr === null )
sSubTypeAttr = 'default';
if( sSubTypeAttr && ( aTransitionSubtypeInMap[ sSubTypeAttr ] !== undefined  ) )
{
this.eTransitionSubType = aTransitionSubtypeInMap[ sSubTypeAttr ];
}
else
{
bIsValidTransition = false;
log( 'AnimationTransitionFilterNode.parseElement: transition subtype not valid: ' + sSubTypeAttr );
}

if( !bIsValidTransition )
{
this.eTransitionType = FADE_TRANSITION;
this.eTransitionSubType = CROSSFADE_TRANS_SUBTYPE;
log( 'AnimationTransitionFilterNode.parseElement: in place of the invalid transition a crossfade transition is used' );
}

this.bReverseDirection = false;
var sDirectionAttr = aAnimElem.getAttributeNS( NSS['smil'], 'direction' );
if( sDirectionAttr == 'reverse' )
this.bReverseDirection = true;

this.eTransitionMode = TRANSITION_MODE_IN;
var sModeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'mode' );
if( sModeAttr === 'out' )
this.eTransitionMode = TRANSITION_MODE_OUT;

return bRet;
};

AnimationTransitionFilterNode.prototype.getTransitionType = function()
{
return this.eTransitionType;
};

AnimationTransitionFilterNode.prototype.getTransitionSubType = function()
{
return this.eTransitionSubType;
};

AnimationTransitionFilterNode.prototype.getTransitionMode = function()
{
return this.eTransitionMode;
};

AnimationTransitionFilterNode.prototype.getReverseDirection = function()
{
return this.bReverseDirection;
};

AnimationTransitionFilterNode.prototype.info = function( bVerbose )
{
var sInfo = AnimationTransitionFilterNode.superclass.info.call( this, bVerbose );

if( bVerbose )
{
sInfo += ';  type: ' + aTransitionTypeOutMap[ String( this.getTransitionType() ) ];

sInfo += ';  subtype: ' + aTransitionSubtypeOutMap[ this.getTransitionSubType() ];

if( this.getReverseDirection() )
sInfo += ';  direction: reverse';
}

return sInfo;
};


function createAnimationTree( aRootElement, aNodeContext )
{
return createAnimationNode( aRootElement, null, aNodeContext );
}


function createAnimationNode( aElement, aParentNode, aNodeContext )
{
assert( aElement, 'createAnimationNode: invalid animation element' );

var eAnimationNodeType = getAnimationElementType( aElement );

var aCreatedNode = null;
var aCreatedContainer = null;

switch( eAnimationNodeType )
{
case ANIMATION_NODE_PAR:
aCreatedNode = aCreatedContainer =
new ParallelTimeContainer( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_ITERATE:
aCreatedNode = aCreatedContainer =
new ParallelTimeContainer( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_SEQ:
aCreatedNode = aCreatedContainer =
new SequentialTimeContainer( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_ANIMATE:
aCreatedNode = new PropertyAnimationNode( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_SET:
aCreatedNode = new AnimationSetNode( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_ANIMATEMOTION:
log( 'createAnimationNode: ANIMATEMOTION not implemented' );
return null;
case ANIMATION_NODE_ANIMATECOLOR:
aCreatedNode = new AnimationColorNode( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_ANIMATETRANSFORM:
log( 'createAnimationNode: ANIMATETRANSFORM not implemented' );
return null;
case ANIMATION_NODE_TRANSITIONFILTER:
aCreatedNode = new AnimationTransitionFilterNode( aElement, aParentNode, aNodeContext );
break;
case ANIMATION_NODE_AUDIO:
log( 'createAnimationNode: AUDIO not implemented' );
return null;
case ANIMATION_NODE_COMMAND:
log( 'createAnimationNode: COMMAND not implemented' );
return null;
default:
log( 'createAnimationNode: invalid Animation Node Type: ' + eAnimationNodeType );
return null;
}

if( aCreatedContainer )
{
if( eAnimationNodeType == ANIMATION_NODE_ITERATE )
{
createIteratedNodes( aElement, aCreatedContainer, aNodeContext );
}
else
{
var aChildrenArray = getElementChildren( aElement );
for( var i = 0; i < aChildrenArray.length; ++i )
{
if( !createChildNode( aChildrenArray[i], aCreatedContainer, aNodeContext ) )
{
return null;
}
}
}
}

return aCreatedNode;
}


function createChildNode( aElement, aParentNode, aNodeContext )
{
var aChildNode = createAnimationNode( aElement, aParentNode, aNodeContext );

if( !aChildNode )
{
log( 'createChildNode: child node creation failed' );
return false;
}
else
{
aParentNode.appendChildNode( aChildNode );
return true;
}
}


function createIteratedNodes( aElement, aContainerNode, aNodeContext )
{
}


function makeScaler( nScale )
{
if( ( typeof( nScale ) !== typeof( 0 ) ) || !isFinite( nScale ) )
{
log( 'makeScaler: not valid param passed: ' + nScale );
return null;
}

return  function( nValue )
{
return ( nScale * nValue );
};
}


function createPropertyAnimation( sAttrName, aAnimatedElement, nWidth, nHeight )
{
if( !aAttributeMap[ sAttrName ] )
{
log( 'createPropertyAnimation: attribute is unknown' );
return null;
}


var aFunctorSet = aAttributeMap[ sAttrName ];

var sGetValueMethod =   aFunctorSet.get;
var sSetValueMethod =   aFunctorSet.set;

if( !sGetValueMethod || !sSetValueMethod  )
{
log( 'createPropertyAnimation: attribute is not handled' );
return null;
}

var aGetModifier =  eval( aFunctorSet.getmod );
var aSetModifier =  eval( aFunctorSet.setmod );


return new GenericAnimation( bind( aAnimatedElement, aAnimatedElement[ sGetValueMethod ] ),
bind( aAnimatedElement, aAnimatedElement[ sSetValueMethod ] ),
aGetModifier,
aSetModifier);
}


function createShapeTransition( aActivityParamSet, aAnimatedElement,
nSlideWidth, nSlideHeight,
aAnimatedTransitionFilterNode )
{
if( !aAnimatedTransitionFilterNode )
{
log( 'createShapeTransition: the animated transition filter node is not valid.' );
return null;
}
var eTransitionType = aAnimatedTransitionFilterNode.getTransitionType();
var eTransitionSubType = aAnimatedTransitionFilterNode.getTransitionSubType();
var bDirectionForward = ! aAnimatedTransitionFilterNode.getReverseDirection();
var bModeIn = ( aAnimatedTransitionFilterNode.getTransitionMode() == FORWARD );

var aTransitionInfo = aTransitionInfoTable[eTransitionType][eTransitionSubType];
var eTransitionClass = aTransitionInfo['class'];

switch( eTransitionClass )
{
default:
case TRANSITION_INVALID:
log( 'createShapeTransition: transition class: TRANSITION_INVALID' );
return null;

case TRANSITION_CLIP_POLYPOLYGON:
var aParametricPolyPolygon
= createClipPolyPolygon( eTransitionType, eTransitionSubType );
var aClippingAnimation
= new ClippingAnimation( aParametricPolyPolygon, aTransitionInfo,
bDirectionForward, bModeIn );
return new SimpleActivity( aActivityParamSet, aClippingAnimation, true );

case TRANSITION_SPECIAL:
switch( eTransitionType )
{
default:
var aAnimation
= createPropertyAnimation( 'opacity',
aAnimatedElement,
nSlideWidth,
nSlideHeight );
return new SimpleActivity( aActivityParamSet, aAnimation, bModeIn );
}
}

}


function ClippingAnimation( aParametricPolyPolygon, aTransitionInfo,
bDirectionForward, bModeIn )
{
this.aClippingFunctor = new ClippingFunctor( aParametricPolyPolygon,
aTransitionInfo,
bDirectionForward, bModeIn );
this.bAnimationStarted = false;
}

ClippingAnimation.prototype.start = function( aAnimatableElement )
{
assert( aAnimatableElement,
'ClippingAnimation.start: animatable element is not valid' );
this.aAnimatableElement = aAnimatableElement;
this.aAnimatableElement.initClipPath();
this.aAnimatableElement.notifyAnimationStart();

if( !this.bAnimationStarted )
this.bAnimationStarted = true;

};

ClippingAnimation.prototype.end = function()
{
if( this.bAnimationStarted )
{
this.aAnimatableElement.cleanClipPath();
this.bAnimationStarted = false;
this.aAnimatableElement.notifyAnimationEnd();
}
};

ClippingAnimation.prototype.perform = function( nValue )
{
var nWidth = this.aAnimatableElement.aClippingBBox.width;
var nHeight = this.aAnimatableElement.aClippingBBox.height;
var aPolyPolygonElement = this.aClippingFunctor.perform( nValue, nWidth, nHeight );
this.aAnimatableElement.setClipPath( aPolyPolygonElement );
};

ClippingAnimation.prototype.getUnderlyingValue = function()
{
return 0.0;
};


function GenericAnimation( aGetValueFunc, aSetValueFunc, aGetModifier, aSetModifier )
{
assert( aGetValueFunc && aSetValueFunc,
'GenericAnimation constructor: get value functor and/or set value functor are not valid' );

this.aGetValueFunc = aGetValueFunc;
this.aSetValueFunc = aSetValueFunc;
this.aGetModifier = aGetModifier;
this.aSetModifier = aSetModifier;
this.aAnimatableElement = null;
this.bAnimationStarted = false;
}


GenericAnimation.prototype.start = function( aAnimatableElement )
{
assert( aAnimatableElement, 'GenericAnimation.start: animatable element is not valid' );

this.aAnimatableElement = aAnimatableElement;
this.aAnimatableElement.notifyAnimationStart();

if( !this.bAnimationStarted )
this.bAnimationStarted = true;
};

GenericAnimation.prototype.end = function()
{
if( this.bAnimationStarted )
{
this.bAnimationStarted = false;
this.aAnimatableElement.notifyAnimationEnd();
}
};

GenericAnimation.prototype.perform = function( aValue )
{
if( this.aSetModifier )
aValue = this.aSetModifier( aValue );

this.aSetValueFunc( aValue );
};

GenericAnimation.prototype.getUnderlyingValue = function()
{
var aValue = this.aGetValueFunc();
if( this.aGetModifier )
aValue = this.aGetModifier( aValue );
return aValue;
};


function HSLAnimationWrapper( aColorAnimation )
{
assert( aColorAnimation,
'HSLAnimationWrapper constructor: invalid color animation delegate' );

this.aAnimation = aColorAnimation;
}


HSLAnimationWrapper.prototype.start = function( aAnimatableElement )
{
this.aAnimation.start( aAnimatableElement );
};

HSLAnimationWrapper.prototype.end = function()
{
this.aAnimation.end();
};
HSLAnimationWrapper.prototype.perform = function( aHSLValue )
{
this.aAnimation.perform( aHSLValue.convertToRGB() );
};

HSLAnimationWrapper.prototype.getUnderlyingValue = function()
{
return this.aAnimation.getUnderlyingValue().convertToHSL();
};


function SlideChangeBase(aLeavingSlide, aEnteringSlide)
{
this.aLeavingSlide = aLeavingSlide;
this.aEnteringSlide = aEnteringSlide;
this.bIsFinished = false;
}

SlideChangeBase.prototype.start = function()
{
};

SlideChangeBase.prototype.end = function()
{
if( this.bIsFinished )
return;

this.aLeavingSlide.hide();
this.aEnteringSlide.reset();
this.aLeavingSlide.reset();

this.bIsFinished = true;
};

SlideChangeBase.prototype.perform = function( nValue )
{
if( this.bIsFinished ) return false;

if( this.aLeavingSlide )
this.performOut( nValue );

if( this.aEnteringSlide )
this.performIn( nValue );

return true;
};

SlideChangeBase.prototype.getUnderlyingValue = function()
{
return 0.0;
};

SlideChangeBase.prototype.performIn = function( nValue )
{
log( 'SlideChangeBase.performIn: abstract method called' );
};

SlideChangeBase.prototype.performOut = function( nValue )
{
log( 'SlideChangeBase.performOut: abstract method called' );
};


function FadingSlideChange( aLeavingSlide, aEnteringSlide )
{
FadingSlideChange.superclass.constructor.call( this, aLeavingSlide, aEnteringSlide );
this.bFirstRun = true;
}
extend( FadingSlideChange, SlideChangeBase );

FadingSlideChange.prototype.start = function()
{
FadingSlideChange.superclass.start.call( this );
this.aEnteringSlide.notifyUsedAttribute( 'opacity' );
this.aLeavingSlide.notifyUsedAttribute( 'opacity' );
this.aEnteringSlide.setOpacity( 0.0 );
this.aEnteringSlide.show();
};

FadingSlideChange.prototype.performIn = function( nT )
{
this.aEnteringSlide.setOpacity( nT );
};

FadingSlideChange.prototype.performOut = function( nT )
{

this.aLeavingSlide.setOpacity( 1 - nT );
};


function FadingOverColorSlideChange( aLeavingSlide, aEnteringSlide, sFadeColor )
{
FadingSlideChange.superclass.constructor.call( this, aLeavingSlide, aEnteringSlide );
this.sFadeColor = sFadeColor;
if( !this.sFadeColor )
{
log( 'FadingOverColorSlideChange: sFadeColor not valid.' );
this.sFadeColor = '#000000';
}
this.aColorPlaneElement = this.createColorPlaneElement();
}
extend( FadingOverColorSlideChange, SlideChangeBase );

FadingOverColorSlideChange.prototype.start = function()
{
FadingOverColorSlideChange.superclass.start.call( this );
this.aEnteringSlide.notifyUsedAttribute( 'opacity' );
this.aLeavingSlide.notifyUsedAttribute( 'opacity' );
this.aLeavingSlide.insertBefore( this.aColorPlaneElement );
this.aEnteringSlide.setOpacity( 0.0 );
this.aEnteringSlide.show();
};

FadingOverColorSlideChange.prototype.end = function()
{
FadingOverColorSlideChange.superclass.end.call( this );
this.aLeavingSlide.removeElement( this.aColorPlaneElement );
};

FadingOverColorSlideChange.prototype.performIn = function( nT )
{
this.aEnteringSlide.setOpacity( (nT > 0.55) ? 2.0*(nT-0.55) : 0.0 );
};

FadingOverColorSlideChange.prototype.performOut = function( nT )
{
this.aLeavingSlide.setOpacity( (nT > 0.45) ? 0.0 : 2.0*(0.45-nT) );
};

FadingOverColorSlideChange.prototype.createColorPlaneElement = function()
{
var aColorPlaneElement = document.createElementNS( NSS['svg'], 'rect' );
aColorPlaneElement.setAttribute( 'width', String( this.aLeavingSlide.getWidth() ) );
aColorPlaneElement.setAttribute( 'height', String( this.aLeavingSlide.getHeight() ) );
aColorPlaneElement.setAttribute( 'fill', this.sFadeColor );
return aColorPlaneElement;
};


function MovingSlideChange( aLeavingSlide, aEnteringSlide,
aLeavingDirection, aEnteringDirection )
{
MovingSlideChange.superclass.constructor.call( this, aLeavingSlide, aEnteringSlide );
this.aLeavingDirection = aLeavingDirection;
this.aEnteringDirection = aEnteringDirection;
}
extend( MovingSlideChange, SlideChangeBase );

MovingSlideChange.prototype.start = function()
{
MovingSlideChange.superclass.start.call( this );
this.aEnteringSlide.notifyUsedAttribute( 'transform' );
this.aLeavingSlide.notifyUsedAttribute( 'transform' );
this.performIn( 0 );
this.aEnteringSlide.show();
};

MovingSlideChange.prototype.performIn = function( nT )
{
var nS = nT - 1;
var dx = nS * this.aEnteringDirection.x * this.aEnteringSlide.getWidth();
var dy = nS * this.aEnteringDirection.y * this.aEnteringSlide.getHeight();
this.aEnteringSlide.translate( dx, dy );
};

MovingSlideChange.prototype.performOut = function( nT )
{
var dx = nT * this.aLeavingDirection.x * this.aLeavingSlide.getWidth();
var dy = nT * this.aLeavingDirection.y * this.aLeavingSlide.getHeight();
this.aLeavingSlide.translate( dx, dy );
};


function ClippedSlideChange( aLeavingSlide, aEnteringSlide, aParametricPolyPolygon,
aTransitionInfo, bIsDirectionForward )
{
ClippedSlideChange.superclass.constructor.call( this, aLeavingSlide, aEnteringSlide );

var bIsModeIn = true;
this.aClippingFunctor= new ClippingFunctor( aParametricPolyPolygon, aTransitionInfo,
bIsDirectionForward, bIsModeIn );
}
extend( ClippedSlideChange, SlideChangeBase );

ClippedSlideChange.prototype.start = function()
{
ClippedSlideChange.superclass.start.call( this );
this.aEnteringSlide.notifyUsedAttribute( 'clip-path' );
this.performIn( 0 );
this.aEnteringSlide.show();
};

ClippedSlideChange.prototype.performIn = function( nT )
{
var nWidth = this.aEnteringSlide.getWidth();
var nHeight = this.aEnteringSlide.getHeight();
var aPolyPolygonElement = this.aClippingFunctor.perform( nT, nWidth, nHeight );
this.aEnteringSlide.setClipPath( aPolyPolygonElement );
};

ClippedSlideChange.prototype.performOut = function( nT )
{
};


function ClippingFunctor( aParametricPolyPolygon, aTransitionInfo,
bIsDirectionForward, bIsModeIn)
{
this.aParametricPolyPolygon = aParametricPolyPolygon;
this.aStaticTransformation = null;
this.bForwardParameterSweep = true;
this.bSubtractPolygon = false;
this.bScaleIsotropically = aTransitionInfo.scaleIsotropically;
this.bFlip = false;

assert( this.aParametricPolyPolygon,
'ClippingFunctor: parametric polygon is not valid' );

if( aTransitionInfo.rotationAngle != 0.0 ||
aTransitionInfo.scaleX != 1.0 ||  aTransitionInfo.scaleY != 1.0 )
{
this.aStaticTransformation = SVGIdentityMatrix.translate( 0.5, 0.5 );
if( aTransitionInfo.scaleX != 1.0 ||  aTransitionInfo.scaleY != 1.0 )
this.aStaticTransformation
= this.aStaticTransformation.scaleNonUniform( aTransitionInfo.scaleX,
aTransitionInfo.scaleY );
if( aTransitionInfo.rotationAngle != 0.0 )
this.aStaticTransformation
= this.aStaticTransformation.rotate( aTransitionInfo.rotationAngle );
this.aStaticTransformation = this.aStaticTransformation.translate( -0.5, -0.5 );
}
else
{
this.aStaticTransformation = document.documentElement.createSVGMatrix();
}

if( !bIsDirectionForward )
{
var aMatrix = null;
switch( aTransitionInfo.reverseMethod )
{
default:
log( 'ClippingFunctor: unexpected reverse method.' );
break;
case REVERSEMETHOD_IGNORE:
break;
case REVERSEMETHOD_INVERT_SWEEP:
this.bForwardParameterSweep = !this.bForwardParameterSweep;
break;
case REVERSEMETHOD_SUBTRACT_POLYGON:
this.bSubtractPolygon = !this.bSubtractPolygon;
break;
case REVERSEMETHOD_SUBTRACT_AND_INVERT:
this.bForwardParameterSweep = !this.bForwardParameterSweep;
this.bSubtractPolygon = !this.bSubtractPolygon;
break;
case REVERSEMETHOD_ROTATE_180:
aMatrix = document.documentElement.createSVGMatrix();
aMatrix.setToRotationAroundPoint( 0.5, 0.5, 180 );
this.aStaticTransformation = aMatrix.multiply( this.aStaticTransformation );
break;
case REVERSEMETHOD_FLIP_X:
aMatrix = document.documentElement.createSVGMatrix();
aMatrix.a = -1; aMatrix.e = 1.0;
this.aStaticTransformation = aMatrix.multiply( this.aStaticTransformation );
this.bFlip = true;
break;
case REVERSEMETHOD_FLIP_Y:
aMatrix = document.documentElement.createSVGMatrix();
aMatrix.d = -1; aMatrix.f = 1.0;
this.aStaticTransformation = aMatrix.multiply( this.aStaticTransformation );
this.bFlip = true;
break;
}
}

if( !bIsModeIn )
{
if( aTransitionInfo.outInvertsSweep )
{
this.bForwardParameterSweep = !this.bForwardParameterSweep;
}
else
{
this.bSubtractPolygon = !this.bSubtractPolygon;
}
}
}

ClippingFunctor.aBoundingPath = document.createElementNS( NSS['svg'], 'path' );
ClippingFunctor.aBoundingPath.setAttribute( 'd', 'M -1 -1 L 2 -1 L 2 2 L -1 2 L -1 -1' );

ClippingFunctor.prototype.perform = function( nT, nWidth, nHeight )
{
var aClipPoly = this.aParametricPolyPolygon.perform( this.bForwardParameterSweep ? nT : (1 - nT) );


if( this.bSubtractPolygon )
{
aClipPoly.changeOrientation();
aClipPoly.prependPath( ClippingFunctor.aBoundingPath );
}

var aMatrix;
if( this.bScaleIsotropically )
{
var nScaleFactor = Math.max( nWidth, nHeight );
aMatrix = SVGIdentityMatrix.translate( -( nScaleFactor - nWidth ) / 2.0,
-( nScaleFactor - nHeight ) / 2.0 );
aMatrix = aMatrix.scale( nScaleFactor );
aMatrix = aMatrix.multiply( this.aStaticTransformation );
}
else
{
aMatrix = SVGIdentityMatrix.scaleNonUniform( nWidth, nHeight );
aMatrix = aMatrix.multiply( this.aStaticTransformation );
}

aClipPoly.matrixTransform( aMatrix );

return aClipPoly;
};


function createClipPolyPolygon( nType, nSubtype )
{
switch( nType )
{
default:
log( 'createClipPolyPolygon: unknown transition type: ' + nType );
return null;
case BARWIPE_TRANSITION:
return new BarWipePath( 1 );
case FOURBOXWIPE_TRANSITION:
return new FourBoxWipePath( nSubtype === CORNERSOUT_TRANS_SUBTYPE );
case ELLIPSEWIPE_TRANSITION:
return new EllipseWipePath( nSubtype );
case PINWHEELWIPE_TRANSITION:
var nBlades;
switch( nSubtype )
{
case ONEBLADE_TRANS_SUBTYPE:
nBlades = 1;
break;
case DEFAULT_TRANS_SUBTYPE:
case TWOBLADEVERTICAL_TRANS_SUBTYPE:
nBlades = 2;
break;
case TWOBLADEHORIZONTAL_TRANS_SUBTYPE:
nBlades = 2;
break;
case THREEBLADE_TRANS_SUBTYPE:
nBlades = 3;
break;
case FOURBLADE_TRANS_SUBTYPE:
nBlades = 4;
break;
case EIGHTBLADE_TRANS_SUBTYPE:
nBlades = 8;
break;
default:
log( 'createClipPolyPolygon: unknown subtype: ' + nSubtype );
return null;
}
return new PinWheelWipePath( nBlades );
case RANDOMBARWIPE_TRANSITION:
return new RandomWipePath( 128, true /* bars */ );
case CHECKERBOARDWIPE_TRANSITION:
return new CheckerBoardWipePath( 10 );
case DISSOLVE_TRANSITION:
return new RandomWipePath( 16 * 16, false /* dissolve */ );
}
}


function createUnitSquarePath()
{
var aPath = document.createElementNS( NSS['svg'], 'path' );
var sD = 'M 0 0 L 1 0 L 1 1 L 0 1 L 0 0';
aPath.setAttribute( 'd', sD );
return aPath;
}

function createEmptyPath()
{
var aPath = document.createElementNS( NSS['svg'], 'path' );
var sD = 'M 0 0 L 0 0';
aPath.setAttribute( 'd', sD );
return aPath;
}

function pruneScaleValue( nVal )
{
if( nVal < 0.0 )
return (nVal < -0.00001 ? nVal : -0.00001);
else
return (nVal > 0.00001 ? nVal : 0.00001);
}


function BarWipePath( nBars /* nBars > 1: blinds effect */ )
{
this.nBars = nBars;
if( this.nBars === undefined || this.nBars < 1 )
this.nBars = 1;
this.aBasePath = createUnitSquarePath();
}

BarWipePath.prototype.perform = function( nT )
{

var aMatrix = SVGIdentityMatrix.scaleNonUniform( pruneScaleValue( nT / this.nBars ), 1.0 );

var aPolyPath = this.aBasePath.cloneNode( true );
aPolyPath.matrixTransform( aMatrix );

if( this.nBars > 1 )
{
var i;
var aTransform;
var aPath;
for( i = this.nBars - 1; i > 0; --i )
{
aTransform = SVGIdentityMatrix.translate( i / this.nBars, 0.0 );
aTransform = aTransform.multiply( aMatrix );
aPath = this.aBasePath.cloneNode( true );
aPath.matrixTransform( aTransform );
aPolyPath.appendPath( aPath );
}
}
return aPolyPath;
};


function FourBoxWipePath( bCornersOut )
{
this.bCornersOut = bCornersOut;
this.aBasePath = createUnitSquarePath();
}

FourBoxWipePath.prototype.perform = function( nT )
{
var aMatrix;
var d = pruneScaleValue( nT / 2.0 );

if( this.bCornersOut )
{
aMatrix = SVGIdentityMatrix.translate( -0.25, -0.25 ).scale( d ).translate( -0.5, -0.5 );
}
else
{
aMatrix = SVGIdentityMatrix.translate( -0.5, -0.5 ).scale( d );
}


var aTransform = aMatrix;
var aSquare = this.aBasePath.cloneNode( true );
aSquare.matrixTransform( aTransform );
var aPolyPath = aSquare;
aMatrix = SVGIdentityMatrix.flipY();
aTransform = aMatrix.multiply( aTransform );
aSquare = this.aBasePath.cloneNode( true );
aSquare.matrixTransform( aTransform );
aSquare.changeOrientation();
aPolyPath.appendPath( aSquare );
aMatrix = SVGIdentityMatrix.flipX();
aTransform = aMatrix.multiply( aTransform );
aSquare = this.aBasePath.cloneNode( true );
aSquare.matrixTransform( aTransform );
aPolyPath.appendPath( aSquare );
aMatrix = SVGIdentityMatrix.flipY();
aTransform = aMatrix.multiply( aTransform );
aSquare = this.aBasePath.cloneNode( true );
aSquare.matrixTransform( aTransform );
aSquare.changeOrientation();
aPolyPath.appendPath( aSquare );

aMatrix = SVGIdentityMatrix.translate( 0.5, 0.5 );
aMatrix = aMatrix.scale( 1.1 );
aPolyPath.matrixTransform( aMatrix );

return aPolyPath;
};


function EllipseWipePath( eSubtype )
{
this.eSubtype = eSubtype;

var sPathData = 'M 0.5 -0.207107 ' +
'C 0.687536 -0.207107 0.867392 -0.132608 1 0 ' +
'C 1.13261 0.132608 1.20711 0.312464 1.20711 0.5 ' +
'C 1.20711 0.687536 1.13261 0.867392 1 1 ' +
'C 0.867392 1.13261 0.687536 1.20711 0.5 1.20711 ' +
'C 0.312464 1.20711 0.132608 1.13261 0 1 ' +
'C -0.132608 0.867392 -0.207107 0.687536 -0.207107 0.5 ' +
'C -0.207107 0.312464 -0.132608 0.132608 0 0 ' +
'C 0.132608 -0.132608 0.312464 -0.207107 0.5 -0.207107';

this.aBasePath = document.createElementNS( NSS['svg'], 'path' );
this.aBasePath.setAttribute( 'd', sPathData );
}

EllipseWipePath.prototype.perform = function( nT )
{

var aTransform = SVGIdentityMatrix.translate( 0.5, 0.5 ).scale( nT ).translate( -0.5, -0.5 );
var aEllipse = this.aBasePath.cloneNode( true );
aEllipse.matrixTransform( aTransform );

return aEllipse;
};


function PinWheelWipePath( nBlades )
{
this.nBlades = nBlades;
if( !this.nBlades || this.nBlades < 1 )
this.nBlades = 1;
}

PinWheelWipePath.calcCenteredClock = function( nT, nE )
{
var nMAX_EDGE = 2;

var aTransform = SVGIdentityMatrix.rotate( nT * 360 );

var aPoint = document.documentElement.createSVGPoint();
aPoint.y = -nMAX_EDGE;
aPoint = aPoint.matrixTransform( aTransform );

var sPathData = 'M ' + aPoint.x + ' ' + aPoint.y + ' ';
if( nT >= 0.875 )
sPathData += 'L ' + '-' + nE + ' -' + nE + ' ';
if( nT >= 0.625 )
sPathData += 'L ' + '-' + nE + ' ' + nE + ' ';
if( nT >= 0.375 )
sPathData += 'L ' + nE + ' ' + nE + ' ';
if( nT >= 0.125 )
sPathData += 'L ' + nE + ' -' + nE + ' ';

sPathData += 'L 0 -' + nE + ' ';
sPathData += 'L 0 0 ';
sPathData += 'L '  + aPoint.x + ' ' + aPoint.y;

var aPath = document.createElementNS( NSS['svg'], 'path' );
aPath.setAttribute( 'd', sPathData );
return aPath;
};

PinWheelWipePath.prototype.perform = function( nT )
{
var aBasePath = PinWheelWipePath.calcCenteredClock( nT / this.nBlades,
2.0 /* max edge when rotating */  );

var aPolyPath = aBasePath.cloneNode( true );
var aPath;
var aRotation;
var i;
for( i = this.nBlades - 1; i > 0; --i )
{
aRotation = SVGIdentityMatrix.rotate( (i * 360) / this.nBlades );
aPath = aBasePath.cloneNode( true );
aPath.matrixTransform( aRotation );
aPolyPath.appendPath( aPath );
}

var aTransform = SVGIdentityMatrix.translate( 0.5, 0.5 ).scale( 0.5 );
aPolyPath.matrixTransform( aTransform );

return aPolyPath;
};


function CheckerBoardWipePath( unitsPerEdge )
{
this.unitsPerEdge = unitsPerEdge;
if( this.unitsPerEdge === undefined || this.unitsPerEdge < 1 )
this.unitsPerEdge = 10;
this.aBasePath = createUnitSquarePath();
}

CheckerBoardWipePath.prototype.perform = function( nT )
{
var d = pruneScaleValue(1.0 / this.unitsPerEdge);
var aMatrix = SVGIdentityMatrix.scaleNonUniform(pruneScaleValue( d*2.0*nT ),
pruneScaleValue( d ) );

var aPolyPath = null;
var i, j;
var aTransform;
var aPath;
for ( i = this.unitsPerEdge; i--; )
{
aTransform = SVGIdentityMatrix;

if ((i % 2) == 1) // odd line
aTransform = aTransform.translate( -d, 0.0 );

aTransform = aTransform.multiply( aMatrix );

for ( j = (this.unitsPerEdge / 2) + 1; j--;)
{
aPath = this.aBasePath.cloneNode( true );
aPath.matrixTransform( aTransform );
if (aPolyPath == null) aPolyPath = aPath;
else aPolyPath.appendPath( aPath );
aTransform = SVGIdentityMatrix.translate( d*2.0, 0.0 ).multiply( aTransform );
}

aMatrix = SVGIdentityMatrix.translate( 0.0, d ).multiply( aMatrix ); // next line
}

return aPolyPath;
};


function RandomWipePath( nElements, bRandomBars )
{
this.nElements = nElements;
this.aBasePath = createUnitSquarePath();
this.aPositionArray = new Array( nElements );
this.aClipPath = createEmptyPath();
this.nAlreadyAppendedElements = 0;

var fEdgeLength, nPos, aTransform;

if( bRandomBars ) // random bar wipe
{
fEdgeLength = 1.0 / nElements;
for( nPos = 0; nPos < nElements; ++nPos )
{
this.aPositionArray[nPos] = { x: 0.0, y: pruneScaleValue( nPos * fEdgeLength ) }
}
aTransform = SVGIdentityMatrix.scaleNonUniform( 1.0, pruneScaleValue( fEdgeLength ) );
}
else // dissolve wipe
{
var nSqrtElements = Math.round( Math.sqrt( nElements ) );
fEdgeLength = 1.0 / nSqrtElements;
for( nPos = 0; nPos < nElements; ++nPos )
{
this.aPositionArray[nPos] = {
x: pruneScaleValue( ( nPos % nSqrtElements ) * fEdgeLength ),
y: pruneScaleValue( ( nPos / nSqrtElements ) * fEdgeLength ) }
}
aTransform = SVGIdentityMatrix.scale( pruneScaleValue( fEdgeLength ) );
}
this.aBasePath.matrixTransform( aTransform );

var nPos1, nPos2;
var tmp;
for( nPos1 = nElements - 1; nPos1 > 0; --nPos1 )
{
nPos2 = getRandomInt( nPos1 + 1 );
tmp = this.aPositionArray[nPos1];
this.aPositionArray[nPos1] = this.aPositionArray[nPos2];
this.aPositionArray[nPos2] = tmp;
}
}

RandomWipePath.prototype.perform = function( nT )
{
var aPolyPath = createEmptyPath();
var aPoint;
var aPath;
var aTransform;
var nElements = Math.round( nT * this.nElements );
if( nElements === 0 )
{
return aPolyPath;
}
if( this.nAlreadyAppendedElements >= nElements )
{
this.nAlreadyAppendedElements = 0;
this.aClipPath = createEmptyPath();
}
var nPos;
for( nPos = this.nAlreadyAppendedElements; nPos < nElements; ++nPos )
{
aPoint = this.aPositionArray[nPos];
aPath = this.aBasePath.cloneNode( true );
aTransform = SVGIdentityMatrix.translate( aPoint.x, aPoint.y );
aPath.matrixTransform( aTransform );
aPolyPath.appendPath( aPath );
}

this.nAlreadyAppendedElements = nElements;
this.aClipPath.appendPath( aPolyPath );

return this.aClipPath.cloneNode( true );
};


function AnimatedSlide( aMetaSlide )
{
if( !aMetaSlide )
{
log( 'AnimatedSlide constructor: meta slide is not valid' );
}

this.aMetaSlide = aMetaSlide;
this.aSlideElement = this.aMetaSlide.slideElement;
this.sSlideId = this.aMetaSlide.slideId;

this.aUsedAttributeSet = [];

this.aClipPathElement = null;
this.aClipPathContent = null;
this.bIsClipped = false;
}

AnimatedSlide.prototype.show = function()
{
this.aMetaSlide.show();
};

AnimatedSlide.prototype.hide = function()
{
this.aMetaSlide.hide();
};

AnimatedSlide.prototype.notifyUsedAttribute = function( sName )
{
if( sName == 'clip-path' )
{
this.initClipPath();
this.bIsClipped = true;
}
else
{
this.aUsedAttributeSet.push( sName );
}
};

AnimatedSlide.prototype.reset = function()
{
if( this.bIsClipped )
{
this.cleanClipPath();
this.bIsClipped = false;
}

var i;
for( i = 0; i < this.aUsedAttributeSet.length; ++i )
{
var sAttrName = this.aUsedAttributeSet[i];
this.aSlideElement.removeAttribute( sAttrName );
}
this.aUsedAttributeSet = [];
};

AnimatedSlide.prototype.initClipPath = function()
{
this.aClipPathElement = document.createElementNS( NSS['svg'], 'clipPath' );

var sId = 'clip-path-' + this.sSlideId;
this.aClipPathElement.setAttribute( 'id', sId );
this.aClipPathElement.setAttribute( 'clipPathUnits', 'userSpaceOnUse' );

this.aClipPathContent = document.createElementNS( NSS['svg'], 'path' );
var sPathData = 'M 0 0 h ' + WIDTH + ' v ' + HEIGHT + ' h -' + WIDTH + ' z';
this.aClipPathContent.setAttribute( 'd', sPathData );
this.aClipPathElement.appendChild( this.aClipPathContent );

var aClipPathGroup = theMetaDoc.aClipPathGroup;
aClipPathGroup.appendChild( this.aClipPathElement );

var sRef = 'url(#' + sId + ')';
this.aSlideElement.parentNode.setAttribute( 'clip-path', sRef );
};

AnimatedSlide.prototype.cleanClipPath = function()
{
this.aSlideElement.parentNode.removeAttribute( 'clip-path' );

if( this.aClipPathElement )
{
var aClipPathGroup = theMetaDoc.aClipPathGroup;
aClipPathGroup.removeChild( this.aClipPathElement );
this.aClipPathElement = null;
this.aClipPathContent = null;
}
};

AnimatedSlide.prototype.insertBefore = function( aElement )
{
if( aElement )
{
this.aSlideElement.parentNode.insertBefore( aElement, this.aSlideElement );
}
};

AnimatedSlide.prototype.appendElement = function( aElement )
{
if( aElement )
{
this.aSlideElement.parentNode.appendChild( aElement );
}
};

AnimatedSlide.prototype.removeElement = function( aElement )
{
if( aElement )
{
this.aSlideElement.parentNode.removeChild( aElement );
}
};

AnimatedSlide.prototype.getWidth = function()
{
return WIDTH;
};

AnimatedSlide.prototype.getHeight = function()
{
return HEIGHT;
};

AnimatedSlide.prototype.setOpacity = function( nValue )
{
this.aSlideElement.setAttribute( 'opacity', nValue );
};

AnimatedSlide.prototype.translate = function( nDx, nDy )
{
var sTransformAttr = 'translate(' + nDx + ',' + nDy + ')';
this.aSlideElement.setAttribute( 'transform', sTransformAttr );
};

AnimatedSlide.prototype.setClipPath = function( aClipPathContent )
{
if( this.aClipPathContent )
{
var sPathData = aClipPathContent.getAttribute( 'd' );
this.aClipPathContent.setAttribute( 'd', sPathData );
}
};


function AnimatedElement( aElement )
{
if( !aElement )
{
log( 'AnimatedElement constructor: element is not valid' );
}

this.aSlideShowContext = null;

this.aBaseElement = aElement.cloneNode( true );
this.aActiveElement = aElement;
this.sElementId = this.aActiveElement.getAttribute( 'id' );

this.aBaseBBox = this.aActiveElement.getBBox();
this.nBaseCenterX = this.aBaseBBox.x + this.aBaseBBox.width / 2;
this.nBaseCenterY = this.aBaseBBox.y + this.aBaseBBox.height / 2;


this.aClipPathElement = null;
this.aClipPathContent = null;

this.aPreviousElement = null;
this.aStateSet = {};

this.eAdditiveMode = ADDITIVE_MODE_REPLACE;
this.bIsUpdated = true;

this.aTMatrix = document.documentElement.createSVGMatrix();
this.aCTM = document.documentElement.createSVGMatrix();
this.aICTM = document.documentElement.createSVGMatrix();

this.initElement();
}

AnimatedElement.prototype.initElement = function()
{
this.nCenterX = this.nBaseCenterX;
this.nCenterY = this.nBaseCenterY;
this.nScaleFactorX = 1.0;
this.nScaleFactorY = 1.0;

this.aActiveElement.setAttribute( 'transform', makeMatrixString( 1, 0, 0, 1, 0, 0 ) );
};

AnimatedElement.prototype.initClipPath = function()
{
this.aClipPathElement = document.createElementNS( NSS['svg'], 'clipPath' );

var sId = 'clip-path-' + this.sElementId;
this.aClipPathElement.setAttribute( 'id', sId );
this.aClipPathElement.setAttribute( 'clipPathUnits', 'userSpaceOnUse' );

this.aClipPathContent = document.createElementNS( NSS['svg'], 'path' );
this.aClippingBBox = this.getBBoxWithStroke();
var nWidth = this.aClippingBBox.width;
var nHeight = this.aClippingBBox.height;
var sPathData = 'M ' + this.aClippingBBox.x + ' ' + this.aClippingBBox.y +
' h ' + nWidth + ' v ' + nHeight + ' h -' + nWidth + ' z';
this.aClipPathContent.setAttribute( 'd', sPathData );
this.aClipPathElement.appendChild( this.aClipPathContent );

var aClipPathGroup = theMetaDoc.aClipPathGroup;
aClipPathGroup.appendChild( this.aClipPathElement );

var sRef = 'url(#' + sId + ')';
this.aActiveElement.setAttribute( 'clip-path', sRef );
};

AnimatedElement.prototype.cleanClipPath = function()
{
this.aActiveElement.removeAttribute( 'clip-path' );

if( this.aClipPathElement )
{
var aClipPathGroup = theMetaDoc.aClipPathGroup;
aClipPathGroup.removeChild( this.aClipPathElement );
this.aClipPathElement = null;
this.aClipPathContent = null;
}
};

AnimatedElement.prototype.getId = function()
{
return this.aActiveElement.getAttribute( 'id' );
};

AnimatedElement.prototype.getAdditiveMode = function()
{
return this.eAdditiveMode;
};

AnimatedElement.prototype.setAdditiveMode = function( eAdditiveMode )
{
this.eAdditiveMode = eAdditiveMode;
};

AnimatedElement.prototype.setToElement = function( aElement )
{
if( !aElement )
{
log( 'AnimatedElement(' + this.getId() + ').setToElement: element is not valid' );
return false;
}

var aClone = aElement.cloneNode( true );
this.aPreviousElement = this.aActiveElement.parentNode.replaceChild( aClone, this.aActiveElement );
this.aActiveElement = aClone;

return true;
};

AnimatedElement.prototype.notifySlideStart = function( aSlideShowContext )
{
if( !aSlideShowContext )
{
log( 'AnimatedElement.notifySlideStart: slideshow context is not valid' );
}
this.aSlideShowContext = aSlideShowContext;

var aClone = this.aBaseElement.cloneNode( true );
this.aActiveElement.parentNode.replaceChild( aClone, this.aActiveElement );
this.aActiveElement = aClone;

this.initElement();
this.DBG( '.notifySlideStart invoked' );
};

AnimatedElement.prototype.notifySlideEnd = function()
{
};

AnimatedElement.prototype.notifyAnimationStart = function()
{
};

AnimatedElement.prototype.notifyAnimationEnd = function()
{
};

AnimatedElement.prototype.notifyNextEffectStart = function( nEffectIndex )
{
};

AnimatedElement.prototype.saveState = function( nAnimationNodeId )
{
ANIMDBG.print( 'AnimatedElement(' + this.getId() + ').saveState(' + nAnimationNodeId +')' );
if( !this.aStateSet[ nAnimationNodeId ] )
{
this.aStateSet[ nAnimationNodeId ] = {};
}
var aState = this.aStateSet[ nAnimationNodeId ];
aState.aElement = this.aActiveElement.cloneNode( true );
aState.nCenterX = this.nCenterX;
aState.nCenterY = this.nCenterY;
aState.nScaleFactorX = this.nScaleFactorX;
aState.nScaleFactorY = this.nScaleFactorY;

};

AnimatedElement.prototype.restoreState = function( nAnimationNodeId )
{
if( !this.aStateSet[ nAnimationNodeId ] )
{
log( 'AnimatedElement(' + this.getId() + ').restoreState: state '
+nAnimationNodeId  + ' is not valid' );
return false;
}

ANIMDBG.print( 'AnimatedElement(' + this.getId() + ').restoreState(' + nAnimationNodeId +')' );
var aState = this.aStateSet[ nAnimationNodeId ];
var bRet = this.setToElement( aState.aElement );
if( bRet )
{
this.nCenterX = aState.nCenterX;
this.nCenterY = aState.nCenterY;
this.nScaleFactorX = aState.nScaleFactorX;
this.nScaleFactorY = aState.nScaleFactorY;
}
return bRet;
};

AnimatedElement.prototype.getBaseBBox = function()
{
return this.aBaseBBox;
};

AnimatedElement.prototype.getBaseCenterX = function()
{
return this.nBaseCenterX;
};

AnimatedElement.prototype.getBaseCenterY = function()
{
return this.nBaseCenterY;
};

AnimatedElement.prototype.getBBox = function()
{
return this.aActiveElement.parentNode.getBBox();
};

AnimatedElement.prototype.getBBoxWithStroke = function()
{
var aBBox = this.aActiveElement.parentNode.getBBox();

var aChildrenSet = this.aActiveElement.childNodes;

var sStroke, sStrokeWidth;
var nStrokeWidth = 0;
var i;
for( i = 0; i < aChildrenSet.length; ++i )
{
if( ! aChildrenSet[i].getAttribute  )
continue;

sStroke = aChildrenSet[i].getAttribute( 'stroke' );
if( sStroke && sStroke != 'none' )
{
sStrokeWidth = aChildrenSet[i].getAttribute( 'stroke-width' );
var nSW = parseFloat( sStrokeWidth );
if( nSW > nStrokeWidth )
nStrokeWidth = nSW;
}
}

if( nStrokeWidth == 0 )
{
sStrokeWidth = ROOT_NODE.getAttribute( 'stroke-width' );
nStrokeWidth = parseFloat( sStrokeWidth );
}
if( nStrokeWidth != 0 )
{
nStrokeWidth *= 1.1;
var nHalfStrokeWidth = nStrokeWidth / 2;
var nDoubleStrokeWidth = nStrokeWidth * 2;

var aEBBox = document.documentElement.createSVGRect();
aEBBox.x = aBBox.x - nHalfStrokeWidth;
aEBBox.y = aBBox.y - nHalfStrokeWidth;
aEBBox.width = aBBox.width + nDoubleStrokeWidth;
aEBBox.height = aBBox.height + nDoubleStrokeWidth;
aBBox = aEBBox;
}
return aBBox;
};

AnimatedElement.prototype.setClipPath = function( aClipPathContent )
{
if( this.aClipPathContent )
{
var aTranslation = SVGIdentityMatrix.translate( this.aClippingBBox.x,
this.aClippingBBox.y);
aClipPathContent.matrixTransform( aTranslation );
var sPathData = aClipPathContent.getAttribute( 'd' );
this.aClipPathContent.setAttribute( 'd', sPathData );
}
};


AnimatedElement.prototype.getX = function()
{
return this.nCenterX;
};

AnimatedElement.prototype.getY = function()
{
return this.nCenterY;
};

AnimatedElement.prototype.getWidth = function()
{
return this.nScaleFactorX * this.getBaseBBox().width;
};

AnimatedElement.prototype.getHeight = function()
{
return this.nScaleFactorY * this.getBaseBBox().height;
};

AnimatedElement.prototype.updateTransformAttribute = function()
{
this.aTransformAttrList = this.aActiveElement.transform.baseVal;
this.aTransformAttr = this.aTransformAttrList.getItem( 0 );
this.aTransformAttr.setMatrix( this.aTMatrix );
};

AnimatedElement.prototype.setX = function( nNewCenterX )
{
if( nNewCenterX === this.nCenterX ) return;

this.aTransformAttrList = this.aActiveElement.transform.baseVal;
this.aTransformAttr = this.aTransformAttrList.getItem( 0 );
this.aTMatrix = this.aTransformAttr.matrix.translate( nNewCenterX - this.nCenterX, 0 );
this.aTransformAttr.setMatrix( this.aTMatrix );
this.nCenterX = nNewCenterX;
};

AnimatedElement.prototype.setY = function( nNewCenterY )
{
if( nNewCenterY === this.nCenterY ) return;

this.aTransformAttrList = this.aActiveElement.transform.baseVal;
this.aTransformAttr = this.aTransformAttrList.getItem( 0 );
this.aTMatrix = this.aTransformAttr.matrix.translate( 0, nNewCenterY - this.nCenterY );
this.aTransformAttr.setMatrix( this.aTMatrix );
this.nCenterY = nNewCenterY;
};

AnimatedElement.prototype.setWidth = function( nNewWidth )
{
ANIMDBG.print( 'AnimatedElement.setWidth: nNewWidth = ' + nNewWidth );
if( nNewWidth < 0 )
{
log('AnimatedElement(' + this.getId() + ').setWidth: negative height!');
nNewWidth = 0;
}

var nBaseWidth = this.getBaseBBox().width;
var nScaleFactorX = nNewWidth / nBaseWidth;

if( nScaleFactorX < 1e-5 ) nScaleFactorX = 1e-5;
if( nScaleFactorX == this.nScaleFactorX ) return;

this.aTMatrix = document.documentElement.createSVGMatrix()
.translate( this.nCenterX, this.nCenterY )
.scaleNonUniform( nScaleFactorX, this.nScaleFactorY )
.translate( -this.nBaseCenterX, -this.nBaseCenterY );
this.updateTransformAttribute();

this.nScaleFactorX = nScaleFactorX;
};

AnimatedElement.prototype.setHeight = function( nNewHeight )
{
ANIMDBG.print( 'AnimatedElement.setWidth: nNewHeight = ' + nNewHeight );
if( nNewHeight < 0 )
{
log('AnimatedElement(' + this.getId() + ').setWidth: negative height!');
nNewHeight = 0;
}

var nBaseHeight = this.getBaseBBox().height;
var nScaleFactorY = nNewHeight / nBaseHeight;

if( nScaleFactorY < 1e-5 ) nScaleFactorY = 1e-5;
if( nScaleFactorY == this.nScaleFactorY ) return;

this.aTMatrix = document.documentElement.createSVGMatrix()
.translate( this.nCenterX, this.nCenterY )
.scaleNonUniform( this.nScaleFactorX, nScaleFactorY )
.translate( -this.nBaseCenterX, -this.nBaseCenterY );
this.updateTransformAttribute();

this.nScaleFactorY = nScaleFactorY;
};

AnimatedElement.prototype.getOpacity = function()
{
return this.aActiveElement.getAttribute( 'opacity' );
};

AnimatedElement.prototype.setOpacity = function( nValue )
{
this.aActiveElement.setAttribute( 'opacity', nValue );
};

AnimatedElement.prototype.getVisibility = function()
{

var sVisibilityValue = this.aActiveElement.getAttribute( 'visibility' );
if( !sVisibilityValue || ( sVisibilityValue === 'inherit' ) )
return 'visible'; // TODO: look for parent visibility!
else
return sVisibilityValue;
};

AnimatedElement.prototype.setVisibility = function( sValue )
{
if( sValue == 'visible' )
sValue = 'inherit';
this.aActiveElement.setAttribute( 'visibility', sValue );
};

AnimatedElement.prototype.getStrokeStyle = function()
{
return 'solid';
};

AnimatedElement.prototype.setStrokeStyle = function( sValue )
{
ANIMDBG.print( 'AnimatedElement.setStrokeStyle(' + sValue + ')' );
};

AnimatedElement.prototype.getFillStyle = function()
{
return 'solid';
};

AnimatedElement.prototype.setFillStyle = function( sValue )
{
ANIMDBG.print( 'AnimatedElement.setFillStyle(' + sValue + ')' );
};

AnimatedElement.prototype.getFillColor = function()
{
var aChildSet = getElementChildren( this.aActiveElement );
var sFillColorValue = '';
for( var i = 0; i <  aChildSet.length; ++i )
{
sFillColorValue = aChildSet[i].getAttribute( 'fill' );
if( sFillColorValue && ( sFillColorValue !== 'none' ) )
break;
}

return colorParser( sFillColorValue );
};

AnimatedElement.prototype.setFillColor = function( aRGBValue )
{
assert( aRGBValue instanceof RGBColor,
'AnimatedElement.setFillColor: value argument is not an instance of RGBColor' );

var sValue = aRGBValue.toString( true /* clamped values */ );
var aChildSet = getElementChildren( this.aActiveElement );

var sFillColorValue = '';
for( var i = 0; i <  aChildSet.length; ++i )
{
sFillColorValue = aChildSet[i].getAttribute( 'fill' );
if( sFillColorValue && ( sFillColorValue !== 'none' ) )
{
aChildSet[i].setAttribute( 'fill', sValue );
}
}
};

AnimatedElement.prototype.getStrokeColor = function()
{
var aChildSet = getElementChildren( this.aActiveElement );
var sStrokeColorValue = '';
for( var i = 0; i <  aChildSet.length; ++i )
{
sStrokeColorValue = aChildSet[i].getAttribute( 'stroke' );
if( sStrokeColorValue && ( sStrokeColorValue !== 'none' ) )
break;
}

return colorParser( sStrokeColorValue );
};

AnimatedElement.prototype.setStrokeColor = function( aRGBValue )
{
assert( aRGBValue instanceof RGBColor,
'AnimatedElement.setFillColor: value argument is not an instance of RGBColor' );

var sValue = aRGBValue.toString( true /* clamped values */ );
var aChildSet = getElementChildren( this.aActiveElement );

var sStrokeColorValue = '';
for( var i = 0; i <  aChildSet.length; ++i )
{
sStrokeColorValue = aChildSet[i].getAttribute( 'stroke' );
if( sStrokeColorValue && ( sStrokeColorValue !== 'none' ) )
{
aChildSet[i].setAttribute( 'stroke', sValue );
}
}
};

AnimatedElement.prototype.getFontColor = function()
{
return new RGBColor( 0, 0, 0 );
};

AnimatedElement.prototype.setFontColor = function( sValue )
{
ANIMDBG.print( 'AnimatedElement.setFontColor(' + sValue + ')' );
};

AnimatedElement.prototype.DBG = function( sMessage, nTime )
{
aAnimatedElementDebugPrinter.print( 'AnimatedElement(' + this.getId() + ')' + sMessage, nTime );
};


function AnimatedTextElement( aElement, aEventMultiplexer )
{
var theDocument = document;

var sTextType = aElement.getAttribute( 'class' );
var bIsListItem = ( sTextType === 'ListItem' );
if( ( sTextType !== 'TextParagraph' ) && !bIsListItem )
{
log( 'AnimatedTextElement: passed element is not a paragraph.' );
return;
}
var aTextShapeElement = aElement.parentNode;
sTextType = aTextShapeElement.getAttribute( 'class' );
if( sTextType !== 'TextShape' )
{
log( 'AnimatedTextElement: element parent is not a text shape.' );
return;
}
var aTextShapeGroup = aTextShapeElement.parentNode;
var aAnimatedElementGroup = getElementByClassName( aTextShapeGroup, 'AnimatedElements' );
if( !aAnimatedElementGroup )
{
aAnimatedElementGroup = theDocument.createElementNS( NSS['svg'], 'g' );
aAnimatedElementGroup.setAttribute( 'class', 'AnimatedElements' );
aTextShapeGroup.appendChild( aAnimatedElementGroup );
}

var aAnimatableElement = theDocument.createElementNS( NSS['svg'], 'g' );
var aTextElement = theDocument.createElementNS( NSS['svg'], 'text' );
var aParagraphElement = aElement.cloneNode( true );

this.aGraphicGroupElement = theDocument.createElementNS( NSS['svg'], 'g' );
this.aGraphicGroupElement.setAttribute( 'class', 'GraphicGroup' );

var aBulletCharClone = null;
var aBulletCharElem = null;
var bIsBulletCharStyle =
( aElement.getAttributeNS( NSS['ooo'], aOOOAttrListItemNumberingType ) === 'bullet-style' );
if( bIsBulletCharStyle )
{
var aBulletCharGroupElem = getElementByClassName( aTextShapeGroup, 'BulletChars' );
if( aBulletCharGroupElem )
{
var aBulletPlaceholderElem = getElementByClassName( aElement, 'BulletPlaceholder' );
if( aBulletPlaceholderElem )
{
var sId = aBulletPlaceholderElem.getAttribute( 'id' );
sId = 'bullet-char(' + sId + ')';
aBulletCharElem = theDocument.getElementById( sId );
if( aBulletCharElem )
{
aBulletCharClone = aBulletCharElem.cloneNode( true );
}
else
{
log( 'AnimatedTextElement: ' + sId + ' not found.' );
}
}
else
{
log( 'AnimatedTextElement: no bullet placeholder found' );
}
}
else
{
log( 'AnimatedTextElement: no bullet char group found' );
}
}

var aBitmapElemSet = [];
var aBitmapCloneSet = [];
var aBitmapPlaceholderSet = getElementsByClassName( aElement, 'BitmapPlaceholder' );
var i;
if( aBitmapPlaceholderSet )
{
for( i = 0; i < aBitmapPlaceholderSet.length; ++i )
{
sId = aBitmapPlaceholderSet[i].getAttribute( 'id' );
var sBitmapChecksum = sId.substring( 'bitmap-placeholder'.length + 1, sId.length - 1 );
sId = 'embedded-bitmap(' + sBitmapChecksum + ')';
aBitmapElemSet[i] = theDocument.getElementById( sId );
if( aBitmapElemSet[i] )
{
aBitmapCloneSet[i] = aBitmapElemSet[i].cloneNode( true );
}
else
{
log( 'AnimatedTextElement: ' + sId + ' not found.' );
}
}
}


this.sParagraphId = sId = aParagraphElement.getAttribute( 'id' );
aParagraphElement.removeAttribute( 'id' );
aAnimatableElement.setAttribute( 'id', sId +'.a' );
if( aBulletCharClone )
aBulletCharClone.removeAttribute( 'id' );
for( i = 0; i < aBitmapCloneSet.length; ++i )
{
if( aBitmapCloneSet[i] )
aBitmapCloneSet[i].removeAttribute( 'id' );
}

var sVisibilityAttr = aElement.getAttribute( 'visibility' );
if( !sVisibilityAttr )
sVisibilityAttr = 'inherit';
aAnimatableElement.setAttribute( 'visibility', sVisibilityAttr );
aParagraphElement.setAttribute( 'visibility', 'inherit' );
this.aGraphicGroupElement.setAttribute( 'visibility', 'inherit' );
if( aBulletCharElem )
aBulletCharElem.setAttribute( 'visibility', 'hidden' );
for( i = 0; i < aBitmapCloneSet.length; ++i )
{
if( aBitmapElemSet[i] )
aBitmapElemSet[i].setAttribute( 'visibility', 'hidden' );
}


aTextElement.appendChild( aParagraphElement );
aAnimatableElement.appendChild( aTextElement );

if( aBulletCharClone )
this.aGraphicGroupElement.appendChild( aBulletCharClone );
for( i = 0; i < aBitmapCloneSet.length; ++i )
{
if( aBitmapCloneSet[i] )
this.aGraphicGroupElement.appendChild( aBitmapCloneSet[i] );
}
aAnimatableElement.appendChild( this.aGraphicGroupElement );
aAnimatedElementGroup.appendChild( aAnimatableElement );

this.aParentTextElement = aElement.parentNode;
this.aParagraphElement = aElement;
this.aAnimatedElementGroup = aAnimatedElementGroup;
this.nRunningAnimations = 0;

this.aHyperlinkIdSet = [];
var aHyperlinkElementSet = getElementsByClassName( this.aParagraphElement, 'UrlField' );
var sHyperlinkId;
for( i = 0; i < aHyperlinkElementSet.length; ++i )
{
sHyperlinkId = aHyperlinkElementSet[i].getAttribute( 'id' );
if( sHyperlinkId )
this.aHyperlinkIdSet.push( sHyperlinkId );
else
log( 'error: AnimatedTextElement constructor: hyperlink element has no id' );
}

AnimatedTextElement.superclass.constructor.call( this, aAnimatableElement, aEventMultiplexer );

}
extend( AnimatedTextElement, AnimatedElement );


AnimatedTextElement.prototype.setToElement = function( aElement )
{
var bRet = AnimatedTextElement.superclass.setToElement.call( this, aElement );
if( bRet )
{
this.aGraphicGroupElement = getElementByClassName( this.aActiveElement, 'GraphicGroup' );
}
return ( bRet && this.aGraphicGroupElement );
};

AnimatedTextElement.prototype.notifySlideStart = function( aSlideShowContext )
{
DBGLOG( 'AnimatedTextElement.notifySlideStart' );
AnimatedTextElement.superclass.notifySlideStart.call( this, aSlideShowContext );
this.aGraphicGroupElement = getElementByClassName( this.aActiveElement, 'GraphicGroup' );
this.restoreBaseTextParagraph();
};

AnimatedTextElement.prototype.notifySlideEnd = function()
{
DBGLOG( 'AnimatedTextElement.notifySlideEnd' );
this.aGraphicGroupElement.setAttribute( 'visibility', 'inherit' );
};

AnimatedTextElement.prototype.restoreBaseTextParagraph = function()
{
var aActiveParagraphElement = this.aActiveElement.firstElementChild.firstElementChild;
if( aActiveParagraphElement )
{
var sVisibilityAttr = this.aActiveElement.getAttribute( 'visibility' );
if( !sVisibilityAttr || ( sVisibilityAttr === 'visible' ) )
sVisibilityAttr = 'inherit';
if( sVisibilityAttr === 'inherit' )
this.aGraphicGroupElement.setAttribute( 'visibility', 'visible' );
else
this.aGraphicGroupElement.setAttribute( 'visibility', 'hidden' );

var aParagraphClone = aActiveParagraphElement.cloneNode( true );
aParagraphClone.setAttribute( 'id', this.sParagraphId );
aParagraphClone.setAttribute( 'visibility', sVisibilityAttr );
this.aParentTextElement.replaceChild( aParagraphClone, this.aParagraphElement );
this.aParagraphElement = aParagraphClone;


var aEventMultiplexer = this.aSlideShowContext.aEventMultiplexer;
var aHyperlinkIdSet = this.aHyperlinkIdSet;
var aHyperlinkElementSet = getElementsByClassName( this.aParagraphElement, 'UrlField' );
var i = 0;
for( ; i < aHyperlinkIdSet.length; ++i )
{
aEventMultiplexer.notifyElementChangedEvent( aHyperlinkIdSet[i], aHyperlinkElementSet[i] );
}
}
this.aActiveElement.setAttribute( 'visibility', 'hidden' );
};

AnimatedTextElement.prototype.notifyAnimationStart = function()
{
DBGLOG( 'AnimatedTextElement.notifyAnimationStart' );
if( this.nRunningAnimations === 0 )
{
var sVisibilityAttr = this.aParagraphElement.getAttribute( 'visibility' );
if( !sVisibilityAttr )
sVisibilityAttr = 'inherit';
this.aActiveElement.setAttribute( 'visibility', sVisibilityAttr );
this.aGraphicGroupElement.setAttribute( 'visibility', 'inherit' );
this.aParagraphElement.setAttribute( 'visibility', 'hidden' );
}
++this.nRunningAnimations;
};

AnimatedTextElement.prototype.notifyAnimationEnd = function()
{
DBGLOG( 'AnimatedTextElement.notifyAnimationEnd' );
--this.nRunningAnimations;
if( this.nRunningAnimations === 0 )
{
this.restoreBaseTextParagraph();
}
};

AnimatedTextElement.prototype.saveState = function( nAnimationNodeId )
{
if( this.nRunningAnimations === 0 )
{
var sVisibilityAttr = this.aParagraphElement.getAttribute( 'visibility' );
this.aActiveElement.setAttribute( 'visibility', sVisibilityAttr );
this.aGraphicGroupElement.setAttribute( 'visibility', 'inherit' );
}
AnimatedTextElement.superclass.saveState.call( this, nAnimationNodeId );
};

AnimatedTextElement.prototype.restoreState = function( nAnimationNodeId )
{
var bRet = AnimatedTextElement.superclass.restoreState.call( this, nAnimationNodeId );
if( bRet )
this.restoreBaseTextParagraph();
return bRet;
};


function SlideTransition( aAnimationsRootElement, aSlideId )
{
this.sSlideId = aSlideId;
this.bIsValid = false;
this.eTransitionType = undefined;
this.eTransitionSubType = undefined;
this.bReverseDirection = false;
this.eTransitionMode = TRANSITION_MODE_IN;
this.sFadeColor = null;
this.aDuration = null;
this.nMinFrameCount = undefined;

if( aAnimationsRootElement )
{
if( aAnimationsRootElement.firstElementChild &&
( aAnimationsRootElement.firstElementChild.getAttributeNS( NSS['smil'], 'begin' ) === (this.sSlideId + '.begin') ) )
{
var aTransitionFilterElement = aAnimationsRootElement.firstElementChild.firstElementChild;
if( aTransitionFilterElement && ( aTransitionFilterElement.localName === 'transitionFilter' ) )
{
this.aElement = aTransitionFilterElement;
this.parseElement();
}
aAnimationsRootElement.removeChild( aAnimationsRootElement.firstElementChild );
}
}
}

SlideTransition.prototype.createSlideTransition = function( aLeavingSlide, aEnteringSlide )
{
if( !this.isValid() )
return null;
if( this.eTransitionType == 0 )
return null;

if( !aEnteringSlide )
{
log( 'SlideTransition.createSlideTransition: invalid entering slide.' );
return null;
}

var aTransitionInfo = aTransitionInfoTable[this.eTransitionType][this.eTransitionSubType];
var eTransitionClass = aTransitionInfo['class'];

switch( eTransitionClass )
{
default:
case TRANSITION_INVALID:
log( 'SlideTransition.createSlideTransition: transition class: TRANSITION_INVALID' );
return null;

case TRANSITION_CLIP_POLYPOLYGON:
var aParametricPolyPolygon
= createClipPolyPolygon( this.eTransitionType, this.eTransitionSubType );
return new ClippedSlideChange( aLeavingSlide, aEnteringSlide, aParametricPolyPolygon,
aTransitionInfo, this.isDirectionForward() );

case TRANSITION_SPECIAL:
switch( this.eTransitionType )
{
default:
log( 'SlideTransition.createSlideTransition: ' +
'transition class: TRANSITION_SPECIAL, ' +
'unknown transition type: ' + this.eTransitionType );
return null;

case PUSHWIPE_TRANSITION:
{
var bCombined = false;
var aDirection = null;
switch( this.eTransitionSubType )
{
default:
log( 'SlideTransition.createSlideTransition: ' +
'transition type: PUSHWIPE_TRANSITION, ' +
'unknown transition subtype: ' + this.eTransitionSubType );
return null;
case FROMTOP_TRANS_SUBTYPE:
aDirection = { x: 0.0, y: 1.0 };
break;
case FROMBOTTOM_TRANS_SUBTYPE:
aDirection = { x: 0.0, y: -1.0 };
break;
case FROMLEFT_TRANS_SUBTYPE:
aDirection = { x: 1.0, y: 0.0 };
break;
case FROMRIGHT_TRANS_SUBTYPE:
aDirection = { x: -1.0, y: 0.0 };
break;
}
if( bCombined )
return null;
else
return new MovingSlideChange( aLeavingSlide, aEnteringSlide, aDirection, aDirection );
}

case SLIDEWIPE_TRANSITION:
{
var aInDirection = null;
switch( this.eTransitionSubType )
{
default:
log( 'SlideTransition.createSlideTransition: ' +
'transition type: SLIDEWIPE_TRANSITION, ' +
'unknown transition subtype: ' + this.eTransitionSubType );
return null;
case FROMTOP_TRANS_SUBTYPE:
aInDirection = { x: 0.0, y: 1.0 };
break;
case FROMBOTTOM_TRANS_SUBTYPE:
aInDirection = { x: 0.0, y: -1.0 };
break;
case FROMLEFT_TRANS_SUBTYPE:
aInDirection = { x: 1.0, y: 0.0 };
break;
case FROMRIGHT_TRANS_SUBTYPE:
aInDirection = { x: -1.0, y: 0.0 };
break;
}
var aNoDirection = { x: 0.0, y: 0.0 };
if( !this.bReverseDirection )
{
return new MovingSlideChange( aLeavingSlide, aEnteringSlide, aNoDirection, aInDirection );
}
else
{
return new MovingSlideChange( aLeavingSlide, aEnteringSlide, aInDirection, aNoDirection );
}
}

case FADE_TRANSITION:
switch( this.eTransitionSubType )
{
default:
log( 'SlideTransition.createSlideTransition: ' +
'transition type: FADE_TRANSITION, ' +
'unknown transition subtype: ' + this.eTransitionSubType );
return null;
case CROSSFADE_TRANS_SUBTYPE:
return new FadingSlideChange( aLeavingSlide, aEnteringSlide );
case FADEOVERCOLOR_TRANS_SUBTYPE:
return new FadingOverColorSlideChange( aLeavingSlide, aEnteringSlide, this.getFadeColor() );
}
}
}
};

SlideTransition.prototype.parseElement = function()
{
this.bIsValid = true;
var aAnimElem = this.aElement;

this.eTransitionType = undefined;
var sTypeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'type' );
if( sTypeAttr && aTransitionTypeInMap[ sTypeAttr ] )
{
this.eTransitionType = aTransitionTypeInMap[ sTypeAttr ];
}
else
{
this.bIsValid = false;
log( 'SlideTransition.parseElement: transition type not valid: ' + sTypeAttr );
}

this.eTransitionSubType = undefined;
var sSubTypeAttr = aAnimElem.getAttributeNS( NSS['smil'], 'subtype' );
if( sSubTypeAttr === null )
sSubTypeAttr = 'default';
if( sSubTypeAttr && ( aTransitionSubtypeInMap[ sSubTypeAttr ] !== undefined ) )
{
this.eTransitionSubType = aTransitionSubtypeInMap[ sSubTypeAttr ];
}
else
{
this.bIsValid = false;
log( 'SlideTransition.parseElement: transition subtype not valid: ' + sSubTypeAttr );
}

if( this.bIsValid && aTransitionInfoTable[this.eTransitionType][this.eTransitionSubType] === undefined )
{
this.bIsValid = false;
log( 'SlideTransition.parseElement: transition not valid: type: ' + sTypeAttr + ' subtype: ' + sSubTypeAttr );
}

this.bReverseDirection = false;
var sDirectionAttr = aAnimElem.getAttributeNS( NSS['smil'], 'direction' );
if( sDirectionAttr == 'reverse' )
this.bReverseDirection = true;

this.sFadeColor = null;
if( this.eTransitionType == FADE_TRANSITION &&
( this.eTransitionSubType == FADEFROMCOLOR_TRANS_SUBTYPE ||
this.eTransitionSubType == FADEOVERCOLOR_TRANS_SUBTYPE ||
this.eTransitionSubType == FADETOCOLOR_TRANS_SUBTYPE ) )
{
var sColorAttr = aAnimElem.getAttributeNS( NSS['smil'], 'fadeColor' );
if( sColorAttr )
this.sFadeColor = sColorAttr;
else
this.sFadeColor='#000000';
}


this.aDuration = null;
var sDurAttr = aAnimElem.getAttributeNS( NSS['smil'], 'dur' );
this.aDuration = new Duration( sDurAttr );
if( !this.aDuration.isSet() )
{
this.aDuration = new Duration( null ); // duration == 0.0
}

this.nMinFrameCount = ( this.getDuration().isValue() )
? ( this.getDuration().getValue() * MINIMUM_FRAMES_PER_SECONDS )
: MINIMUM_FRAMES_PER_SECONDS;
if( this.nMinFrameCount < 1.0 )
this.nMinFrameCount = 1;
else if( this.nMinFrameCount > MINIMUM_FRAMES_PER_SECONDS )
this.nMinFrameCount = MINIMUM_FRAMES_PER_SECONDS;

};

SlideTransition.prototype.isValid = function()
{
return this.bIsValid;
};

SlideTransition.prototype.getTransitionType = function()
{
return this.eTransitionType;
};

SlideTransition.prototype.getTransitionSubType = function()
{
return this.eTransitionSubType;
};

SlideTransition.prototype.getTransitionMode = function()
{
return this.eTransitionMode;
};

SlideTransition.prototype.getFadeColor = function()
{
return this.sFadeColor;
};

SlideTransition.prototype.isDirectionForward = function()
{
return !this.bReverseDirection;
};

SlideTransition.prototype.getDuration = function()
{
return this.aDuration;
};

SlideTransition.prototype.getMinFrameCount = function()
{
return this.nMinFrameCount;
};

SlideTransition.prototype.info = function()
{

var sInfo ='slide transition <' + this.sSlideId + '>: ';
sInfo += ';  type: ' + aTransitionTypeOutMap[ String( this.getTransitionType() ) ];

sInfo += ';  subtype: ' + aTransitionSubtypeOutMap[ this.getTransitionSubType() ];

if( !this.isDirectionForward() )
sInfo += ';  direction: reverse';

sInfo += '; mode: ' + aTransitionModeOutMap[ this.getTransitionMode() ];

if( this.getDuration() )
sInfo += '; duration: ' + this.getDuration().info();

return sInfo;
};


function SlideAnimations( aSlideShowContext )
{
this.aContext = new NodeContext( aSlideShowContext );
this.aAnimationNodeMap = {};
this.aAnimatedElementMap = {};
this.aSourceEventElementMap = {};
this.aNextEffectEventArray = new NextEffectEventArray();
this.aInteractiveAnimationSequenceMap = {};
this.aEventMultiplexer = new EventMultiplexer( aSlideShowContext.aTimerEventQueue );
this.aRootNode = null;
this.bElementsParsed = false;

this.aContext.aAnimationNodeMap = this.aAnimationNodeMap;
this.aContext.aAnimatedElementMap = this.aAnimatedElementMap;
this.aContext.aSourceEventElementMap = this.aSourceEventElementMap;

this.aEventMultiplexer.registerMouseClickHandler( document, 100 );
}


SlideAnimations.prototype.importAnimations = function( aAnimationRootElement )
{
if( !aAnimationRootElement )
return false;

this.aRootNode = createAnimationTree( aAnimationRootElement, this.aContext );

return ( this.aRootNode ? true : false );
};

SlideAnimations.prototype.parseElements = function()
{
if( !this.aRootNode )
return false;

if( !this.aRootNode.parseElement() )
return false;
else
this.bElementsParsed = true;
};

SlideAnimations.prototype.elementsParsed = function()
{
return this.bElementsParsed;
};

SlideAnimations.prototype.isFirstRun = function()
{
return this.aContext.bFirstRun;
};

SlideAnimations.prototype.isAnimated = function()
{
if( !this.bElementsParsed )
return false;

return this.aRootNode.hasPendingAnimation();
};

SlideAnimations.prototype.start = function()
{
if( !this.bElementsParsed )
return false;

this.chargeSourceEvents();
this.chargeInterAnimEvents();

aSlideShow.setSlideEvents( this.aNextEffectEventArray,
this.aInteractiveAnimationSequenceMap,
this.aEventMultiplexer );

if( this.aContext.bFirstRun == undefined )
this.aContext.bFirstRun = true;
else if( this.aContext.bFirstRun )
this.aContext.bFirstRun = false;

if( !this.aRootNode.init() )
return false;

return this.aRootNode.resolve();
};

SlideAnimations.prototype.end = function( bLeftEffectsSkipped )
{
if( !this.bElementsParsed )
return; // no animations there

this.aRootNode.deactivate();
this.aRootNode.end();

if( bLeftEffectsSkipped && this.isFirstRun() )
{
this.aContext.bFirstRun = undefined;
}
else if( this.isFirstRun() )
{
this.aContext.bFirstRun = false;
}

};

SlideAnimations.prototype.dispose = function()
{
if( this.aRootNode )
{
this.aRootNode.dispose();
}
};

SlideAnimations.prototype.clearNextEffectEvents = function()
{
ANIMDBG.print( 'SlideAnimations.clearNextEffectEvents: current slide: ' + nCurSlide );
this.aNextEffectEventArray.clear();
this.aContext.bFirstRun = undefined;
};

SlideAnimations.prototype.chargeSourceEvents = function()
{
for( var id in this.aSourceEventElementMap )
{
this.aSourceEventElementMap[id].charge();
}
};

SlideAnimations.prototype.chargeInterAnimEvents = function()
{
for( var id in this.aInteractiveAnimationSequenceMap )
{
this.aInteractiveAnimationSequenceMap[id].chargeEvents();
}
};


function Event()
{
this.nId = Event.getUniqueId();
}


Event.CURR_UNIQUE_ID = 0;

Event.getUniqueId = function()
{
++Event.CURR_UNIQUE_ID;
return Event.CURR_UNIQUE_ID;
};

Event.prototype.getId = function()
{
return this.nId;
};


function DelayEvent( aFunctor, nTimeout )
{
DelayEvent.superclass.constructor.call( this );

this.aFunctor = aFunctor;
this.nTimeout = nTimeout;
this.bWasFired = false;
}
extend( DelayEvent, Event );


DelayEvent.prototype.fire = function()
{
assert( this.isCharged(), 'DelayEvent.fire: assertion isCharged failed' );

this.bWasFired = true;
this.aFunctor();
return true;
};

DelayEvent.prototype.isCharged = function()
{
return !this.bWasFired;
};

DelayEvent.prototype.getActivationTime = function( nCurrentTime )
{
return ( this.nTimeout + nCurrentTime );
};

DelayEvent.prototype.dispose = function()
{
if( this.isCharged() )
this.bWasFired = true;
};

DelayEvent.prototype.charge = function()
{
if( !this.isCharged() )
this.bWasFired = false;
};


function makeEvent( aFunctor )
{
return new DelayEvent( aFunctor, 0.0 );
}


function makeDelay( aFunctor, nTimeout )
{
return new DelayEvent( aFunctor, nTimeout );
}


function registerEvent( nNodeId, aTiming, aEvent, aNodeContext )
{
var aSlideShowContext = aNodeContext.aContext;
var eTimingType = aTiming.getType();

registerEvent.DBG( aTiming );

if( eTimingType == OFFSET_TIMING )
{
aSlideShowContext.aTimerEventQueue.addEvent( aEvent );
}
else if ( aNodeContext.bFirstRun )
{
var aEventMultiplexer = aSlideShowContext.aEventMultiplexer;
if( !aEventMultiplexer )
{
log( 'registerEvent: event multiplexer not initialized' );
return;
}
var aNextEffectEventArray = aSlideShowContext.aNextEffectEventArray;
if( !aNextEffectEventArray )
{
log( 'registerEvent: next effect event array not initialized' );
return;
}
var aInteractiveAnimationSequenceMap =
aSlideShowContext.aInteractiveAnimationSequenceMap;
if( !aInteractiveAnimationSequenceMap )
{
log( 'registerEvent: interactive animation sequence map not initialized' );
return;
}

switch( eTimingType )
{
case EVENT_TIMING:
var eEventType = aTiming.getEventType();
var sEventBaseElemId = aTiming.getEventBaseElementId();
if( sEventBaseElemId )
{
var aEventBaseElem = document.getElementById( sEventBaseElemId );
if( !aEventBaseElem )
{
log( 'generateEvent: EVENT_TIMING: event base element not found: ' + sEventBaseElemId );
return;
}
var aSourceEventElement = aNodeContext.makeSourceEventElement( sEventBaseElemId, aEventBaseElem );

if( !aInteractiveAnimationSequenceMap[ nNodeId ] )
{
aInteractiveAnimationSequenceMap[ nNodeId ] = new InteractiveAnimationSequence(nNodeId);
}

var bEventRegistered = false;
switch( eEventType )
{
case EVENT_TRIGGER_ON_CLICK:
aEventMultiplexer.registerEvent( eEventType, aSourceEventElement.getId(), aEvent );
aEventMultiplexer.registerRewindedEffectHandler( aSourceEventElement.getId(),
bind2( aSourceEventElement.charge, aSourceEventElement ) );
bEventRegistered = true;
break;
default:
log( 'generateEvent: not handled event type: ' + eEventType );
}
if( bEventRegistered )
{
var aStartEvent = aInteractiveAnimationSequenceMap[ nNodeId ].getStartEvent();
var aEndEvent = aInteractiveAnimationSequenceMap[ nNodeId ].getEndEvent();
aEventMultiplexer.registerEvent( eEventType, aSourceEventElement.getId(), aStartEvent );
aEventMultiplexer.registerEvent( EVENT_TRIGGER_END_EVENT, nNodeId, aEndEvent );
aEventMultiplexer.registerRewindedEffectHandler(
nNodeId,
bind2( InteractiveAnimationSequence.prototype.chargeEvents,
aInteractiveAnimationSequenceMap[ nNodeId ] )
);
}
}
else  // no base event element present
{
switch( eEventType )
{
case EVENT_TRIGGER_ON_NEXT_EFFECT:
aNextEffectEventArray.appendEvent( aEvent );
break;
default:
log( 'generateEvent: not handled event type: ' + eEventType );
}
}
break;
case SYNCBASE_TIMING:
eEventType = aTiming.getEventType();
sEventBaseElemId = aTiming.getEventBaseElementId();
if( sEventBaseElemId )
{
var aAnimationNode = aNodeContext.aAnimationNodeMap[ sEventBaseElemId ];
if( !aAnimationNode )
{
log( 'generateEvent: SYNCBASE_TIMING: event base element not found: ' + sEventBaseElemId );
return;
}
aEventMultiplexer.registerEvent( eEventType, aAnimationNode.getId(), aEvent );
}
else
{
log( 'generateEvent: SYNCBASE_TIMING: event base element not specified' );
}
break;
default:
log( 'generateEvent: not handled timing type: ' + eTimingType );
}
}
}

registerEvent.DEBUG = aRegisterEventDebugPrinter.isEnabled();

registerEvent.DBG = function( aTiming, nTime )
{
if( registerEvent.DEBUG )
{
aRegisterEventDebugPrinter.print( 'registerEvent( timing: ' + aTiming.info() + ' )', nTime );
}
};


function SourceEventElement( sId, aElement, aEventMultiplexer )
{
this.sId = sId;
this.aElement = aElement;
this.aEventMultiplexer = aEventMultiplexer;

this.aEventMultiplexer.registerMouseClickHandler( this, 1000 );

this.bClickHandled = false;
this.bIsPointerOver = false;
this.aElement.addEventListener( 'mouseover', bind2( SourceEventElement.prototype.onMouseEnter, this), false );
this.aElement.addEventListener( 'mouseout', bind2( SourceEventElement.prototype.onMouseLeave, this), false );
}

SourceEventElement.prototype.getId = function()
{
return this.sId;
};

SourceEventElement.prototype.onMouseEnter = function()
{
this.bIsPointerOver = true;
this.setPointerCursor();
};

SourceEventElement.prototype.onMouseLeave = function()
{
this.bIsPointerOver = false;
this.setDefaultCursor();
};

SourceEventElement.prototype.charge = function()
{
this.bClickHandled = false;
this.setPointerCursor();
};

SourceEventElement.prototype.handleClick = function( aMouseEvent )
{
if( !this.bIsPointerOver ) return false;

if( this.bClickHandled )
return false;

this.aEventMultiplexer.notifyEvent( EVENT_TRIGGER_ON_CLICK, this.getId() );
aSlideShow.update();
this.bClickHandled = true;
this.setDefaultCursor();
return true;
};

SourceEventElement.prototype.setPointerCursor = function()
{
if( this.bClickHandled )
return;

this.aElement.setAttribute( 'style', 'cursor: pointer' );
};

SourceEventElement.prototype.setDefaultCursor = function()
{
this.aElement.setAttribute( 'style', 'cursor: default' );
};


function HyperlinkElement( sId, aEventMultiplexer )
{
var aElement = document.getElementById( sId );
if( !aElement )
{
log( 'error: HyperlinkElement: no element with id: <' + sId + '> found' );
return;
}
if( !aEventMultiplexer )
{
log( 'AnimatedElement constructor: event multiplexer is not valid' );
}

this.sId = sId;
this.aElement = aElement;
this.aEventMultiplexer = aEventMultiplexer;
this.nTargetSlideIndex = undefined;

this.sURL = getNSAttribute( 'xlink', this.aElement, 'href' );
if( this.sURL )
{
if( this.sURL[0] === '#' )
{
if( this.sURL.substr(1, 5) === 'Slide' )
{
var sSlideIndex = this.sURL.split( ' ' )[1];
this.nTargetSlideIndex = parseInt( sSlideIndex ) - 1;
}
}

this.aEventMultiplexer.registerElementChangedHandler( this.sId, bind2( HyperlinkElement.prototype.onElementChanged, this) );
this.aEventMultiplexer.registerMouseClickHandler( this, 1100 );

this.bIsPointerOver = false;
this.mouseEnterHandler = bind2( HyperlinkElement.prototype.onMouseEnter, this);
this.mouseLeaveHandler = bind2( HyperlinkElement.prototype.onMouseLeave, this);
this.aElement.addEventListener( 'mouseover', this.mouseEnterHandler, false );
this.aElement.addEventListener( 'mouseout', this.mouseLeaveHandler, false );
}
else
{
log( 'warning: HyperlinkElement(' + this.sId + '): url is empty' );
}
}

HyperlinkElement.prototype.onElementChanged = function( aElement )
{
if( !aElement )
{
log( 'error: HyperlinkElement: passed element is not valid' );
return;
}

if( this.sURL )
{
this.aElement.removeEventListener( 'mouseover', this.mouseEnterHandler, false );
this.aElement.removeEventListener( 'mouseout', this.mouseLeaveHandler, false );
this.aElement = aElement;
this.aElement.addEventListener( 'mouseover', this.mouseEnterHandler, false );
this.aElement.addEventListener( 'mouseout', this.mouseLeaveHandler, false );
}
};

HyperlinkElement.prototype.onMouseEnter = function()
{
this.bIsPointerOver = true;
this.setPointerCursor();
};

HyperlinkElement.prototype.onMouseLeave = function()
{
this.bIsPointerOver = false;
this.setDefaultCursor();
};

HyperlinkElement.prototype.handleClick = function( aMouseEvent )
{
if( !this.bIsPointerOver ) return false;


if( this.nTargetSlideIndex !== undefined )
{
aSlideShow.displaySlide( this.nTargetSlideIndex, true );
}
else
{
var aWindowObject = document.defaultView;
if( aWindowObject )
{
aWindowObject.open( this.sURL, this.sId );
}
else
{
log( 'error: HyperlinkElement.handleClick: invalid window object.' );
}
}

return true;
};

HyperlinkElement.prototype.setPointerCursor = function()
{
if( this.bClickHandled )
return;

this.aElement.setAttribute( 'style', 'cursor: pointer' );
};

HyperlinkElement.prototype.setDefaultCursor = function()
{
this.aElement.setAttribute( 'style', 'cursor: default' );
};


function InteractiveAnimationSequence( nId )
{
this.nId = nId;
this.bIsRunning = false;
this.aStartEvent = null;
this.aEndEvent = null;
}

InteractiveAnimationSequence.prototype.getId = function()
{
return this.nId;
};

InteractiveAnimationSequence.prototype.getStartEvent = function()
{
if( !this.aStartEvent )
{
this.aStartEvent =
makeEvent( bind2( InteractiveAnimationSequence.prototype.start, this ) );
}
return this.aStartEvent;
};

InteractiveAnimationSequence.prototype.getEndEvent = function()
{
if( !this.aEndEvent )
{
this.aEndEvent =
makeEvent( bind2( InteractiveAnimationSequence.prototype.end, this ) );
}
return this.aEndEvent;
};

InteractiveAnimationSequence.prototype.chargeEvents = function()
{
if( this.aStartEvent )      this.aStartEvent.charge();
if( this.aEndEvent )        this.aEndEvent.charge();
};

InteractiveAnimationSequence.prototype.isRunning = function()
{
return this.bIsRunning;
};

InteractiveAnimationSequence.prototype.start = function()
{
aSlideShow.notifyInteractiveAnimationSequenceStart( this.getId() );
this.bIsRunning = true;
};

InteractiveAnimationSequence.prototype.end = function()
{
aSlideShow.notifyInteractiveAnimationSequenceEnd( this.getId() );
this.bIsRunning = false;
};


function PriorityEntry( aValue, nPriority )
{
this.aValue = aValue;
this.nPriority = nPriority;
}

PriorityEntry.compare = function( aLhsEntry, aRhsEntry )
{
if ( aLhsEntry.nPriority < aRhsEntry.nPriority )
{
return -1;
}
else if (aLhsEntry.nPriority > aRhsEntry.nPriority)
{
return 1;
}
else
{
return 0;
}
};


function EventMultiplexer( aTimerEventQueue )
{
this.nId = EventMultiplexer.getUniqueId();
this.aTimerEventQueue = aTimerEventQueue;
this.aEventMap = {};
this.aSkipEffectEndHandlerSet = [];
this.aMouseClickHandlerSet = new PriorityQueue( PriorityEntry.compare );
this.aSkipEffectEvent = null;
this.aRewindCurrentEffectEvent = null;
this.aRewindLastEffectEvent = null;
this.aSkipInteractiveEffectEventSet = {};
this.aRewindRunningInteractiveEffectEventSet = {};
this.aRewindEndedInteractiveEffectEventSet = {};
this.aRewindedEffectHandlerSet = {};
this.aElementChangedHandlerSet = {};
}

EventMultiplexer.CURR_UNIQUE_ID = 0;

EventMultiplexer.getUniqueId = function()
{
++EventMultiplexer.CURR_UNIQUE_ID;
return EventMultiplexer.CURR_UNIQUE_ID;
};

EventMultiplexer.prototype.getId = function()
{
return this.nId;
};

EventMultiplexer.prototype.hasRegisteredMouseClickHandlers = function()
{
return !this.aMouseClickHandlerSet.isEmpty();
};

EventMultiplexer.prototype.registerMouseClickHandler = function( aHandler, nPriority )
{
var aHandlerEntry = new PriorityEntry( aHandler, nPriority );
this.aMouseClickHandlerSet.push( aHandlerEntry );
};

EventMultiplexer.prototype.notifyMouseClick = function( aMouseEvent )
{
var aMouseClickHandlerSet = this.aMouseClickHandlerSet.clone();
while( !aMouseClickHandlerSet.isEmpty() )
{
var aHandlerEntry = aMouseClickHandlerSet.top();
aMouseClickHandlerSet.pop();
if( aHandlerEntry.aValue.handleClick( aMouseEvent ) )
break;
}
};

EventMultiplexer.prototype.registerEvent = function( eEventType, aNotifierId, aEvent )
{
this.DBG( 'registerEvent', eEventType, aNotifierId );
if( !this.aEventMap[ eEventType ] )
{
this.aEventMap[ eEventType ] = {};
}
if( !this.aEventMap[ eEventType ][ aNotifierId ] )
{
this.aEventMap[ eEventType ][ aNotifierId ] = [];
}
this.aEventMap[ eEventType ][ aNotifierId ].push( aEvent );
};


EventMultiplexer.prototype.notifyEvent = function( eEventType, aNotifierId )
{
this.DBG( 'notifyEvent', eEventType, aNotifierId );
if( this.aEventMap[ eEventType ] )
{
if( this.aEventMap[ eEventType ][ aNotifierId ] )
{
var aEventArray = this.aEventMap[ eEventType ][ aNotifierId ];
var nSize = aEventArray.length;
for( var i = 0; i < nSize; ++i )
{
this.aTimerEventQueue.addEvent( aEventArray[i] );
}
}
}
};

EventMultiplexer.prototype.registerNextEffectEndHandler = function( aHandler )
{
this.aSkipEffectEndHandlerSet.push( aHandler );
};

EventMultiplexer.prototype.notifyNextEffectEndEvent = function()
{
var nSize = this.aSkipEffectEndHandlerSet.length;
for( var i = 0; i < nSize; ++i )
{
(this.aSkipEffectEndHandlerSet[i])();
}
this.aSkipEffectEndHandlerSet = [];
};

EventMultiplexer.prototype.registerSkipEffectEvent = function( aEvent )
{
this.aSkipEffectEvent = aEvent;
};

EventMultiplexer.prototype.notifySkipEffectEvent = function()
{
if( this.aSkipEffectEvent )
{
this.aTimerEventQueue.addEvent( this.aSkipEffectEvent );
this.aSkipEffectEvent = null;
}
};

EventMultiplexer.prototype.registerRewindCurrentEffectEvent = function( aEvent )
{
this.aRewindCurrentEffectEvent = aEvent;
};

EventMultiplexer.prototype.notifyRewindCurrentEffectEvent = function()
{
if( this.aRewindCurrentEffectEvent )
{
this.aTimerEventQueue.addEvent( this.aRewindCurrentEffectEvent );
this.aRewindCurrentEffectEvent = null;
}
};

EventMultiplexer.prototype.registerRewindLastEffectEvent = function( aEvent )
{
this.aRewindLastEffectEvent = aEvent;
};

EventMultiplexer.prototype.notifyRewindLastEffectEvent = function()
{
if( this.aRewindLastEffectEvent )
{
this.aTimerEventQueue.addEvent( this.aRewindLastEffectEvent );
this.aRewindLastEffectEvent = null;
}
};

EventMultiplexer.prototype.registerSkipInteractiveEffectEvent = function( nNotifierId, aEvent )
{
this.aSkipInteractiveEffectEventSet[ nNotifierId ] = aEvent;
};

EventMultiplexer.prototype.notifySkipInteractiveEffectEvent = function( nNotifierId )
{
if( this.aSkipInteractiveEffectEventSet[ nNotifierId ] )
{
this.aTimerEventQueue.addEvent( this.aSkipInteractiveEffectEventSet[ nNotifierId ] );
}
};

EventMultiplexer.prototype.registerRewindRunningInteractiveEffectEvent = function( nNotifierId, aEvent )
{
this.aRewindRunningInteractiveEffectEventSet[ nNotifierId ] = aEvent;
};

EventMultiplexer.prototype.notifyRewindRunningInteractiveEffectEvent = function( nNotifierId )
{
if( this.aRewindRunningInteractiveEffectEventSet[ nNotifierId ] )
{
this.aTimerEventQueue.addEvent( this.aRewindRunningInteractiveEffectEventSet[ nNotifierId ] );
}
};

EventMultiplexer.prototype.registerRewindEndedInteractiveEffectEvent = function( nNotifierId, aEvent )
{
this.aRewindEndedInteractiveEffectEventSet[ nNotifierId ] = aEvent;
};

EventMultiplexer.prototype.notifyRewindEndedInteractiveEffectEvent = function( nNotifierId )
{
if( this.aRewindEndedInteractiveEffectEventSet[ nNotifierId ] )
{
this.aTimerEventQueue.addEvent( this.aRewindEndedInteractiveEffectEventSet[ nNotifierId ] );
}
};

EventMultiplexer.prototype.registerRewindedEffectHandler = function( aNotifierId, aHandler )
{
this.aRewindedEffectHandlerSet[ aNotifierId ] = aHandler;
};

EventMultiplexer.prototype.notifyRewindedEffectEvent = function( aNotifierId )
{
if( this.aRewindedEffectHandlerSet[ aNotifierId ] )
{
(this.aRewindedEffectHandlerSet[ aNotifierId ])();
}
};

EventMultiplexer.prototype.registerElementChangedHandler = function( aNotifierId, aHandler )
{
this.aElementChangedHandlerSet[ aNotifierId ] = aHandler;
};

EventMultiplexer.prototype.notifyElementChangedEvent = function( aNotifierId, aElement )
{
if( this.aElementChangedHandlerSet[ aNotifierId ] )
{
(this.aElementChangedHandlerSet[ aNotifierId ])( aElement );
}
};

EventMultiplexer.DEBUG = aEventMultiplexerDebugPrinter.isEnabled();

EventMultiplexer.prototype.DBG = function( sMethodName, eEventType, aNotifierId, nTime )
{
if( EventMultiplexer.DEBUG )
{
var sInfo = 'EventMultiplexer.' + sMethodName;
sInfo += '( type: ' + aEventTriggerOutMap[ eEventType ];
sInfo += ', notifier: ' + aNotifierId + ' )';
aEventMultiplexerDebugPrinter.print( sInfo, nTime );
}
};


var aInterpolatorHandler = {};

aInterpolatorHandler.getInterpolator = function( eCalcMode, eValueType, eValueSubtype )
{
var bHasSubtype = ( typeof( eValueSubtype ) === typeof( 0 ) );

if( !bHasSubtype && aInterpolatorHandler.aLerpFunctorMap[ eCalcMode ][ eValueType ] )
{
return aInterpolatorHandler.aLerpFunctorMap[ eCalcMode ][ eValueType ];
}
else if( bHasSubtype && aInterpolatorHandler.aLerpFunctorMap[ eCalcMode ][ eValueType ][ eValueSubtype ] )
{
return aInterpolatorHandler.aLerpFunctorMap[ eCalcMode ][ eValueType ][ eValueSubtype ];
}
else
{
log( 'aInterpolatorHandler.getInterpolator: not found any valid interpolator for calc mode '
+ aCalcModeOutMap[eCalcMode]  + 'and value type ' + aValueTypeOutMap[eValueType]  );
return null;
}
};

aInterpolatorHandler.aLerpFunctorMap = [];
aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_DISCRETE ] = [];
aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_LINEAR ] = [];


aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_LINEAR ][ NUMBER_PROPERTY ] =
function ( nFrom, nTo, nT )
{
return ( ( 1.0 - nT )* nFrom + nT * nTo );
};

aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_LINEAR ][ COLOR_PROPERTY ] = [];

aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_LINEAR ][ COLOR_PROPERTY ][ COLOR_SPACE_RGB ] =
function ( nFrom, nTo, nT )
{
return RGBColor.interpolate( nFrom, nTo, nT );
};

aInterpolatorHandler.aLerpFunctorMap[ CALC_MODE_LINEAR ][ COLOR_PROPERTY ][ COLOR_SPACE_HSL ] =
function ( bCCW  )
{
return  function ( nFrom, nTo, nT )
{
return HSLColor.interpolate( nFrom, nTo, nT, bCCW );
};
};


function KeyStopLerp( aValueList )
{
KeyStopLerp.validateInput( aValueList );

this.aKeyStopList = [];
this.nLastIndex = 0;
this.nKeyStopDistance = aValueList[1] - aValueList[0];
if( this.nKeyStopDistance <= 0 )
this.nKeyStopDistance = 0.001;

for( var i = 0; i < aValueList.length; ++i )
this.aKeyStopList.push( aValueList[i] );

this.nUpperBoundIndex = this.aKeyStopList.length - 2;
}


KeyStopLerp.validateInput = function( aValueList )
{
var nSize = aValueList.length;
assert( nSize > 1, 'KeyStopLerp.validateInput: key stop vector must have two entries or more' );

for( var i = 1; i < nSize; ++i )
{
if( aValueList[i-1] > aValueList[i] )
log( 'KeyStopLerp.validateInput: time vector is not sorted in ascending order!' );
}
};

KeyStopLerp.prototype.reset = function()
{
KeyStopLerp.validateInput( this.aKeyStopList );
this.nLastIndex = 0;
this.nKeyStopDistance = this.aKeyStopList[1] - this.aKeyStopList[0];
if( this.nKeyStopDistance <= 0 )
this.nKeyStopDistance = 0.001;

};

KeyStopLerp.prototype.lerp = function( nAlpha )
{
if( nAlpha > this.aKeyStopList[ this.nLastIndex + 1 ] )
{
do
{
var nIndex = this.nLastIndex + 1;
this.nLastIndex = clamp( nIndex, 0, this.nUpperBoundIndex );
this.nKeyStopDistance = this.aKeyStopList[ this.nLastIndex + 1 ] - this.aKeyStopList[ this.nLastIndex ];
}
while( ( this.nKeyStopDistance <= 0 ) && ( this.nLastIndex < this.nUpperBoundIndex ) );
}

var nRawLerp = ( nAlpha - this.aKeyStopList[ this.nLastIndex ] ) / this.nKeyStopDistance;

nRawLerp = clamp( nRawLerp, 0.0, 1.0 );

var aResult = {};
aResult.nIndex = this.nLastIndex;
aResult.nLerp = nRawLerp;

return aResult;
};

KeyStopLerp.prototype.lerp_ported = function( nAlpha )
{
if( ( this.aKeyStopList[ this.nLastIndex ] < nAlpha ) ||
( this.aKeyStopList[ this.nLastIndex + 1 ] >= nAlpha ) )
{
var i = 0;
for( ; i < this.aKeyStopList.length; ++i )
{
if( this.aKeyStopList[i] >= nAlpha )
break;
}
if( this.aKeyStopList[i] > nAlpha )
--i;
var nIndex = i - 1;
this.nLastIndex = clamp( nIndex, 0, this.aKeyStopList.length - 2 );
}

var nRawLerp = ( nAlpha - this.aKeyStopList[ this.nLastIndex ] ) /
( this.aKeyStopList[ this.nLastIndex+1 ] - this.aKeyStopList[ this.nLastIndex ] );

nRawLerp = clamp( nRawLerp, 0.0, 1.0 );

var aResult = {};
aResult.nIndex = this.nLastIndex;
aResult.nLerp = nRawLerp;

return aResult;
};


var aOperatorSetMap = [];

aOperatorSetMap[ NUMBER_PROPERTY ] = {};

aOperatorSetMap[ NUMBER_PROPERTY ].equal = function( a, b )
{
return ( a === b );
};

aOperatorSetMap[ NUMBER_PROPERTY ].add = function( a, b )
{
return ( a + b );
};

aOperatorSetMap[ NUMBER_PROPERTY ].scale = function( k, v )
{
return ( k * v );
};

aOperatorSetMap[ COLOR_PROPERTY ] = {};

aOperatorSetMap[ COLOR_PROPERTY ].equal = function( a, b )
{
return a.equal( b );
};

aOperatorSetMap[ COLOR_PROPERTY ].add = function( a, b )
{
var c = a.clone();
c.add( b );
return c;
};

aOperatorSetMap[ COLOR_PROPERTY ].scale = function( k, v )
{
var r = v.clone();
r.scale( k );
return r;
};


function ActivityParamSet()
{
this.aEndEvent = null;
this.aTimerEventQueue = null;
this.aActivityQueue = null;
this.nMinDuration = undefined;
this.nMinNumberOfFrames = MINIMUM_FRAMES_PER_SECONDS;
this.bAutoReverse = false;
this.nRepeatCount = 1.0;
this.nAccelerationFraction = 0.0;
this.nDecelerationFraction = 0.0;
this.nSlideWidth = undefined;
this.nSlideHeight = undefined;
this.aFormula = null;
this.aDiscreteTimes = [];
}


function AnimationActivity()
{
this.nId = AnimationActivity.getUniqueId();
}


AnimationActivity.CURR_UNIQUE_ID = 0;

AnimationActivity.getUniqueId = function()
{
++AnimationActivity.CURR_UNIQUE_ID;
return AnimationActivity.CURR_UNIQUE_ID;
};

AnimationActivity.prototype.getId = function()
{
return this.nId;
};


function SetActivity( aCommonParamSet, aAnimation, aToAttr  )
{
SetActivity.superclass.constructor.call( this );

this.aAnimation = aAnimation;
this.aTargetElement = null;
this.aEndEvent = aCommonParamSet.aEndEvent;
this.aTimerEventQueue = aCommonParamSet.aTimerEventQueue;
this.aToAttr = aToAttr;
this.bIsActive = true;
}
extend( SetActivity, AnimationActivity );


SetActivity.prototype.activate = function( aEndEvent )
{
this.aEndEvent = aEndEvent;
this.bIsActive = true;
};

SetActivity.prototype.dispose = function()
{
this.bIsActive = false;
if( this.aEndEvent && this.aEndEvent.isCharged() )
this.aEndEvent.dispose();
};

SetActivity.prototype.calcTimeLag = function()
{
return 0.0;
};

SetActivity.prototype.perform = function()
{
if( !this.isActive() )
return false;

this.bIsActive = false;

if( this.aAnimation && this.aTargetElement )
{
this.aAnimation.start( this.aTargetElement );
this.aAnimation.perform( this.aToAttr );
this.aAnimation.end();
}

if( this.aEndEvent )
this.aTimerEventQueue.addEvent( this.aEndEvent );

};

SetActivity.prototype.isActive = function()
{
return this.bIsActive;
};

SetActivity.prototype.dequeued = function()
{
};

SetActivity.prototype.end = function()
{
this.perform();
};

SetActivity.prototype.setTargets = function( aTargetElement )
{
assert( aTargetElement, 'SetActivity.setTargets: target element is not valid' );
this.aTargetElement = aTargetElement;
};


function ActivityBase( aCommonParamSet )
{
ActivityBase.superclass.constructor.call( this );

this.aTargetElement = null;
this.aEndEvent = aCommonParamSet.aEndEvent;
this.aTimerEventQueue = aCommonParamSet.aTimerEventQueue;
this.nRepeats = aCommonParamSet.nRepeatCount;
this.nAccelerationFraction = aCommonParamSet.nAccelerationFraction;
this.nDecelerationFraction = aCommonParamSet.nDecelerationFraction;
this.bAutoReverse = aCommonParamSet.bAutoReverse;

this.bFirstPerformCall = true;
this.bIsActive = true;

}
extend( ActivityBase, AnimationActivity );


ActivityBase.prototype.activate = function( aEndEvent )
{
this.aEndEvent = aEndEvent;
this.bFirstPerformCall = true;
this.bIsActive = true;
};

ActivityBase.prototype.dispose = function()
{
this.bIsActive = false;

if( this.aEndEvent )
this.aEndEvent.dispose();

this.aEndEvent = null;
};

ActivityBase.prototype.perform = function()
{
if( !this.isActive() )
return false; // no, early exit.

assert( !this.bFirstPerformCall, 'ActivityBase.perform: assertion (!this.FirstPerformCall) failed' );

return true;
};

ActivityBase.prototype.calcTimeLag = function()
{
if( this.isActive() && this.bFirstPerformCall )
{
this.bFirstPerformCall = false;

this.startAnimation();
}
return 0.0;
};

ActivityBase.prototype.isActive = function()
{
return this.bIsActive;
};

ActivityBase.prototype.isDisposed = function()
{
return ( !this.bIsActive && !this.aEndEvent );
};

ActivityBase.prototype.dequeued = function()
{
if( !this.isActive() )
this.endAnimation();
};

ActivityBase.prototype.setTargets = function( aTargetElement )
{
assert( aTargetElement, 'ActivityBase.setTargets: target element is not valid' );

this.aTargetElement = aTargetElement;
};

ActivityBase.prototype.startAnimation = function()
{
throw ( 'ActivityBase.startAnimation: abstract method invoked' );
};

ActivityBase.prototype.endAnimation = function()
{
throw ( 'ActivityBase.endAnimation: abstract method invoked' );
};

ActivityBase.prototype.endActivity = function()
{
this.bIsActive = false;

if( this.aEndEvent )
this.aTimerEventQueue.addEvent( this.aEndEvent );

this.aEndEvent = null;

};

ActivityBase.prototype.calcAcceleratedTime = function( nT )
{


nT = clamp( nT, 0.0, 1.0 );

if( ( this.nAccelerationFraction > 0.0 || this.nDecelerationFraction > 0.0 ) &&
( this.nAccelerationFraction + this.nDecelerationFraction <= 1.0 ) )
{
var nC = 1.0 - 0.5*this.nAccelerationFraction - 0.5*this.nDecelerationFraction;

var nTPrime = 0.0;

if( nT < this.nAccelerationFraction )
{
nTPrime += 0.5 * nT * nT / this.nAccelerationFraction; // partial first interval
}
else
{
nTPrime += 0.5 * this.nAccelerationFraction; // full first interval

if( nT <= ( 1.0 - this.nDecelerationFraction ) )
{
nTPrime += nT - this.nAccelerationFraction; // partial second interval
}
else
{
nTPrime += 1.0 - this.nAccelerationFraction - this.nDecelerationFraction; // full second interval

var nTRelative = nT - 1.0 + this.nDecelerationFraction;

nTPrime += nTRelative - 0.5*nTRelative*nTRelative / this.nDecelerationFraction;
}
}

nT = nTPrime / nC;

}
return nT;
};

ActivityBase.prototype.getEventQueue = function()
{
return this.aTimerEventQueue;
};

ActivityBase.prototype.getTargetElement = function()
{
return this.aTargetElement;
};

ActivityBase.prototype.isRepeatCountValid = function()
{
return !!this.nRepeats; // first ! convert to bool
};

ActivityBase.prototype.getRepeatCount = function()
{
return this.nRepeats;
};

ActivityBase.prototype.isAutoReverse = function()
{
return this.bAutoReverse;
};

ActivityBase.prototype.end = function()
{
if( !this.isActive() || this.isDisposed() )
return;

if( this.bFirstPerformCall )
{
this.bFirstPerformCall = false;
this.startAnimation();
}

this.performEnd();
this.endAnimation();
this.endActivity();
};

ActivityBase.prototype.performEnd = function()
{
throw ( 'ActivityBase.performEnd: abstract method invoked' );
};


function SimpleContinuousActivityBase( aCommonParamSet )
{
SimpleContinuousActivityBase.superclass.constructor.call( this, aCommonParamSet );

this.aTimer = new ElapsedTime( aCommonParamSet.aActivityQueue.getTimer() );
this.nMinSimpleDuration = aCommonParamSet.nMinDuration;
this.nMinNumberOfFrames = aCommonParamSet.nMinNumberOfFrames;
this.nCurrPerformCalls = 0;

}
extend( SimpleContinuousActivityBase, ActivityBase );


SimpleContinuousActivityBase.prototype.startAnimation = function()
{
this.aTimer.reset();
};

SimpleContinuousActivityBase.prototype.calcTimeLag = function()
{
SimpleContinuousActivityBase.superclass.calcTimeLag.call( this );

if( !this.isActive() )
return 0.0;

var nCurrElapsedTime = this.aTimer.getElapsedTime();


var nFractionElapsedTime = nCurrElapsedTime / this.nMinSimpleDuration;

var nFractionRequiredCalls = this.nCurrPerformCalls / this.nMinNumberOfFrames;


if( nFractionElapsedTime < nFractionRequiredCalls )
{
return 0.0;
}
else
{
return ( ( nFractionElapsedTime - nFractionRequiredCalls ) * this.nMinSimpleDuration );
}
};

SimpleContinuousActivityBase.prototype.perform = function()
{
if( !SimpleContinuousActivityBase.superclass.perform.call( this ) )
return false; // done, we're ended

var nCurrElapsedTime = this.aTimer.getElapsedTime();
var nT = nCurrElapsedTime / this.nMinSimpleDuration;


var bActivityEnding = false;

if( this.isRepeatCountValid() )
{

var nRepeatCount = this.getRepeatCount();
var nEffectiveRepeat = this.isAutoReverse() ? 2.0 * nRepeatCount : nRepeatCount;

if( nEffectiveRepeat <= nT )
{
bActivityEnding = true;

nT = nEffectiveRepeat;
}
}


var nRepeats;
var nRelativeSimpleTime;
if( this.isAutoReverse() )
{
nRepeats = Math.floor( nT );
var nFractionalActiveDuration =  nT - nRepeats;

if( nRepeats % 2 )
{
nRelativeSimpleTime = 1.0 - nFractionalActiveDuration;
}
else
{
nRelativeSimpleTime = nFractionalActiveDuration;
}

nRepeats /= 2;
}
else
{

nRepeats = Math.floor( nT );
nRelativeSimpleTime = nT - nRepeats;

if( this.isRepeatCountValid() && ( nRepeats >= this.getRepeatCount() ) )
{

nRelativeSimpleTime = 1.0;
nRepeats -= 1.0;
}
}


this.simplePerform( nRelativeSimpleTime, nRepeats );

if( bActivityEnding )
this.endActivity();

++this.nCurrPerformCalls;

return this.isActive();
};

SimpleContinuousActivityBase.prototype.simplePerform = function( nSimpleTime, nRepeatCount )
{
throw ( 'SimpleContinuousActivityBase.simplePerform: abstract method invoked' );
};


function ContinuousKeyTimeActivityBase( aCommonParamSet )
{
var nSize = aCommonParamSet.aDiscreteTimes.length;
assert( nSize > 1,
'ContinuousKeyTimeActivityBase constructor: assertion (aDiscreteTimes.length > 1) failed' );

assert( aCommonParamSet.aDiscreteTimes[0] == 0.0,
'ContinuousKeyTimeActivityBase constructor: assertion (aDiscreteTimes.front() == 0.0) failed' );

assert( aCommonParamSet.aDiscreteTimes[ nSize - 1 ] <= 1.0,
'ContinuousKeyTimeActivityBase constructor: assertion (aDiscreteTimes.back() <= 1.0) failed' );

ContinuousKeyTimeActivityBase.superclass.constructor.call( this, aCommonParamSet );

this.aLerper = new KeyStopLerp( aCommonParamSet.aDiscreteTimes );
}
extend( ContinuousKeyTimeActivityBase, SimpleContinuousActivityBase );


ContinuousKeyTimeActivityBase.prototype.activate = function( aEndElement )
{
ContinuousKeyTimeActivityBase.superclass.activate.call( this, aEndElement );

this.aLerper.reset();
};

ContinuousKeyTimeActivityBase.prototype.performHook = function( nIndex, nFractionalIndex, nRepeatCount )
{
throw ( 'ContinuousKeyTimeActivityBase.performHook: abstract method invoked' );
};

ContinuousKeyTimeActivityBase.prototype.simplePerform = function( nSimpleTime, nRepeatCount )
{
var nAlpha = this.calcAcceleratedTime( nSimpleTime );

var aLerpResult = this.aLerper.lerp( nAlpha );

this.performHook( aLerpResult.nIndex, aLerpResult.nLerp, nRepeatCount );
};


function ContinuousActivityBase( aCommonParamSet )
{
ContinuousActivityBase.superclass.constructor.call( this, aCommonParamSet );

}
extend( ContinuousActivityBase, SimpleContinuousActivityBase );


ContinuousActivityBase.prototype.performHook = function( nModifiedTime, nRepeatCount )
{
throw ( 'ContinuousActivityBase.performHook: abstract method invoked' );
};

ContinuousActivityBase.prototype.simplePerform = function( nSimpleTime, nRepeatCount )
{
this.performHook( this.calcAcceleratedTime( nSimpleTime ), nRepeatCount );
};


function SimpleActivity( aCommonParamSet, aNumberAnimation, eDirection )
{
assert( ( eDirection == BACKWARD ) || ( eDirection == FORWARD ),
'SimpleActivity constructor: animation direction is not valid' );

assert( aNumberAnimation, 'SimpleActivity constructor: animation object is not valid' );

SimpleActivity.superclass.constructor.call( this, aCommonParamSet );

this.aAnimation = aNumberAnimation;
this.nDirection = ( eDirection == FORWARD ) ? 1.0 : 0.0;
}
extend( SimpleActivity, ContinuousActivityBase );


SimpleActivity.prototype.startAnimation = function()
{
if( this.isDisposed() || !this.aAnimation )
return;

ANIMDBG.print( 'SimpleActivity.startAnimation invoked' );
SimpleActivity.superclass.startAnimation.call( this );

this.aAnimation.start( this.getTargetElement() );
};

SimpleActivity.prototype.endAnimation = function()
{
if( this.aAnimation )
this.aAnimation.end();

};

SimpleActivity.prototype.performHook = function( nModifiedTime, nRepeatCount )
{

if( this.isDisposed() || !this.aAnimation )
return;

var nT = 1.0 - this.nDirection + nModifiedTime * ( 2.0*this.nDirection - 1.0 );
this.aAnimation.perform( nT );
};

SimpleActivity.prototype.performEnd = function()
{
if( this.aAnimation )
this.aAnimation.perform( this.nDirection );
};


function FromToByActivityTemplate( BaseType ) // template parameter
{

function FromToByActivity( aFromValue, aToValue, aByValue,
aActivityParamSet, aAnimation,
aInterpolator, aOperatorSet, bAccumulate )
{
assert( aAnimation, 'FromToByActivity constructor: invalid animation object' );
assert( ( aToValue != undefined ) || ( aByValue != undefined ),
'FromToByActivity constructor: one of aToValue or aByValue must be valid' );

FromToByActivity.superclass.constructor.call( this, aActivityParamSet );

this.aFrom = aFromValue;
this.aTo = aToValue;
this.aBy = aByValue;
this.aStartValue = null;
this.aEndValue = null;
this.aPreviousValue = null;
this.aStartInterpolationValue = null;
this.aAnimation = aAnimation;
this.aInterpolator = aInterpolator;
this.equal = aOperatorSet.equal;
this.add = aOperatorSet.add;
this.scale = aOperatorSet.scale;
this.bDynamicStartValue = false;
this.nIteration = 0;
this.bCumulative = bAccumulate;
this.aFormula = aActivityParamSet.aFormula;


}
extend( FromToByActivity, BaseType );

FromToByActivity.prototype.initAnimatedElement = function()
{
if( this.aAnimation && this.aFrom )
{
var aValue = this.aFormula ? this.aFormula( this.aFrom ) : this.aFrom;
this.aAnimation.perform(aValue);
}
};

FromToByActivity.prototype.startAnimation = function()
{
if( this.isDisposed() || !this.aAnimation  )
{
log( 'FromToByActivity.startAnimation: activity disposed or not valid animation' );
return;
}

FromToByActivity.superclass.startAnimation.call( this );

this.aAnimation.start( this.getTargetElement() );


var aAnimationStartValue = this.aAnimation.getUnderlyingValue();

if( this.aFrom )
{
if( this.aTo )
{
this.aStartValue = this.aFrom;
this.aEndValue = this.aTo;
}
else if( this.aBy )
{
this.aStartValue = this.aFrom;

this.aEndValue = this.add( this.aStartValue, this.aBy );
}
}
else
{
this.aStartValue = aAnimationStartValue;
this.aStartInterpolationValue = this.aStartValue;

if( this.aTo )
{

this.bDynamicStartValue = true;
this.aPreviousValue = this.aStartValue;
this.aEndValue = this.aTo;
}
else if( this.aBy )
{
this.aStartValue = aAnimationStartValue;

this.aEndValue = this.add( this.aStartValue, this.aBy );
}
}

ANIMDBG.print( 'FromToByActivity.startAnimation: aStartValue = ' + this.aStartValue + ', aEndValue = ' + this.aEndValue );
};

FromToByActivity.prototype.endAnimation = function()
{
if( this.aAnimation )
this.aAnimation.end();
};

FromToByActivity.prototype.performHook = function( nModifiedTime, nRepeatCount )
{
if( this.isDisposed() || !this.aAnimation  )
{
log( 'FromToByActivity.performHook: activity disposed or not valid animation' );
return;
}


if( this.bDynamicStartValue )
{
if( this.nIteration != nRepeatCount )
{
this.nIteration = nRepeatCount;
this.aStartInterpolationValue =  this.aStartValue;
}
else
{
var aActualValue = this.aAnimation.getUnderlyingValue();
if( !this.equal( aActualValue, this.aPreviousValue ) )
this.aStartInterpolationValue = aActualValue;
}
}

var aValue = this.aInterpolator( this.aStartInterpolationValue,
this.aEndValue, nModifiedTime );

if( this.bCumulative && !this.bDynamicStartValue )
{
aValue = this.add( this.scale( nRepeatCount, this.aEndValue ), aValue );
}

aValue = this.aFormula ? this.aFormula( aValue ) : aValue;
this.aAnimation.perform( aValue );

if( this.bDynamicStartValue )
{
this.aPreviousValue = this.aAnimation.getUnderlyingValue();
}

};

FromToByActivity.prototype.performEnd = function()
{
if( this.aAnimation )
{
var aValue = this.isAutoReverse() ? this.aStartValue : this.aEndValue;
aValue = this.aFormula ? this.aFormula( aValue ) : aValue;
this.aAnimation.perform( aValue );
}
};

FromToByActivity.prototype.dispose = function()
{
FromToByActivity.superclass.dispose.call( this );
};


return FromToByActivity;
}


var LinearFromToByActivity = instantiate( FromToByActivityTemplate, ContinuousActivityBase );


function  ValueListActivityTemplate( BaseType ) // template parameter
{

function ValueListActivity( aValueList, aActivityParamSet,
aAnimation, aInterpolator,
aOperatorSet, bAccumulate )
{
assert( aAnimation, 'ValueListActivity constructor: invalid animation object' );
assert( aValueList.length != 0, 'ValueListActivity: value list is empty' );

ValueListActivity.superclass.constructor.call( this, aActivityParamSet );

this.aValueList = aValueList;
this.aAnimation = aAnimation;
this.aInterpolator = aInterpolator;
this.add = aOperatorSet.add;
this.scale = aOperatorSet.scale;
this.bCumulative = bAccumulate;
this.aLastValue = this.aValueList[ this.aValueList.length - 1 ];
this.aFormula = aActivityParamSet.aFormula;

}
extend( ValueListActivity, BaseType );

ValueListActivity.prototype.activate = function( aEndEvent )
{
ValueListActivity.superclass.activate.call( this, aEndEvent );
for( var i = 0; i < this.aValueList.length; ++i )
{
ANIMDBG.print( 'createValueListActivity: value[' + i + '] = ' + this.aValueList[i] );
}

};

ValueListActivity.prototype.initAnimatedElement = function()
{
if( this.aAnimation )
{
var aValue = this.aValueList[0];
aValue = this.aFormula ? this.aFormula( aValue ) : aValue;
this.aAnimation.perform(aValue);
}
};

ValueListActivity.prototype.startAnimation = function()
{
if( this.isDisposed() || !this.aAnimation  )
{
log( 'ValueListActivity.startAnimation: activity disposed or not valid animation' );
return;
}

ValueListActivity.superclass.startAnimation.call( this );

this.aAnimation.start( this.getTargetElement() );
};

ValueListActivity.prototype.endAnimation = function()
{
if( this.aAnimation )
this.aAnimation.end();
};

ValueListActivity.prototype.performHook = function( nIndex, nFractionalIndex, nRepeatCount )
{
if( this.isDisposed() || !this.aAnimation  )
{
log( 'ValueListActivity.performHook: activity disposed or not valid animation' );
return;
}

assert( ( nIndex + 1 ) < this.aValueList.length,
'ValueListActivity.performHook: assertion (nIndex + 1 < this.aValueList.length) failed' );


var aValue = this.aInterpolator( this.aValueList[ nIndex ],
this.aValueList[ nIndex+1 ],
nFractionalIndex );

if( this.bCumulative )
{
aValue = this.add( aValue, this.scale( nRepeatCount, this.aLastValue ) );
}

aValue = this.aFormula ? this.aFormula( aValue ) : aValue;
this.aAnimation.perform( aValue );
};

ValueListActivity.prototype.performEnd = function()
{
if( this.aAnimation )
{
var aValue = this.aFormula ? this.aFormula( this.aLastValue ) : this.aLastValue;
this.aAnimation.perform( aValue );
}
};

ValueListActivity.prototype.dispose = function()
{
ValueListActivity.superclass.dispose.call( this );
};


return ValueListActivity;
}


var LinearValueListActivity = instantiate( ValueListActivityTemplate, ContinuousKeyTimeActivityBase );


function createActivity( aActivityParamSet, aAnimationNode, aAnimation, aInterpolator )
{
var eCalcMode = aAnimationNode.getCalcMode();

var sAttributeName = aAnimationNode.getAttributeName();
var aAttributeProp = aAttributeMap[ sAttributeName ];

var eValueType = aAttributeProp[ 'type' ];
var eValueSubtype = aAttributeProp[ 'subtype' ];

if( ! aInterpolator )
{
aInterpolator = aInterpolatorHandler.getInterpolator( eCalcMode,
eValueType,
eValueSubtype );
}

var bAccumulate = ( aAnimationNode.getAccumulate() === ACCUMULATE_MODE_SUM )
&& !( eValueType === BOOL_PROPERTY ||
eValueType === STRING_PROPERTY ||
eValueType === ENUM_PROPERTY );

if( aAnimationNode.getFormula() )
{
var sFormula =  aAnimationNode.getFormula();
var reMath = /abs|sqrt|asin|acos|atan|sin|cos|tan|exp|log|min|max/g;
sFormula = sFormula.replace(reMath, 'Math.$&');
sFormula = sFormula.replace(/pi(?!\w)/g, 'Math.PI');
sFormula = sFormula.replace(/e(?!\w)/g, 'Math.E');
sFormula = sFormula.replace(/\$/g, '__PARAM0__');

var aAnimatedElement = aAnimationNode.getAnimatedElement();
var aBBox = aAnimatedElement.getBaseBBox();
var width = aBBox.width / aActivityParamSet.nSlideWidth;
var height = aBBox.height / aActivityParamSet.nSlideHeight;
var x = ( aBBox.x + aBBox.width / 2 ) / aActivityParamSet.nSlideWidth;
var y = ( aBBox.y + aBBox.height / 2 ) / aActivityParamSet.nSlideHeight;

aActivityParamSet.aFormula = function( __PARAM0__ ) {

return eval(sFormula);
};
}

aActivityParamSet.aDiscreteTimes = aAnimationNode.getKeyTimes();

var aValueSet = aAnimationNode.getValues();
var nValueSetSize = aValueSet.length;

if( nValueSetSize != 0 )
{

if( aActivityParamSet.aDiscreteTimes.length == 0 )
{
for( var i = 0; i < nValueSetSize; ++i )
aActivityParamSet.aDiscreteTimes[i].push( i / nValueSetSize );
}

switch( eCalcMode )
{
case CALC_MODE_DISCRETE:
log( 'createActivity: discrete calculation case not yet implemented' );
break;

default:
log( 'createActivity: unexpected calculation mode: ' + eCalcMode );
case CALC_MODE_PACED :
case CALC_MODE_SPLINE :
case CALC_MODE_LINEAR:
return createValueListActivity( aActivityParamSet,
aAnimationNode,
aAnimation,
aInterpolator,
LinearValueListActivity,
bAccumulate,
eValueType );
}
}
else
{
switch( eCalcMode )
{
case CALC_MODE_DISCRETE:
log( 'createActivity: discrete calculation case not yet implemented' );
break;

default:
log( 'createActivity: unexpected calculation mode: ' + eCalcMode );
case CALC_MODE_PACED :
case CALC_MODE_SPLINE :
case CALC_MODE_LINEAR:
return createFromToByActivity(  aActivityParamSet,
aAnimationNode,
aAnimation,
aInterpolator,
LinearFromToByActivity,
bAccumulate,
eValueType );
}
}
}


function createValueListActivity( aActivityParamSet, aAnimationNode, aAnimation,
aInterpolator, ClassTemplateInstance, bAccumulate, eValueType )
{
var aAnimatedElement = aAnimationNode.getAnimatedElement();
var aOperatorSet = aOperatorSetMap[ eValueType ];
assert( aOperatorSet, 'createFromToByActivity: no operator set found' );

var aValueSet = aAnimationNode.getValues();

var aValueList = [];

extractAttributeValues( eValueType,
aValueList,
aValueSet,
aAnimatedElement.getBaseBBox(),
aActivityParamSet.nSlideWidth,
aActivityParamSet.nSlideHeight );

for( var i = 0; i < aValueList.length; ++i )
{
ANIMDBG.print( 'createValueListActivity: value[' + i + '] = ' + aValueList[i] );
}

return new ClassTemplateInstance( aValueList, aActivityParamSet, aAnimation,
aInterpolator, aOperatorSet, bAccumulate );
}


function createFromToByActivity( aActivityParamSet, aAnimationNode, aAnimation,
aInterpolator, ClassTemplateInstance, bAccumulate, eValueType )
{

var aAnimatedElement = aAnimationNode.getAnimatedElement();
var aOperatorSet = aOperatorSetMap[ eValueType ];
assert( aOperatorSet, 'createFromToByActivity: no operator set found' );

var aValueSet = [];
aValueSet[0] = aAnimationNode.getFromValue();
aValueSet[1] = aAnimationNode.getToValue();
aValueSet[2] = aAnimationNode.getByValue();

ANIMDBG.print( 'createFromToByActivity: value type: ' + aValueTypeOutMap[eValueType] +
', aFrom = ' + aValueSet[0] +
', aTo = ' + aValueSet[1] +
', aBy = ' + aValueSet[2] );

var aValueList = [];

extractAttributeValues( eValueType,
aValueList,
aValueSet,
aAnimatedElement.getBaseBBox(),
aActivityParamSet.nSlideWidth,
aActivityParamSet.nSlideHeight );

ANIMDBG.print( 'createFromToByActivity: ' +
', aFrom = ' + aValueList[0] +
', aTo = ' + aValueList[1] +
', aBy = ' + aValueList[2] );

return new ClassTemplateInstance( aValueList[0], aValueList[1], aValueList[2],
aActivityParamSet, aAnimation,
aInterpolator, aOperatorSet, bAccumulate );
}


function extractAttributeValues( eValueType, aValueList, aValueSet, aBBox, nSlideWidth, nSlideHeight )
{
var i;
switch( eValueType )
{
case NUMBER_PROPERTY :
evalValuesAttribute( aValueList, aValueSet, aBBox, nSlideWidth, nSlideHeight );
break;
case BOOL_PROPERTY :
for( i = 0; i < aValueSet.length; ++i )
{
var aValue = booleanParser( aValueSet[i] );
aValueList.push( aValue );
}
break;
case STRING_PROPERTY :
for( i = 0; i < aValueSet.length; ++i )
{
aValueList.push( aValueSet[i] );
}
break;
case ENUM_PROPERTY :
for( i = 0; i < aValueSet.length; ++i )
{
aValueList.push( aValueSet[i] );
}
break;
case COLOR_PROPERTY :
for( i = 0; i < aValueSet.length; ++i )
{
aValue = colorParser( aValueSet[i] );
aValueList.push( aValue );
}
break;
default:
log( 'createValueListActivity: unexpected value type: ' + eValueType );
}

}


function evalValuesAttribute( aValueList, aValueSet, aBBox, nSlideWidth, nSlideHeight )
{
var width = aBBox.width / nSlideWidth;
var height = aBBox.height / nSlideHeight;
var x = ( aBBox.x + aBBox.width / 2 ) / nSlideWidth;
var y = ( aBBox.y + aBBox.height / 2 ) / nSlideHeight;

var reMath = /abs|sqrt|asin|acos|atan|sin|cos|tan|exp|log|min|max/g;

for( var i = 0; i < aValueSet.length; ++i )
{
var sValue = aValueSet[i];
sValue = sValue.replace(reMath, 'Math.$&');
sValue = sValue.replace(/pi(?!\w)/g, 'Math.PI');
sValue = sValue.replace(/e(?!\w)/g, 'Math.E');
var aValue =  eval( sValue );
aValueList.push( aValue );
}
}


var BACKWARD    = 0;
var FORWARD     = 1;

var MAXIMUM_FRAME_COUNT                 = 60;
var MINIMUM_TIMEOUT                     = 1.0 / MAXIMUM_FRAME_COUNT;
var MAXIMUM_TIMEOUT                     = 4.0;
var MINIMUM_FRAMES_PER_SECONDS          = 10;
var PREFERRED_FRAMES_PER_SECONDS        = 50;
var PREFERRED_FRAME_RATE                = 1.0 / PREFERRED_FRAMES_PER_SECONDS;


function Effect( nId )
{
this.nId = ( typeof( nId ) === typeof( 1 ) ) ? nId : -1;
this.eState = Effect.NOT_STARTED;
}
Effect.NOT_STARTED = 0;
Effect.PLAYING = 1;
Effect.ENDED = 2;

Effect.prototype.getId = function()
{
return this.nId;
};

Effect.prototype.isMainEffect = function()
{
return ( this.nId === -1 );
};

Effect.prototype.isPlaying = function()
{
return ( this.eState === Effect.PLAYING );
};

Effect.prototype.isEnded = function()
{
return ( this.eState === Effect.ENDED );
};

Effect.prototype.start = function()
{
assert( this.eState === Effect.NOT_STARTED, 'Effect.start: wrong state.' );
this.eState = Effect.PLAYING;
};

Effect.prototype.end = function()
{
assert( this.eState === Effect.PLAYING, 'Effect.end: wrong state.' );
this.eState = Effect.ENDED;
};


function SlideShow()
{
this.aTimer = new ElapsedTime();
this.aFrameSynchronization = new FrameSynchronization( PREFERRED_FRAME_RATE );
this.aTimerEventQueue = new TimerEventQueue( this.aTimer );
this.aActivityQueue = new ActivityQueue( this.aTimer );
this.aNextEffectEventArray = null;
this.aInteractiveAnimationSequenceMap = null;
this.aEventMultiplexer = null;

this.aContext = new SlideShowContext( this.aTimerEventQueue,
this.aEventMultiplexer,
this.aNextEffectEventArray,
this.aInteractiveAnimationSequenceMap,
this.aActivityQueue );
this.bIsIdle = true;
this.bIsEnabled = true;
this.bNoSlideTransition = false;
this.bIsTransitionRunning = false;

this.nCurrentEffect = 0;
this.bIsNextEffectRunning = false;
this.bIsRewinding = false;
this.bIsSkipping = false;
this.bIsSkippingAll = false;
this.nTotalInteractivePlayingEffects = 0;
this.aStartedEffectList = [];
this.aStartedEffectIndexMap = {};
this.aStartedEffectIndexMap[ -1 ] = undefined;
}

SlideShow.prototype.setSlideEvents = function( aNextEffectEventArray,
aInteractiveAnimationSequenceMap,
aEventMultiplexer )
{
if( !aNextEffectEventArray )
log( 'SlideShow.setSlideEvents: aNextEffectEventArray is not valid' );

if( !aInteractiveAnimationSequenceMap )
log( 'SlideShow.setSlideEvents:aInteractiveAnimationSequenceMap  is not valid' );

if( !aEventMultiplexer )
log( 'SlideShow.setSlideEvents: aEventMultiplexer is not valid' );

this.aContext.aNextEffectEventArray = aNextEffectEventArray;
this.aNextEffectEventArray = aNextEffectEventArray;
this.aContext.aInteractiveAnimationSequenceMap = aInteractiveAnimationSequenceMap;
this.aInteractiveAnimationSequenceMap = aInteractiveAnimationSequenceMap;
this.aContext.aEventMultiplexer = aEventMultiplexer;
this.aEventMultiplexer = aEventMultiplexer;
this.nCurrentEffect = 0;
};

SlideShow.prototype.createSlideTransition = function( aSlideTransitionHandler, aLeavingSlide, aEnteringSlide, aTransitionEndEvent )
{
if( !aEnteringSlide )
{
log( 'SlideShow.createSlideTransition: entering slide element is not valid.' );
return null;
}

if( this.bNoSlideTransition ) return null;

var aAnimatedLeavingSlide = null;
if( aLeavingSlide )
aAnimatedLeavingSlide = new AnimatedSlide( aLeavingSlide );
var aAnimatedEnteringSlide = new AnimatedSlide( aEnteringSlide );

var aSlideTransition = aSlideTransitionHandler.createSlideTransition( aAnimatedLeavingSlide, aAnimatedEnteringSlide );
if( !aSlideTransition ) return null;

var nDuration = 0.001;
if( aSlideTransitionHandler.getDuration().isValue() )
{
nDuration = aSlideTransitionHandler.getDuration().getValue();
}
else
{
log( 'SlideShow.createSlideTransition: duration is not a number' );
}

var aCommonParameterSet = new ActivityParamSet();
aCommonParameterSet.aEndEvent = aTransitionEndEvent;
aCommonParameterSet.aTimerEventQueue = this.aTimerEventQueue;
aCommonParameterSet.aActivityQueue = this.aActivityQueue;
aCommonParameterSet.nMinDuration = nDuration;
aCommonParameterSet.nMinNumberOfFrames = aSlideTransitionHandler.getMinFrameCount();
aCommonParameterSet.nSlideWidth = WIDTH;
aCommonParameterSet.nSlideHeight = HEIGHT;

return new SimpleActivity( aCommonParameterSet, aSlideTransition, FORWARD );

};

SlideShow.prototype.isEnabled = function()
{
return this.bIsEnabled;
};

SlideShow.prototype.isRunning = function()
{
return !this.bIsIdle;
};

SlideShow.prototype.isTransitionPlaying = function()
{
return this.bIsTransitionRunning;
};

SlideShow.prototype.isMainEffectPlaying = function()
{
return this.bIsNextEffectRunning;
};

SlideShow.prototype.isInteractiveEffectPlaying = function()
{
return ( this.nTotalInteractivePlayingEffects > 0 );
};

SlideShow.prototype.isAnyEffectPlaying = function()
{
return ( this.isMainEffectPlaying() || this.isInteractiveEffectPlaying() );
};

SlideShow.prototype.hasAnyEffectStarted = function()
{
return ( this.aStartedEffectList.length > 0 );
};

SlideShow.prototype.notifyNextEffectStart = function()
{
assert( !this.bIsNextEffectRunning,
'SlideShow.notifyNextEffectStart: an effect is already started.' );
this.bIsNextEffectRunning = true;
this.aEventMultiplexer.registerNextEffectEndHandler( bind2( SlideShow.prototype.notifyNextEffectEnd, this ) );
var aEffect = new Effect();
aEffect.start();
this.aStartedEffectIndexMap[ -1 ] = this.aStartedEffectList.length;
this.aStartedEffectList.push( aEffect );


var aAnimatedElementMap = theMetaDoc.aMetaSlideSet[nCurSlide].aSlideAnimationsHandler.aAnimatedElementMap;
for( var sId in aAnimatedElementMap )
aAnimatedElementMap[ sId ].notifyNextEffectStart( this.nCurrentEffect );
};

SlideShow.prototype.notifyNextEffectEnd = function()
{
assert( this.bIsNextEffectRunning,
'SlideShow.notifyNextEffectEnd: effect already ended.' );
this.bIsNextEffectRunning = false;

this.aStartedEffectList[ this.aStartedEffectIndexMap[ -1 ] ].end();
};

SlideShow.prototype.notifySlideStart = function( nNewSlideIndex, nOldSlideIndex )
{
this.nCurrentEffect = 0;
this.bIsRewinding = false;
this.bIsSkipping = false;
this.bIsSkippingAll = false;
this.nTotalInteractivePlayingEffects = 0;
this.aStartedEffectList = [];
this.aStartedEffectIndexMap = {};
this.aStartedEffectIndexMap[ -1 ] = undefined;

var aAnimatedElementMap;
var sId;
if( nOldSlideIndex !== undefined )
{
aAnimatedElementMap = theMetaDoc.aMetaSlideSet[nOldSlideIndex].aSlideAnimationsHandler.aAnimatedElementMap;
for( sId in aAnimatedElementMap )
aAnimatedElementMap[ sId ].notifySlideEnd();
}

aAnimatedElementMap = theMetaDoc.aMetaSlideSet[nNewSlideIndex].aSlideAnimationsHandler.aAnimatedElementMap;
for( sId in aAnimatedElementMap )
aAnimatedElementMap[ sId ].notifySlideStart( this.aContext );
};

SlideShow.prototype.notifyTransitionEnd = function( nSlideIndex )
{
if( theMetaDoc.getCurrentSlide() )
{
var sRef = 'url(#' + aPresentationClipPathId + ')';
theMetaDoc.getCurrentSlide().slideElement.setAttribute('clip-path', sRef);
}

this.bIsTransitionRunning = false;
if( this.bIsRewinding )
{
theMetaDoc.aMetaSlideSet[nSlideIndex].hide();
var nIndex = nCurSlide !== undefined ? nCurSlide : -1;
this.displaySlide( nIndex, true );
this.skipAllEffects();
this.bIsRewinding = false;
return;
}

theMetaDoc.setCurrentSlide(nSlideIndex);

if( this.aSlideViewElement )
{
theMetaDoc.getCurrentSlide().aVisibilityStatusElement.parentNode.removeChild( this.aSlideViewElement );
this.aSlideViewElement = null;
}
if( this.isEnabled() )
{
this.dispose();

theMetaDoc.getCurrentSlide().aSlideAnimationsHandler.start();
this.update();
}
};

SlideShow.prototype.notifyInteractiveAnimationSequenceStart = function( nNodeId )
{
++this.nTotalInteractivePlayingEffects;
var aEffect = new Effect( nNodeId );
aEffect.start();
this.aStartedEffectIndexMap[ nNodeId ] = this.aStartedEffectList.length;
this.aStartedEffectList.push( aEffect );
};

SlideShow.prototype.notifyInteractiveAnimationSequenceEnd = function( nNodeId )
{
assert( this.isInteractiveEffectPlaying(),
'SlideShow.notifyInteractiveAnimationSequenceEnd: no interactive effect playing.' );

this.aStartedEffectList[ this.aStartedEffectIndexMap[ nNodeId ] ].end();
--this.nTotalInteractivePlayingEffects;
};

SlideShow.prototype.nextEffect = function()
{
if( !this.isEnabled() )
return false;

if( this.isTransitionPlaying() )
{
this.skipTransition();
return true;
}

if( this.isAnyEffectPlaying() )
{
this.skipAllPlayingEffects();
return true;
}

if( !this.aNextEffectEventArray )
return false;

if( this.nCurrentEffect >= this.aNextEffectEventArray.size() )
return false;

this.notifyNextEffectStart();

this.aNextEffectEventArray.at( this.nCurrentEffect ).fire();
++this.nCurrentEffect;
this.update();
return true;
};

SlideShow.prototype.skipTransition  = function()
{
if( this.bIsSkipping || this.bIsRewinding )
return;

this.bIsSkipping = true;

this.aActivityQueue.endAll();
this.aTimerEventQueue.forceEmpty();
this.aActivityQueue.endAll();
this.update();
this.bIsSkipping = false;
};

SlideShow.prototype.skipAllPlayingEffects  = function()
{
if( this.bIsSkipping || this.bIsRewinding )
return true;

this.bIsSkipping = true;
for( var i = 0; i < this.aStartedEffectList.length; ++i )
{
var aEffect = this.aStartedEffectList[i];
if( aEffect.isPlaying() )
{
if( aEffect.isMainEffect() )
this.aEventMultiplexer.notifySkipEffectEvent();
else
this.aEventMultiplexer.notifySkipInteractiveEffectEvent( aEffect.getId() );
}
}
this.update();
this.bIsSkipping = false;
return true;
};

SlideShow.prototype.skipNextEffect = function()
{
if( this.bIsSkipping || this.bIsRewinding )
return true;

assert( !this.isAnyEffectPlaying(),
'SlideShow.skipNextEffect' );

if( !this.aNextEffectEventArray )
return false;

if( this.nCurrentEffect >= this.aNextEffectEventArray.size() )
return false;

this.notifyNextEffectStart();

this.bIsSkipping = true;
this.aNextEffectEventArray.at( this.nCurrentEffect ).fire();
this.aEventMultiplexer.notifySkipEffectEvent();
++this.nCurrentEffect;
this.update();
this.bIsSkipping = false;
return true;
};

SlideShow.prototype.skipPlayingOrNextEffect = function()
{
if( this.isTransitionPlaying() )
{
this.skipTransition();
return true;
}

if( this.isAnyEffectPlaying() )
return this.skipAllPlayingEffects();
else
return this.skipNextEffect();
};


SlideShow.prototype.skipAllEffects = function()
{
if( this.bIsSkippingAll )
return true;

this.bIsSkippingAll = true;

if( this.isTransitionPlaying() )
{
this.skipTransition();
}

if( this.isAnyEffectPlaying() )
{
this.skipAllPlayingEffects();
}
else if( !this.aNextEffectEventArray
|| ( this.nCurrentEffect >= this.aNextEffectEventArray.size() ) )
{
this.bIsSkippingAll = false;
return false;
}

while( this.nCurrentEffect < this.aNextEffectEventArray.size() )
{
this.skipNextEffect();
}
this.bIsSkippingAll = false;
return true;
};

SlideShow.prototype.rewindTransition = function()
{
if( this.bIsSkipping || this.bIsRewinding )
return;

this.bIsRewinding = true;
this.aActivityQueue.endAll();
this.update();
this.bIsRewinding = false;
};

SlideShow.prototype.rewindEffect = function()
{
if( this.bIsSkipping || this.bIsRewinding )
return;

if( !this.hasAnyEffectStarted() )
{
this.rewindToPreviousSlide();
return;
}

this.bIsRewinding = true;

var nFirstPlayingEffectIndex = undefined;

var i = 0;
for( ; i < this.aStartedEffectList.length; ++i )
{
var aEffect = this.aStartedEffectList[i];
if( aEffect.isPlaying() )
{
nFirstPlayingEffectIndex = i;
break;
}
}

if( nFirstPlayingEffectIndex !== undefined )
{
i = this.aStartedEffectList.length - 1;
for( ; i >= nFirstPlayingEffectIndex; --i )
{
aEffect = this.aStartedEffectList[i];
if( aEffect.isPlaying() )
{
if( aEffect.isMainEffect() )
{
this.aEventMultiplexer.notifyRewindCurrentEffectEvent();
if( this.nCurrentEffect > 0 )
--this.nCurrentEffect;
}
else
{
this.aEventMultiplexer.notifyRewindRunningInteractiveEffectEvent( aEffect.getId() );
}
}
else if( aEffect.isEnded() )
{
if( aEffect.isMainEffect() )
{
this.aEventMultiplexer.notifyRewindLastEffectEvent();
if( this.nCurrentEffect > 0 )
--this.nCurrentEffect;
}
else
{
this.aEventMultiplexer.notifyRewindEndedInteractiveEffectEvent( aEffect.getId() );
}
}
}
this.update();

i = this.aStartedEffectList.length - 1;
for( ; i >= nFirstPlayingEffectIndex; --i )
{
aEffect = this.aStartedEffectList.pop();
if( !aEffect.isMainEffect() )
delete this.aStartedEffectIndexMap[ aEffect.getId() ];
}
}
else  // there is no playing effect
{
aEffect = this.aStartedEffectList.pop();
if( !aEffect.isMainEffect() )
delete this.aStartedEffectIndexMap[ aEffect.getId() ];
if( aEffect.isEnded() )  // Well that is almost an assertion.
{
if( aEffect.isMainEffect() )
{
this.aEventMultiplexer.notifyRewindLastEffectEvent();
if( this.nCurrentEffect > 0 )
--this.nCurrentEffect;
}
else
{
this.aEventMultiplexer.notifyRewindEndedInteractiveEffectEvent( aEffect.getId() );
}
}
this.update();
}

this.bIsRewinding = false;
};

SlideShow.prototype.rewindToPreviousSlide = function()
{
if( this.isTransitionPlaying() )
{
this.rewindTransition();
return;
}
if( this.isAnyEffectPlaying() )
return;
var nNewSlide = nCurSlide - 1;
this.displaySlide( nNewSlide, true );
this.skipAllEffects();
};

SlideShow.prototype.rewindAllEffects = function()
{
if( !this.hasAnyEffectStarted() )
{
this.rewindToPreviousSlide();
return;
}

while( this.hasAnyEffectStarted() )
{
this.rewindEffect();
}
};

SlideShow.prototype.displaySlide = function( nNewSlide, bSkipSlideTransition )
{
var aMetaDoc = theMetaDoc;
var nSlides = aMetaDoc.nNumberOfSlides;
if( nNewSlide < 0 && nSlides > 0 )
nNewSlide = nSlides - 1;
else if( nNewSlide >= nSlides )
nNewSlide = 0;

if( ( currentMode === INDEX_MODE ) && ( nNewSlide === nCurSlide ) )
{
aMetaDoc.getCurrentSlide().show();
return;
}

if( this.isTransitionPlaying() )
{
this.skipTransition();
}

var nOldSlide = nCurSlide;
if( nOldSlide !== undefined )
{
var oldMetaSlide = aMetaDoc.aMetaSlideSet[nOldSlide];
if( this.isEnabled() )
{
if( oldMetaSlide.aSlideAnimationsHandler.isAnimated() )
{
oldMetaSlide.aSlideAnimationsHandler.end( bSkipSlideTransition );

this.dispose();
}
}
}

this.notifySlideStart( nNewSlide, nOldSlide );

if( this.isEnabled() && !bSkipSlideTransition  )
{
if ( ( ( nOldSlide !== undefined ) &&
( ( nNewSlide > nOldSlide ) ||
( ( nNewSlide == 0) && ( nOldSlide == (aMetaDoc.nNumberOfSlides - 1) ) ) ) ) ||
(  ( nOldSlide === undefined ) &&  ( nNewSlide == 0) )  // for transition on first slide
)
{

var aOldMetaSlide = null;
if( nOldSlide === undefined ) // for transition on first slide
{
aOldMetaSlide = aMetaDoc.theMetaDummySlide;
}
else
{
aOldMetaSlide = aMetaDoc.aMetaSlideSet[nOldSlide];
}
var aNewMetaSlide = aMetaDoc.aMetaSlideSet[nNewSlide];

var aSlideTransitionHandler = aNewMetaSlide.aTransitionHandler;
if( aSlideTransitionHandler && aSlideTransitionHandler.isValid() )
{
var sRef = 'url(#' + aPresentationClipPathShrinkId + ')';
aOldMetaSlide.slideElement.setAttribute( 'clip-path', sRef );

if( nOldSlide > nNewSlide )
{
this.aSlideViewElement = document.createElementNS( NSS['svg'], 'use' );
setNSAttribute( 'xlink', this.aSlideViewElement, 'href', '#' + aOldMetaSlide.slideContainerId );
aNewMetaSlide.aVisibilityStatusElement.parentNode.insertBefore( this.aSlideViewElement, aNewMetaSlide.aVisibilityStatusElement );
aOldMetaSlide.hide();
}

var aLeavingSlide = aOldMetaSlide;
var aEnteringSlide = aNewMetaSlide;
var aTransitionEndEvent = makeEvent( bind2( this.notifyTransitionEnd, this, nNewSlide ) );

var aTransitionActivity =
this.createSlideTransition( aSlideTransitionHandler, aLeavingSlide,
aEnteringSlide, aTransitionEndEvent );

if( aTransitionActivity )
{
this.bIsTransitionRunning = true;
this.aActivityQueue.addActivity( aTransitionActivity );
this.update();
}
else
{
this.notifyTransitionEnd( nNewSlide );
}
}
else
{
this.notifyTransitionEnd( nNewSlide );
}
}
else
{
this.notifyTransitionEnd( nNewSlide );
}
}
else
{
this.notifyTransitionEnd( nNewSlide );
}

};

SlideShow.prototype.update = function()
{
this.aTimer.holdTimer();

this.aTimerEventQueue.process();
this.aActivityQueue.process();

this.aFrameSynchronization.synchronize();

this.aActivityQueue.processDequeued();

this.aTimer.releaseTimer();

var bActivitiesLeft = ( ! this.aActivityQueue.isEmpty() );
var bTimerEventsLeft = ( ! this.aTimerEventQueue.isEmpty() );
var bEventsLeft = ( bActivitiesLeft || bTimerEventsLeft );


if( bEventsLeft )
{
var nNextTimeout;
if( bActivitiesLeft )
{
nNextTimeout = MINIMUM_TIMEOUT;
this.aFrameSynchronization.activate();
}
else
{
nNextTimeout = this.aTimerEventQueue.nextTimeout();
if( nNextTimeout < MINIMUM_TIMEOUT )
nNextTimeout = MINIMUM_TIMEOUT;
else if( nNextTimeout > MAXIMUM_TIMEOUT )
nNextTimeout = MAXIMUM_TIMEOUT;
this.aFrameSynchronization.deactivate();
}

this.bIsIdle = false;
window.setTimeout( 'aSlideShow.update()', nNextTimeout * 1000 );
}
else
{
this.bIsIdle = true;
}
};

SlideShow.prototype.dispose = function()
{
this.aTimerEventQueue.clear();
this.aActivityQueue.clear();
this.aNextEffectEventArray = null;
this.aEventMultiplexer = null;
};

SlideShow.prototype.getContext = function()
{
return this.aContext;
};

var aSlideShow = null;


function SlideShowContext( aTimerEventQueue, aEventMultiplexer, aNextEffectEventArray, aInteractiveAnimationSequenceMap, aActivityQueue)
{
this.aTimerEventQueue = aTimerEventQueue;
this.aEventMultiplexer = aEventMultiplexer;
this.aNextEffectEventArray = aNextEffectEventArray;
this.aInteractiveAnimationSequenceMap = aInteractiveAnimationSequenceMap;
this.aActivityQueue = aActivityQueue;
this.bIsSkipping = false;
}


function FrameSynchronization( nFrameDuration )
{
this.nFrameDuration = nFrameDuration;
this.aTimer = new ElapsedTime();
this.nNextFrameTargetTime = 0.0;
this.bIsActive = false;

this.markCurrentFrame();
}


FrameSynchronization.prototype.markCurrentFrame = function()
{
this.nNextFrameTargetTime = this.aTimer.getElapsedTime() + this.nFrameDuration;
};

FrameSynchronization.prototype.synchronize = function()
{
if( this.bIsActive )
{
while( this.aTimer.getElapsedTime() < this.nNextFrameTargetTime )
;
}

this.markCurrentFrame();

};

FrameSynchronization.prototype.activate = function()
{
this.bIsActive = true;
};

FrameSynchronization.prototype.deactivate = function()
{
this.bIsActive = false;
};


function NextEffectEventArray()
{
this.aEventArray = [];
}


NextEffectEventArray.prototype.size = function()
{
return this.aEventArray.length;
};

NextEffectEventArray.prototype.at = function( nIndex )
{
return this.aEventArray[ nIndex ];
};

NextEffectEventArray.prototype.appendEvent = function( aEvent )
{
var nSize = this.size();
for( var i = 0; i < nSize; ++i )
{
if( this.aEventArray[i].getId() == aEvent.getId() )
{
aNextEffectEventArrayDebugPrinter.print( 'NextEffectEventArray.appendEvent: event(' + aEvent.getId() + ') already present' );
return false;
}
}
this.aEventArray.push( aEvent );
aNextEffectEventArrayDebugPrinter.print( 'NextEffectEventArray.appendEvent: event(' + aEvent.getId() + ') appended' );
return true;
};

NextEffectEventArray.prototype.clear = function( )
{
this.aEventArray = [];
};


function TimerEventQueue( aTimer )
{
this.aTimer = aTimer;
this.aEventSet = new PriorityQueue( EventEntry.compare );
}


TimerEventQueue.prototype.addEvent = function( aEvent )
{
this.DBG( 'TimerEventQueue.addEvent event(' + aEvent.getId() + ') appended.' );
if( !aEvent )
{
log( 'TimerEventQueue.addEvent: null event' );
return false;
}

var nTime = aEvent.getActivationTime( this.aTimer.getElapsedTime() );
var aEventEntry = new EventEntry( aEvent, nTime );
this.aEventSet.push( aEventEntry );

return true;
};

TimerEventQueue.prototype.forceEmpty = function()
{
this.process_(true);
};


TimerEventQueue.prototype.process = function()
{
this.process_(false);
};

TimerEventQueue.prototype.process_ = function( bFireAllEvents )
{
var nCurrentTime = this.aTimer.getElapsedTime();

while( !this.isEmpty() && ( bFireAllEvents || ( this.aEventSet.top().nActivationTime <= nCurrentTime ) ) )
{
var aEventEntry = this.aEventSet.top();
this.aEventSet.pop();

var aEvent = aEventEntry.aEvent;
if( aEvent.isCharged() )
aEvent.fire();
}
};

TimerEventQueue.prototype.isEmpty = function()
{
return this.aEventSet.isEmpty();
};

TimerEventQueue.prototype.nextTimeout = function()
{
var nTimeout = Number.MAX_VALUE;
var nCurrentTime = this.aTimer.getElapsedTime();
if( !this.isEmpty() )
nTimeout = this.aEventSet.top().nActivationTime - nCurrentTime;
return nTimeout;
};

TimerEventQueue.prototype.clear = function()
{
this.DBG( 'TimerEventQueue.clear invoked' );
this.aEventSet.clear();
};

TimerEventQueue.prototype.getTimer = function()
{
return this.aTimer;
};

TimerEventQueue.prototype.DBG = function( sMessage, nTime )
{
aTimerEventQueueDebugPrinter.print( sMessage, nTime );
};


TimerEventQueue.prototype.insert = function( aEventEntry )
{
var nHoleIndex = this.aEventSet.length;
var nParent = Math.floor( ( nHoleIndex - 1 ) / 2 );

while( ( nHoleIndex > 0 ) && this.aEventSet[ nParent ].compare( aEventEntry ) )
{
this.aEventSet[ nHoleIndex ] = this.aEventSet[ nParent ];
nHoleIndex = nParent;
nParent = Math.floor( ( nHoleIndex - 1 ) / 2 );
}
this.aEventSet[ nHoleIndex ] = aEventEntry;
};


function EventEntry( aEvent, nTime )
{
this.aEvent = aEvent;
this.nActivationTime = nTime;
}


EventEntry.compare = function( aLhsEventEntry, aRhsEventEntry )
{
if ( aLhsEventEntry.nActivationTime > aRhsEventEntry.nActivationTime )
{
return -1;
}
else if ( aLhsEventEntry.nActivationTime < aRhsEventEntry.nActivationTime )
{
return 1;
}
else
{
return 0;
}
};


function ActivityQueue( aTimer )
{
this.aTimer = aTimer;
this.aCurrentActivityWaitingSet = [];
this.aCurrentActivityReinsertSet = [];
this.aDequeuedActivitySet = [];
}


ActivityQueue.prototype.dispose = function()
{
var nSize = this.aCurrentActivityWaitingSet.length;
var i;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityWaitingSet[i].dispose();

nSize = this.aCurrentActivityReinsertSet.length;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityReinsertSet[i].dispose();
};

ActivityQueue.prototype.addActivity = function( aActivity )
{
if( !aActivity )
{
log( 'ActivityQueue.addActivity: activity is not valid' );
return false;
}

this.aCurrentActivityWaitingSet.push( aActivity );
aActivityQueueDebugPrinter.print( 'ActivityQueue.addActivity: activity appended' );
return true;
};

ActivityQueue.prototype.process = function()
{
var nSize = this.aCurrentActivityWaitingSet.length;
var nLag = 0.0;
for( var i = 0; i < nSize; ++i )
{
nLag = Math.max( nLag,this.aCurrentActivityWaitingSet[i].calcTimeLag()  );
}

if( nLag > 0.0 )
this.aTimer.adjustTimer( -nLag, true );


while( this.aCurrentActivityWaitingSet.length != 0 )
{
var aActivity = this.aCurrentActivityWaitingSet.shift();
var bReinsert = false;

bReinsert = aActivity.perform();

if( bReinsert )
{
this.aCurrentActivityReinsertSet.push( aActivity );
}
else
{
this.aDequeuedActivitySet.push( aActivity );
}
}

if( this.aCurrentActivityReinsertSet.length != 0 )
{
this.aCurrentActivityWaitingSet = this.aCurrentActivityReinsertSet;
this.aCurrentActivityReinsertSet = [];
}
};

ActivityQueue.prototype.processDequeued = function()
{
var nSize = this.aDequeuedActivitySet.length;
for( var i = 0; i < nSize; ++i )
this.aDequeuedActivitySet[i].dequeued();

this.aDequeuedActivitySet = [];
};

ActivityQueue.prototype.isEmpty = function()
{
return ( ( this.aCurrentActivityWaitingSet.length == 0 ) &&
( this.aCurrentActivityReinsertSet.length == 0 ) );
};

ActivityQueue.prototype.clear = function()
{
aActivityQueueDebugPrinter.print( 'ActivityQueue.clear invoked' );
var nSize = this.aCurrentActivityWaitingSet.length;
var i;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityWaitingSet[i].dequeued();
this.aCurrentActivityWaitingSet = [];

nSize = this.aCurrentActivityReinsertSet.length;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityReinsertSet[i].dequeued();
this.aCurrentActivityReinsertSet = [];
};

ActivityQueue.prototype.endAll = function()
{
aActivityQueueDebugPrinter.print( 'ActivityQueue.endAll invoked' );
var nSize = this.aCurrentActivityWaitingSet.length;
var i;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityWaitingSet[i].end();
this.aCurrentActivityWaitingSet = [];

nSize = this.aCurrentActivityReinsertSet.length;
for( i = 0; i < nSize; ++i )
this.aCurrentActivityReinsertSet[i].end();
this.aCurrentActivityReinsertSet = [];
};

ActivityQueue.prototype.getTimer = function()
{
return this.aTimer;
};

ActivityQueue.prototype.size = function()
{
return ( this.aCurrentActivityWaitingSet.length +
this.aCurrentActivityReinsertSet.length +
this.aDequeuedActivitySet.length );
};


function ElapsedTime( aTimeBase )
{
this.aTimeBase = aTimeBase;
this.nLastQueriedTime = 0.0;
this.nStartTime = this.getSystemTime();
this.nFrozenTime = 0.0;
this.bInPauseMode = false;
this.bInHoldMode = false;
}


ElapsedTime.prototype.getTimeBase = function()
{
return this.aTimeBase;
};

ElapsedTime.prototype.reset = function()
{
this.nLastQueriedTime = 0.0;
this.nStartTime = this.getSystemTime();
this.nFrozenTime = 0.0;
this.bInPauseMode = false;
this.bInHoldMode = false;
};

ElapsedTime.prototype.getElapsedTime = function()
{
this.nLastQueriedTime = this.getElapsedTimeImpl();
return this.nLastQueriedTime;
};

ElapsedTime.prototype.pauseTimer = function()
{
this.nFrozenTime = this.getElapsedTimeImpl();
this.bInPauseMode = true;
};

ElapsedTime.prototype.continueTimer = function()
{
this.bInPauseMode = false;

var nPauseDuration = this.getElapsedTimeImpl() - this.nFrozenTime;

this.nStartTime += nPauseDuration;
};

ElapsedTime.prototype.adjustTimer = function( nOffset, bLimitToLastQueriedTime )
{
if( bLimitToLastQueriedTime == undefined )
bLimitToLastQueriedTime = true;

this.nStartTime -= nOffset;

if( this.bInHoldMode || this.bInPauseMode )
this.nFrozenTime += nOffset;
};

ElapsedTime.prototype.holdTimer = function()
{
this.nFrozenTime = this.getElapsedTimeImpl();
this.bInHoldMode = true;
};

ElapsedTime.prototype.releaseTimer = function()
{
this.bInHoldMode = false;
};

ElapsedTime.prototype.getSystemTime = function()
{
return ( getCurrentSystemTime() / 1000.0 );
};

ElapsedTime.prototype.getCurrentTime = function()
{
var nCurrentTime;
if ( !this.aTimeBase )
{
nCurrentTime = this.getSystemTime();
}
else
{
nCurrentTime = this.aTimeBase.getElapsedTimeImpl();
}

assert( ( typeof( nCurrentTime ) === typeof( 0 ) ) && isFinite( nCurrentTime ),
'ElapsedTime.getCurrentTime: assertion failed: nCurrentTime == ' + nCurrentTime );


return nCurrentTime;
};

ElapsedTime.prototype.getElapsedTimeImpl = function()
{
if( this.bInHoldMode || this.bInPauseMode )
{

return this.nFrozenTime;
}

var nCurTime = this.getCurrentTime();
return ( nCurTime - this.nStartTime );
};


/*****
* @libreofficeend
*
* Several parts of the above code are the result of the porting,
* started on August 2011, of the C++ code included in the source files
* placed under the folder '/slideshow/source' and subfolders.
* @source http://cgit.freedesktop.org/libreoffice/core/tree/slideshow/source
*
*/

]]></script></svg>